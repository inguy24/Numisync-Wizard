# Changelog

All notable changes to NumiSync Wizard for OpenNumismat.

## Fix History (Compressed)

| Date | Files | Summary |
|------|-------|---------|
| Feb 17 | CLAUDE.md, docs/reference/EMOJI-ENCODING-GUIDANCE.md | **Post-Fix-8 Cleanup â€” Stale Rules Corrected** - Four stale/broken items fixed after verifying all 8 context burn reduction fixes. (1) CLAUDE.md Â§3: fixed broken `@EMOJI-ENCODING-GUIDANCE.md` path reference to correct `@docs/reference/EMOJI-ENCODING-GUIDANCE.md`; removed `file -i <filename>` verification line (Linux-only command, irrelevant on Windows, redundant since ui-strings.js uses Python binary ops). (2) CLAUDE.md Â§2: added `ui-strings.js` exception note to "all renderer JS in app.js" and "NEVER create standalone UI component files" rules â€” these rules directly contradicted the intentionally standalone file created by Fix 8. (3) CLAUDE.md QUICK CONTEXT: corrected IPC handler count from "~50" to "~65" to match IPC-HANDLERS-QUICK-REF.md (authoritative source). (4) EMOJI-ENCODING-GUIDANCE.md: updated tool names from old Claude API (`str_replace`, `create_file`, `bash_tool`) to Claude Code tools (`Edit`, `Write`, `Bash`); replaced stale `/mnt/project/` Linux paths; updated "SPECIFIC FILES WITH EMOJIS" section â€” removed `index.html` and `app.js` (now emoji-free after Fix 8), added `ui-strings.js` as sole restricted file; rewrote all 5 rules and examples to reflect Python binary mode workflow instead of bash cp; updated checklist to match post-Fix-8 architecture. |
| Feb 17 | CLAUDE.md | **Context Burn Reduction â€” Verification & Housekeeping Rules** - Verified all 8 fixes from CONTEXT-BURN-REDUCTION-PLAN.md are correctly implemented. Corrected two stale values in CLAUDE.md: (1) Module count updated from "18 files" to "12 files" (the plan's estimate; actual count after implementation is 12 modules with @fileoverview JSDoc verified on all). (2) Removed broken "Current work items â†’ docs/planning/PHASE3-WORK-PLAN.md" row from task-based reading guide (PHASE3-WORK-PLAN.md was archived to docs/archive/ in Feb 9 â€” the row pointed to a non-existent file). Added new "Reference Doc Maintenance" table to CLAUDE.md Â§1 documenting the housekeeping rules required to keep the new reference infrastructure in sync: when adding/removing IPC handlers â†’ update IPC-HANDLERS-QUICK-REF.md; when changing module exports â†’ update @fileoverview; when adding modules â†’ add @fileoverview + update QUICK CONTEXT count; when adding emoji UI strings â†’ add to ui-strings.js only; when changing DB schema â†’ update PROJECT-REFERENCE.md DATABASE-SCHEMA; when adding lessons â†’ add to CLAUDE.md Â§5 under correct category. Note added that MCP server reads source files at query time so staying accurate in the docs keeps MCP tools accurate automatically. |
|------|-------|---------|
| Feb 17 | src/renderer/ui-strings.js (new), src/renderer/app.js, src/renderer/index.html, CLAUDE.md | **Context Burn Reduction â€” Fix 8 (Emoji Isolation â†’ ui-strings.js)** - Extracted all 25 distinct emoji from `app.js` (38 emoji lines) and `index.html` (22 emoji lines) into a new `src/renderer/ui-strings.js` file. `app.js`: replaced standalone emoji literals (`'âœ…'` â†’ `UI_STRINGS.ICON_CHECK`, etc.) and 8 embedded/template-literal occurrences via Python binary mode; added `.emoji-placeholder` initializer at start of first `DOMContentLoaded` handler that populates `data-ui-key` spans from `UI_STRINGS`. `index.html`: replaced all inline emoji with `<span class="emoji-placeholder" data-ui-key="KEY"></span>` spans; added `<script src="ui-strings.js"></script>` before `app.js` script tag. `CLAUDE.md Â§3` updated to reflect new scope: only `ui-strings.js` retains emoji restriction; `app.js` and `index.html` are now fully editable with standard Edit/Write tools. Verified with Python emoji scanner: `app.js` and `index.html` return 0 emoji lines; `ui-strings.js` has 25 emoji lines as expected. Result: every future UI edit to `app.js` or `index.html` can use standard tools without Python binary workarounds. |
| Feb 17 | src/main/index.js | **Context Burn Reduction â€” Fix 7 (#region comments in index.js)** - Added 12 paired `// #region` / `// #endregion` block comments to `src/main/index.js` grouping all code by domain. Regions: `App Lifecycle & Window Management` (window state, menu, app lifecycle events, lines 271â€“866); `Database Operations` (DB lock detection, collection IPC handlers, helper functions, lines 868â€“1138); `Search & Enrichment` (issuer resolution + Numista search handlers, lines 1140â€“1394); `Field Mapping & Merge` (compare-fields, merge-data, lines 1396â€“1572); `Progress Tracking` (update-coin-status, get-progress-stats, lines 1574â€“1655); `Settings` (Phase 1 app settings, cache management, default collection, Phase 2 settings + stats handlers, lines 1657â€“2114); `Image Handling` (get-coin-images, download-and-store-images, lines 2116â€“2245); `Utility` (open-external, check-installer-eula-marker, check-for-updates, get-app-version, open-manual, lines 2247â€“2293); `Field Mapping Configuration` (get/save/export/import/reset field mappings, lines 2295â€“2427); `Menu & Recent Collections` (menu:update-state, get/clear-recent-collections, lines 2429â€“2477); `Licensing (Polar SDK)` (all supporter status + license validation handlers + feature gating, lines 2479â€“3131); `Batch Operations` (fast pricing, API cache, batch propagate, lines 3133â€“3454). No emojis affected â€” standard Edit tool used. Goal: enables targeted reads and VSCode region folding so any domain-specific task can skip 10 of 12 regions without loading all 3,420+ lines. |
| Feb 17 | mcp/server.js (new), mcp/package.json (new), .mcp.json (new), .claude/settings.json | **Context Burn Reduction â€” Fix 6 (MCP Server)** - Created `mcp/server.js`, a Node.js MCP server using `@modelcontextprotocol/sdk@1.26.0` that exposes 6 on-demand tools for the project knowledge base. Tools: `get_ipc_handlers(filter?)` â€” filters IPC-HANDLERS-QUICK-REF.md by channel name or module without reading index.js; `get_module_api(module_name)` â€” returns @fileoverview JSDoc from any src/modules/ file; `search_lessons(keyword)` â€” full-text search across CLAUDE.md Â§5 lessons by category; `get_recent_changelog(n?)` â€” returns last N changelog entries (default 5, max 20); `get_database_schema(table?)` â€” extracts OpenNumismat schema section from PROJECT-REFERENCE.md with optional table filter; `get_denomination_aliases(unit)` â€” looks up any spelling variant in denomination-aliases.json and returns canonical, plural, and all aliases. Server reads files lazily on each tool call for always-fresh data. Registration: created `c:\numismat-enrichment\.mcp.json` with `mcpServers.numisync` entry (`.claude/settings.json` schema rejects top-level mcpServers key); added `enabledMcpjsonServers: ["numisync"]` to `.claude/settings.json` to auto-approve. Server path relative to repo root: `numismat-enrichment/mcp/server.js`. Dependencies installed in `mcp/node_modules` â€” separate from Electron app package.json. |
| Feb 17 | docs/reference/PROJECT-REFERENCE.md | **Context Burn Reduction â€” Fix 5 (DATABASE-SCHEMA section)** - Added comprehensive `## OpenNumismat Database Schema` section to PROJECT-REFERENCE.md, introspected from `examples/test.db` via `PRAGMA table_info()`. Documents all 14 tables: `coins` (109 columns organized into 9 thematic groups: identity/denomination, physical characteristics, edge/design, classification/catalog, pricing with grade mapping, collection management, acquisition/sale, signature, metadata), `photos` (high-resolution image storage â€” referenced by obverseimg, reverseimg, edgeimg, photo1-6, varietyimg, signatureimg), `images` (composite thumbnail storage â€” referenced ONLY by coins.image), and 10 supporting tables (tags, coins_tags, pages, fields, prices, description, settings, filters, lists, statistics, treeparam). Each image FK column explicitly notes which table it references to prevent the Lesson 5 error. Price columns cross-reference Lesson 21 and field-mapper.js:121-126 for the UNC/XF/VF/F mapping. Goal: Claude can now answer DB schema questions without reading source code or learning the hard way. |
| Feb 17 | docs/reference/IPC-HANDLERS-QUICK-REF.md (new), src/modules/*.js (all 12) | **Context Burn Reduction â€” Fix 2 (IPC Quick Ref) & Fix 3 (@fileoverview JSDoc)** - Implemented two documentation fixes from CONTEXT-BURN-REDUCTION-PLAN.md. Fix 2: Created `docs/reference/IPC-HANDLERS-QUICK-REF.md` â€” a complete quick-reference table of all ~65 IPC handlers in `src/main/index.js`, organized into 13 domain sections (Collection, Search, Merge, Progress, Settings Phase 1/2, Cache, Images, Field Mappings, Menu, Licensing, Batch, Utility). Each handler entry lists channel name, parameters, return shape, and module delegate. Includes critical Notes section covering Phase 1 vs Phase 2 settings distinction (Lesson 9), price field mapping (Lesson 21), and image column routing (Lesson 5). Fix 3: Added `@fileoverview` JSDoc block to all 12 modules in `src/modules/`. Each block documents: one-line purpose, all exported functions/class methods with brief signatures, storage paths (if applicable), lesson cross-references, module dependencies (Uses), and callers (Called by). Files with existing headers (default-field-mapping.js, metadata-manager.js, denomination-normalizer.js, mintmark-normalizer.js) had headers replaced with proper @fileoverview blocks. Files without headers (opennumismat-db.js, numista-api.js, field-mapper.js, settings-manager.js, api-cache.js, cache-lock.js, progress-tracker.js, image-handler.js) had @fileoverview inserted before the require statements. Goal: Claude can now understand any module's purpose and API surface from a 5-line read instead of reading the entire file; IPC handler lookup no longer requires reading 3,420 lines of index.js. |
| Feb 16 | issuer-denomination-overrides.json (new), denomination-aliases.json, denomination-normalizer.js, main/index.js, main/preload.js, renderer/app.js, CLAUDE.md, docs/reference/PROJECT-REFERENCE.md | **Issuer-Aware Denomination Override System** - Implemented comprehensive fix for denomination search failures caused by language-specific singular/plural forms. Root cause: the same canonical denomination (e.g., "centesimo") has different plural forms in different countries â€” Italian "centesimi" vs Spanish "centÃ©simos". Accent-based differentiation is unreliable since users don't type accents. Solution: two-file architecture separating spelling normalization from search form selection. (1) `denomination-aliases.json` retains spelling variant â†’ canonical + DEFAULT plural (correct for majority issuer). Centesimo plural fixed to "centesimi" (Italian). (2) New `src/data/issuer-denomination-overrides.json` maps `canonical â†’ Numista issuer code â†’ { singular, plural }` override forms for exception cases â€” only countries that differ from the default are listed. Covers 6 denomination families: centesimo (Uruguay/Panama/Chile use centÃ©simos), centimo (Spain/Costa Rica/Venezuela/Paraguay use cÃ©ntimos), krone/koruna (Sweden uses kronor; Czech/Slovak/Czechoslovak use korun), lira (Turkey: lira/lira; Israel: lira/lirot), dinar (Yugoslavia/Serbia: dinara), real (Spanish colonial: reales). (3) `denomination-normalizer.js` loads override file and exports `ISSUER_DENOMINATION_OVERRIDES`. (4) `index.js` IPC handler `get-denomination-aliases` now includes `issuerOverrides` in response. (5) `preload.js` extracts and exposes `issuerOverrides` via `window.stringSimilarity`. (6) `app.js`: `buildSearchParams()` restructured to resolve issuer FIRST (before building denomination query) so issuer code is available when `normalizeUnitForSearch()` is called; `normalizeUnitForSearch(unit, value, issuerCode)` gains optional 3rd param â€” checks override table before falling through to denomination-aliases.json default; `buildCoreQuery(coin, issuerCode)` gains 2nd param and passes it through; Strategy 2 passes `baseParams.issuer` to `buildCoreQuery`; Strategy 4 primaryForm uses issuer code. Adding new country-specific overrides requires one JSON entry in issuer-denomination-overrides.json â€” no code changes. Added Lesson #28 and PROJECT-REFERENCE.md Denomination Architecture section documenting the two-file design rationale and data flow. |
| Feb 16 | denomination-aliases.json | **Centesimo Plural Fix** - Fixed Italy 10 Centesimi 1924 (and all Italian/Vatican centesimo coins) returning 0 search results on first attempt, falling through to broad "Italy centesimo" fallback that returned all centesimo types (1, 2, 5, 10) instead of the specific match. Root cause: `centesimo.plural` in denomination-aliases.json was `"centesimos"` (Spanish plural). Numista uses the Italian form `"centesimi"`. When `getSearchForm("centesimo", 10)` returned `"centesimos"`, the query `"10 centesimos 1924"` produced 0 results; Strategy 3 then fell back to `"Italy centesimo"` (singular, no value) returning 4 results. Fixed by changing plural to `"centesimi"` â€” first attempt now sends `"10 centesimi 1924"` which finds the correct single result. Aliases array unchanged so `"centesimos"` and `"centesimi"` as stored DB values both still normalize correctly. |
| Feb 16 | docs/guides/INSTALLER-DISTRIBUTION-PLAN.md, scripts/run-wack.ps1 (new) | **WACK Testing Added to Store Submission Workflow** - After noticing Windows App Certification Kit (WACK) testing was missing from our plan per Microsoft documentation (https://learn.microsoft.com/windows/uwp/debug-test-perf/windows-app-certification-kit), added comprehensive WACK pre-submission testing to Phase 2.5. Created automated `run-wack.ps1` PowerShell script that finds latest MSIX in dist/, locates WACK executable, runs all certification tests (5-10 min), parses XML results for quick pass/fail summary, and opens detailed HTML report in browser. Added "WACK Pre-Submission Testing" section documenting when to run WACK, what it tests (manifest, APIs, performance, security, package integrity), how to interpret results (PASSED/WARNING/FAILED), common failures and fixes (debug config, restricted APIs, performance, High DPI), and WACK limitations. Updated Store Submission Checklist to include WACK testing (marked as missed for Feb 16 submission since Microsoft's review runs same tests). Updated Update Workflow to include WACK as required step between build and Store submission for all future releases. First submission already done without WACK â€” Microsoft certification will catch issues if any exist. |
| Feb 16 | docs/download.md (new), docs/index.md, docs/_layouts/default.html, docs/_config.yml, README.md, docs/installation.md, docs/guides/INSTALLER-DISTRIBUTION-PLAN.md | **Microsoft Store Submission & Download Page** - MSIX package submitted to Microsoft for Store certification. Created dedicated `/download` page with platform-specific sections (Windows/macOS/Linux) using inline SVG logos and "Coming Soon" placeholders. Replaced emoji platform icons on homepage with real SVG platform logos (Windows 4-pane, Apple, Tux). Simplified homepage hero section (removed broken Store link, added Download button linking to new page). Simplified homepage download section to compact platform logo strip. Updated nav bar to link to `/download` page. Updated README.md Code Signing table (Store status: submitted for certification). Added Microsoft Store as "Coming Soon" option in installation guide. Updated INSTALLER-DISTRIBUTION-PLAN.md with Phase 6 (Website Download Page Restructuring) documenting all changes. |
| Feb 10 | docs/guides/POLAR-ENVIRONMENT-SWITCHING.md, docs/archive/POLAR-ENVIRONMENT-AND-LICENSE-UX-COMPLETE.md | **Polar Environment Switching Guide** - Created comprehensive guide for switching between Polar.sh sandbox and production environments. Documents exact configurations for both environments: sandbox (org ID: 5e78bbbd, product ID: 4f7d17ca, server: 'sandbox') and production (org ID: 52798f3d, product ID: 50fd6539, server: 'production'). Both environments use license prefix "TNSKV1-" configured in Polar dashboard. Guide includes step-by-step switching instructions for both directions (sandboxâ†’production and productionâ†’sandbox), file update locations (POLAR_CONFIG in index.js line ~2408, 6 checkout URLs in app.js lines 470/677/799/922/6140/6145), verification checklists for before/after production switch, and troubleshooting section covering license activation issues, validation counter problems, and checkout link errors. Completed all tasks in POLAR-ENVIRONMENT-AND-LICENSE-UX.md plan: Task 1 (environment guide), Task 2 (validation debugging - fixed logger path and added post-activation validate call), Task 3 (license entry UX - added form to App Settings), Task 4 (license versioning - TNSKV1- prefix already configured). Project now fully documented and ready for production deployment. Plan archived to docs/archive/ per CLAUDE.md Â§8. |
| Feb 10 | index.js, SETTINGS-CONSOLIDATION.md | **Settings File Consolidation** - Eliminated dual settings files (`settings.json` and `app-settings.json`) that caused redundancy and confusion. Root cause: `app-settings.json` was created to add cache configuration but duplicated existing fields (logLevel, supporter, eulaAccepted, windowBounds, recentCollections), causing maintenance burden and sync issues. Solution: Consolidated everything into `settings.json` as single source of truth. Updated `loadAppSettings()` to read from `settings.json` instead of `app-settings.json`, adding default `cache` structure and creating `cacheTtl` object from flat fields if needed. Updated `saveAppSettings()` to write to `settings.json` with proper merging to preserve all fields, maintaining flat `cacheTtlIssuers/Types/Issues` for backwards compatibility. Reversed migration in `migrateAppSettings()` to merge `app-settings.json` INTO `settings.json` (opposite direction from before), then archive as `.bak` file. All code now uses single `settings.json` with complete structure including cache config, API settings, license info, and UI state. Created comprehensive `docs/reference/SETTINGS-CONSOLIDATION.md` documenting the consolidation, settings structure, migration behavior, and developer guidelines. No more confusion about which file controls which settings. |
| Feb 10 | logger.js, index.js | **License Validation Debugging and Fixes** - Fixed two critical bugs preventing license validation tracking in Polar dashboard: (1) Logger was reading from wrong folder path - `logger.js` hardcoded folder name as `'NumiSync Wizard'` (from electron-builder productName) but actual userData folder is `'numisync-wizard'` (from package.json name in dev mode). This caused logger to fail loading `logLevel: "debug"` from settings.json at startup, defaulting to 'info' level and silently filtering out all `log.debug()` statements. Fixed by changing hardcoded path to match package.json name with explanatory comment. (2) Initial license activation never called validate endpoint - When user first entered license key, `validate-license-key` handler called `activate()` (correct) to register device, but never called `validate()` to increment Polar's validation counter, resulting in Polar dashboard showing "Validations: 0, Validated At: Never Validated" despite successful activation. Fixed by adding immediate post-activation `validate()` call with non-fatal error handling. Periodic validation (every 7 days) was already correctly implemented and working, but never triggered because initial validatedAt timestamp prevented it from running within first week. With both fixes, debug logging now works correctly, and license validation tracking in Polar dashboard works on first activation and every 7 days thereafter. |
| Feb 10 | index.html, app.js | **License Entry UX Improvement** - Fixed critical UX gap where users who purchased a license couldn't find where to enter it. License entry was only accessible through About dialog (Help menu or version badge click), not discoverable in Settings. Solution: Transformed License Management section in App Settings into a dual-state component that's always visible. When NO license exists, shows license entry form with password input field, "Activate License" button (with Enter key support), status messages, and "Purchase one here" link. When license EXISTS, shows license info table (device label, activation date, activation ID) with Validate/Deactivate buttons. Added three event handlers: license activation with loading states and 1.5s delay before UI refresh, Enter key triggering activation, and purchase link opening Polar checkout URL. Modified `loadLicenseManagementDisplay()` to toggle between entry form and info display based on license status, defaulting to entry form on API errors. HTML changes: removed `display: none` from `licenseManagementGroup`, added `licenseEntryForm` div with input/button/message elements, added `display: none` to `licenseInfoDisplay` and `licenseActions` for initial state, moved help text to separate paragraph with ID for show/hide control. Users can now easily enter license keys directly in Settings without hunting for the About dialog. |
| Feb 10 | .github/workflows/, build/, scripts/, src/main/, src/renderer/, electron-builder.yml, package.json, README.md, docs/ | **Cross-Platform Distribution Implementation (Phases 3-5, 1.5)** - Completed installer distribution plan: (1) Phase 3: GitHub Actions CI/CD - Created automated build workflows for Windows/Linux/macOS with version validation, SignPath integration prepared (commented until approval), and draft release creation. (2) Phase 4: Linux Support - Generated 7 multi-resolution PNG icons (16x16-512x512) via PowerShell script, configured AppImage/deb/rpm targets in electron-builder.yml. (3) Phase 5: macOS Support - Generated .icns icon via png2icons npm package, created comprehensive unsigned macOS installation guide (docs/macos-install.md), configured DMG targets for x64+arm64. (4) Phase 1.5: License Versioning - Implemented version-based feature gating system with V1/V2/V3 prefix detection, FEATURE_VERSIONS map, license version extraction (getLicenseVersion), semantic version comparison, IPC handler (check-feature-access), and renderer-side feature gating (checkFeatureAccess, showUpgradeModal). Users with v1 licenses can use v1 features; v2 features require purchasing v2 license. Added Code Signing Policy section to README.md (required by SignPath Foundation). Added build:mac, build:linux, build:all scripts to package.json. Updated INSTALLER-DISTRIBUTION-PLAN.md with completion status and implementation summary. Project now fully configured for automated cross-platform releases - only external dependency is SignPath Foundation application (Phase 2). |
| Feb 10 | app.js, index.html | **Cache Collision Detection UI Fixes** - Fixed two critical issues: (1) Collision detection was running on every settings save instead of only when cache location changes - added `AppState.currentCacheSettings` tracking and location comparison logic to only trigger checks when location actually differs. (2) Modal UI didn't match app design - restructured both modals to use standard modal-header/modal-body/modal-footer with proper button classes and close button handlers. Archived CACHE-COLLISION-DETECTION-PLAN.md as complete per CLAUDE.md Â§8. |
| Feb 10 | cache-lock.js, index.js, preload.js, index.html, app.js, FILE-LOCATIONS.md | **Cache Collision Detection and Multi-Instance Handling** - Added collision detection when configuring custom cache locations to prevent silent cache overwrites in multi-machine setups. When user selects a custom cache location that already contains cache files, the app now detects this and presents a modal offering to "Use Existing Cache" (recommended for multi-machine scenarios) or "Select Different Location". Detects and handles active cache locks - if another NumiSync Wizard instance is using the cache, shows a "Cache Locked" modal with retry option and lock owner information (hostname, process ID, timestamp). Stale locks (>5 minutes old) are automatically cleaned up. Cache metadata (entry count, size, last modified) is displayed in the collision modal to help users make informed decisions. Added two static utility methods to `CacheLock` class: `checkCacheLockStatus()` returns lock status (none/unlocked/stale/locked) and lock owner info, `getCacheMetadata()` returns cache file stats and validity. Enhanced `validate-cache-path` IPC handler to include collision detection results in response. Updated `migrate-cache` handler to accept `useExisting` parameter that skips migration when user chooses to use existing cache. Added collision detection modals to index.html with user-friendly messaging and multi-machine tips. Implemented collision-aware settings save flow in app.js with `handleCacheLocationChange()`, `showCacheCollisionModal()`, `showCacheLockedModal()`, and `saveCacheLocationSettings()` functions. Updated FILE-LOCATIONS.md with Cache Collision Detection section documenting all scenarios, multi-instance workflow, and troubleshooting for "Cache is locked" errors. Prevents data loss and improves UX for users sharing caches across multiple machines via network drives. |
| Feb 10 | index.html, app.js, index.js, preload.js | **Cache Location Settings UI Refactoring** - Removed standalone cache location modal and integrated cache location settings into the main Settings screen for better UX consistency. Cache location now appears as a section in Settings between "API Cache" and "Logging" with radio buttons for Default/Custom location, browse button with path validation, and lock timeout configuration. On first install, cache is automatically created in the default location with no user intervention required. Users can optionally change cache location from Settings - when changed, existing cache files are automatically migrated to the new location. Fixed IPC handler path issues (`validate-cache-path` simplified to only check write permissions without requiring cache-lock module). Added `migrate-cache` IPC handler that copies cache files when location changes. Removed `restart-app` handler (not needed - cache reinitializes on next API call). Settings now save without requiring app restart. Fixes module not found errors on startup and improves overall user experience by following app's existing design patterns. |
| Feb 9 | cache-lock.js (new), api-cache.js, settings-manager.js, progress-tracker.js, opennumismat-db.js, index.js, preload.js, index.html, app.js, FILE-LOCATIONS.md (new), PROJECT-REFERENCE.md | **Storage Architecture Reorganization** - Reorganized all file storage to improve multi-machine workflows and prepare for uninstaller. COLLECTION-SPECIFIC FILES now organized in `.NumiSync/` subdirectory next to .db file (cleaner, hidden on Mac/Linux): settings moved from `{name}_settings.json` to `.NumiSync/{name}_settings.json`, progress renamed from `{name}_enrichment_progress.json` to `.NumiSync/{name}_progress.json` (shorter), backups moved from `backups/` to `.NumiSync/backups/` with human-readable timestamps (`YYYY-MM-DD_HHMMSS` instead of ISO format). APP-WIDE FILES renamed for clarity: `settings.json` â†’ `app-settings.json` (v3.0 structure with cache config), `numista_api_cache.json` â†’ `api-cache.json`. NEW FEATURES: (1) Configurable cache location - users can point cache to shared network drive for multi-machine scenarios, avoiding duplicate API calls across computers accessing same .db file. (2) File locking (`api-cache.lock`) prevents cache corruption when multiple machines access shared cache simultaneously using atomic lock file creation with 30-second timeout and 5-minute stale lock detection. (3) Cache Location Settings UI modal with location radio buttons (default/custom), browse dialog, path validation (write permission + lock support test), and lock timeout configuration. All migrations are automatic and silent on first launch (old files preserved for safety). Created `cache-lock.js` module with `CacheLock` class for atomic file-based locking. Updated `api-cache.js` to use async locking on all write operations (`set()`, `incrementUsage()`, `setMonthlyLimit()`, `setMonthlyUsageTotal()`, `clear()`). Updated `getApiCache()` to support custom cache paths with fallback to default on initialization errors. Added 5 IPC handlers: `get-cache-settings`, `set-cache-settings`, `browse-cache-directory`, `validate-cache-path`, `restart-app`. Created comprehensive `docs/reference/FILE-LOCATIONS.md` documenting all file locations, platform-specific paths, uninstaller recommendations, migration notes, and manual cleanup procedures. Updated PROJECT-REFERENCE.md Storage Architecture section with new v3.0 structure. |
| Feb 9 | docs/ | **Version 2 Work Plan Created** - Archived PHASE3-WORK-PLAN.md to `docs/archive/PHASE3-WORK-PLAN-COMPLETE.md` per CLAUDE.md Â§8. Created VERSION2-WORK-PLAN.md consolidating incomplete Phase 3 tasks (3.1-3.7 OAuth & Numista Sync features) plus deferred tasks (3.8.3 Auto-Update Check, 3.10 Multi-Source Fetching, 3.11 Plugin Integration) into new work plan. Tasks renumbered 2.1-2.10. Completed Phase 3 tasks remain: 3.0 Application Menu Bar, 3.8 About/Licensing (partial), 3.9 Fast Pricing Update ðŸ’Ž, 3.12 Auto-Propagate ðŸ’Ž. Version 2 will implement core Numista sync functionality (one-way OpenNumismat â†’ Numista collection upload with OAuth 2.0, data mapping, batch operations). |
| Feb 9 | docs/ | **Task 2.3 Advanced Field Mapping - COMPLETE** - Comprehensive audit confirms all 6 implementation steps from Advanced-Field-Mapping-PLAN.md are complete: (1) NUMISTA_SOURCES registry with 45+ source definitions in `default-field-mapping.js`, (2) `buildFieldMapperConfig()` in `settings-manager.js` to translate user settings to FieldMapper config, (3) Gap fixed - all 3 FieldMapper instantiations now use `settingsManager.buildFieldMapperConfig()`, (4) 6 IPC handlers + preload bridge methods for field mapping management, (5) Tabbed UI in Data Settings modal with Field Mappings tab, source dropdowns, bulk enable/disable, filter toolbar, export/import/reset capabilities, (6) CSS styles for tabs, wide modal, field mapping table. Feature completed February 2, 2026. Plan archived to `docs/archive/Advanced-Field-Mapping-PLAN-COMPLETE.md` per CLAUDE.md Â§8. |
| Feb 9 | index.js, app.js, numista-api.js, progress-tracker.js | **Pre-Release Audit Bug Fixes** - Comprehensive audit of search, retrieval, and auto-propagation system found 6 issues. (1) CRITICAL: Fast Pricing grade-to-price mapping was reversed vs normal merge flow - `price1` was mapped to Fair instead of Uncirculated, `price4` to Uncirculated instead of Fair. Every coin updated via Fast Pricing had prices swapped. Fixed mapping to match `field-mapper.js` convention: `price1=UNC, price2=XF, price3=VF, price4=F`. (2) CRITICAL: `applyBatchTypePropagation()` determined skip reasons using `duplicates[0].coin` (a matching collection coin) instead of the enriched source coin. When `duplicates` was empty, `enrichedYear` became `null` and ALL same-type coins showed "Different year". Fixed by passing `enrichedCoin` through the result object from `showBatchTypePropagationPrompt()` and using it for year/mintmark comparison. (3) HIGH: `get-coin-details` IPC handler did not parse metadata from the note field, while `get-coins` did. Any downstream code accessing `coin.metadata` after `get-coin-details` got `undefined`. Added metadata parsing matching `get-coins` behavior. (4) MINOR: Manual search issuer resolution failure was silently caught with empty `catch (e) {}`. Added `console.warn` logging for non-fatal issuer resolution failures. (5) MEDIUM: Removed dead `buildSearchQuery()` method from `NumistaAPI` class - leftover from old approach that appended `coin.country` directly to query text. All callers now use `buildSearchParams()` in renderer with the `issuer` parameter. (6) LOW: `loadProgress()` initial structure was missing `skipped: 0` in per-datatype stats (`basicData`, `issueData`, `pricingData`), while `resetStatistics()` included it. Added `skipped: 0` to all three for consistency. |
| Feb 9 | index.js | **Auto-Propagate Mint Resolution Fix** - Fixed two bugs preventing recent mint resolution and array-join fixes from carrying through auto-propagation. (1) `mint` field was missing from `typeLevelFields` in `propagate-type-data` IPC handler, so even when the user selected `mint` in the comparison screen it was silently dropped during batch propagation. Added `mint` to the allowed type-level fields list. (2) `mergeFields()` call in `propagate-type-data` did not pass `coinData` (the target coin's mintmark), so `resolveMintName()` in `mapToOpenNumismat()` could not fall back to the coin's `.db` mintmark when `issueData.mint_letter` was unavailable. For "same type, different issue" coins where `issueData` is null, this caused mint resolution to fall through entirely to `transformMintName()` which picks `mints[0]` â€” the old buggy behavior. Now passes `{ mintmark: currentCoin.mintmark }` matching how `merge-data` already does it. The `transformRulerPeriod()` fix (array join with deduplication) carries through automatically since it changed the transform function in `default-field-mapping.js` used by both paths. |
| Feb 9 | index.js | **Remember Window Position & Size** - App now saves window position, size, and maximized state to `settings.json` on close and restores them on next launch. Uses Electron's `screen.getAllDisplays()` to validate saved position is still on a connected monitor â€” gracefully falls back to default 1400x900 centered if the saved monitor is disconnected. Tracks pre-maximized bounds separately so unmaximizing after restore returns to the correct size/position. |
| Feb 9 | mintmark-normalizer.js, field-mapper.js, default-field-mapping.js, index.js, app.js | **Mint Name Resolution from Mint Letter** - Fixed mint field always picking first entry from type's `mints` array (e.g., "United States Mint of Philadelphia") regardless of which mint actually produced the coin. The `mint` field is MAIN data from the type endpoint, which returns ALL mints for a coin type. Previously `transformMintName()` blindly returned `mints[0].name`. Now correlates the mint letter (from issue data's `mint_letter` or the coin's .db `mintmark` as fallback) with the correct mint name using three strategies: (1) direct `letter` field match on mint objects, (2) reverse lookup via `US_MINT_MAP`/`WORLD_MINT_MAP` city-name maps, (3) parenthetical letter match. Added `resolveMintName()` to mintmark-normalizer.js, mint special-case block in field-mapper.js `mapToOpenNumismat()`, and `coinData` parameter threading through `compareFields`/`mergeFields`/`merge-data` IPC handler. When mint is resolved from a letter, the comparison screen pre-checks the mint field box via new `recommendUpdate` flag propagated through the comparison pipeline to `createDefaultSelection()`. Falls back to first mint when no mint letter is available. General transform in `mapToOpenNumismat()` now skips `mint` field (handled entirely in special case) to prevent `transformMintName()` from re-processing the resolved string value. |
| Feb 9 | default-field-mapping.js | **Ruler Period Array Join** - Fixed `transformRulerPeriod()` picking only the first ruler's dynasty/group (`value[0].group.name`), same `[0]`-picking pattern as the mint bug. Now joins all unique group names with `' / '` separator, matching the convention used by `transformRulerNames()`, `transformDesigners()`, and `transformEngravers()`. Deduplication via `Set` ensures co-rulers sharing the same dynasty produce a single value while different dynasties are preserved. |
| Feb 9 | app.js, index.js, numista-api.js | **Structured Search Query + Issuer Hierarchy Fix + Search Pagination + Manual Search Issuer + Coin List Fallback** - Fixed automatic searches wasting API calls and returning wrong results due to two issues: (1) `buildSearchParams()` used `coin.title` as the primary query source, passing un-normalized denomination plurals (e.g., "Crowns" instead of "Crown") that Numista cannot resolve. Restructured to build queries from structured fields first (`coin.value` + `normalizeUnitForSearch(coin.unit)` + `coin.year`), falling back to title only when structured fields are missing. Title fallback strips country name and applies `normalizeDenominationInQuery()`. Removed hardcoded `count: 20` to use the API default of 50. (2) `resolveIssuerCode()` used `.find()` which returned the first matching issuer â€” the section-level parent (e.g., "United Kingdom" group including Falkland Islands, Gibraltar) instead of the specific country. Numista's `/issuers` API returns a hierarchy with `level` (1-5) and `parent` fields. Fixed to use `.filter()` + pick highest `level` for exact matches, and prefer higher-level issuers in fuzzy matching. This eliminated territory coins polluting search results. Added search results pagination: when API returns more than 50 results (the per-page max), a "Load More Results (showing X of Y)" button appears at the bottom of the match list. Each click fetches the next page (1 API call) and appends results. Pagination state tracked in `AppState.searchPagination` across both automatic and manual search paths. Also added issuer filter to manual searches via `resolveIssuer()` passed to `manual-search-numista` backend handler (which now accepts `page` parameter). Added `buildCoinDisplayLabel()` fallback for coin list â€” shows denomination from structured fields (e.g., "1 Crown") instead of "(Untitled)" when title is empty. |
| Feb 8 | preload.js, numista-api.js, denomination-normalizer.js, denomination-aliases.json | **Unicode Normalization Fix for Match Confidence Scoring** - Fixed accented denomination names (e.g., Swedish "Ã–re", Czech "HalÃ©Å™Å¯") causing ~45-point scoring penalty due to Unicode NFC vs NFD mismatch. When OpenNumismat stores "Ã¶" as a single precomposed character (NFC, U+00F6) but Numista API returns it as base letter + combining diaeresis (NFD, U+006F+U+0308), string comparison fails even though characters render identically. Added `normalize('NFC')` to both `diceCoefficient()` functions (preload.js and numista-api.js) for consistent bigram generation. Added accent-stripping fallback to both `normalizeUnit()` functions (preload.js and denomination-normalizer.js): first tries NFC-normalized lookup in alias map, then strips diacritics via NFD decomposition + combining mark removal and retries. This maps "Ã¶re"â†’"ore", "cÃ³rdoba"â†’"cordoba", etc. automatically. Added "Ã¶re" as explicit alias for "ore" in denomination-aliases.json. All changes are local string operations â€” zero additional API calls. |
| Feb 8 | denomination-aliases.json, issuer-aliases.json (new), numista-api.js, denomination-normalizer.js, default-field-mapping.js, index.js, preload.js, app.js | **Heller/HalÃ©Å™Å¯ Cross-Referenced Denomination + Issuer Alias Extraction + Unicode Unit Fix** - Fixed Bohemia and Moravia coins returning 0 search results because Numista uses "HalÃ©Å™Å¯" (Czech) not "Heller" (German) in coin titles, and the API doesn't cross-match them. Solution: denomination-aliases.json now supports cross-referenced entries â€” "heller" and "halÃ©Å™" each list the other's aliases, creating bidirectional equivalence. The normalizer builds an `allCanonicalsMap` tracking every canonical a given alias belongs to. New `getAlternateSearchForms()` function returns all variant search forms (e.g., both "hellers" and "halÃ©Å™Å¯"). New search Strategy 4 in `searchForMatches()`: when strategies 1-3 return 0 results and the denomination has alternate forms, retries with each alternate. Also extracted hardcoded `ISSUER_ALIASES` from numista-api.js into `src/data/issuer-aliases.json` for easier maintenance. Added "Bohemia and Moravia" / "Protectorate of Bohemia and Moravia" / "BÃ¶hmen und MÃ¤hren" as issuer aliases (code: `boheme_moravie`). Fixed `transformValueUnit()` regex using ASCII-only `[A-Za-z]` which failed to extract unit from "10 HalÃ©Å™Å¯" (accented characters). Changed to Unicode-aware `[\p{L}]+$/u` to match any language's letters. |
| Feb 8 | denomination-aliases.json, denomination-normalizer.js, index.js, preload.js, app.js | **Denomination Plural/Singular Support + Missing Currencies** - Restructured denomination-aliases.json from flat arrays to `{ aliases: [...], plural: "..." }` object format with explicit plural forms for every denomination. Numista search is strict about singular vs plural ("1 centavo" matches, "1 centavos" does not). Previously `normalizeUnitForSearch()` used a flawed heuristic (check if input ends in 's', re-add 's' after normalization) which failed for non-English plurals (sol/soles, leu/lei, lira/lire) and misidentified singular words ending in 's' (fils, lats). New approach: `getSearchForm(canonical, numericValue)` uses the coin's numeric value to select the correct form â€” value=1 returns singular, value!=1 returns explicit plural from PLURAL_MAP. Updated `loadAliases()` to build both ALIAS_MAP and PLURAL_MAP from new JSON structure. IPC handler sends both maps to renderer. Added `normalizeDenominationInQuery()` for manual search: parses free-text for `<number> <denomination>` patterns and corrects plurality before sending to Numista API. Shows user the corrected query when normalization changes the input. Added ~40 missing UN-recognized currency denominations with researched alternate spellings: lek/qintar, dram/luma, manat/qapik, taka/poisha, ngultrum/chetrum, fening, riel, gourde, kip/att, lempira, quetzal, cordoba, rufiyaa/laari, metical, nakfa, somoni/diram, togrog/mongo, hryvnia, sum/tiyin, som/tyiyn, tenge/tyin, lari/tetri, balboa, sentimo, sente/lisente, khoums, iraimbilanja, and more. Added missing plural forms to all existing entries (cents, centavos, francs, dollars, pounds, etc.). |
| Feb 8 | logger.js (new), updater.js, index.js, preload.js, app.js, index.html, user-manual.html, numista-api.js, opennumismat-db.js, field-mapper.js, progress-tracker.js, metadata-manager.js, settings-manager.js, api-cache.js, image-handler.js, freshness-calculator.js | **Structured Logging, Support Workflow & Report an Issue** - Migrated all 383 `console.*` statements across 13 main-process/module files to `electron-log` via new centralized `src/main/logger.js` module. Each module uses scoped loggers (e.g., `[Database]`, `[NumistaAPI]`). Log levels mapped: `console.error` -> `log.error`, `console.warn` -> `log.warn`, operational milestones -> `log.info`, verbose traces -> `log.debug`. Renderer `console.*` captured automatically via `spyRendererConsole`. Added user-configurable log level setting in App Settings (error/warn/info/debug, default: info) with runtime switching. Added "Download Log File" button in Settings and "Report an Issue" modal (Help menu) with links to User Manual, GitHub Issues, and log download. New `export-log-file` IPC handler copies log to user-chosen location via Save As dialog. Log file: `%APPDATA%/NumiSync Wizard/logs/numisync-wizard.log` (5MB max, auto-rotated). Emoji characters in opennumismat-db.js and field-mapper.js replaced with ASCII equivalents (`[OK]`, `[MISMATCH]`, `[SKIP]`). User manual updated with new "Getting Help" section (section 18). |
| Feb 8 | denomination-aliases.json, app.js, numista-api.js | **Euro Denomination Scoring Fix** - Fixed "Euro Cents" results scoring higher than "Euro" results when matching coins with unit="Euro" but no numeric value. Three root causes: (1) Numista search API doesn't return `value` in results, so code falls back to title regex which only captured single-word units (`/^[\d.]+\s*[a-zA-Z]+/` â†’ "2 Euro" from "2 Euro Cents"), losing the "Cents" distinction. Fixed regex to capture up to first separator (`/^[\d.]+\s*[^-â€“(,]+/` â†’ "2 Euro Cents"). (2) When coin has unit but no numeric value, denomination scoring was entirely skipped. Added unit-only comparison branch: +15 for unit match, -10 for mismatch. (3) "Euro" and "Euro Cent" were missing from denomination aliases. Added euro section with variants (euro/euros/eur, euro cent/euro cents/eurocent). |
| Feb 8 | numista-api.js, index.js | **Session Counter Accuracy Fix** - Session counter in `fetch-coin-data` and `fetch-issue-data` IPC handlers was heuristically counting API calls based on which data types were requested, overcounting by 1 when `getType()` or `getTypeIssues()` returned from persistent cache instead of making a real HTTP call. Added `apiCallCount` property to NumistaAPI class, incremented in `request()` only on actual HTTP calls. IPC handlers now read `api.apiCallCount` instead of guessing. Session counter and monthly counter now always agree. |
| Feb 8 | api-cache.js (new), numista-api.js, index.js, preload.js, app.js, index.html, user-manual.html | **Persistent API Cache, Search Simplification & Monthly Usage Tracking** - New persistent disk cache (`numista_api_cache.json` in userData) stores issuers (90d default), type data (30d), and issue data (30d) across sessions. Eliminates redundant API calls â€” e.g., issuers list no longer re-fetched on every app launch. All 8 NumistaAPI instantiation points in index.js now pass persistent cache + user-configured TTLs. Usage tracking: `request()` auto-increments per-endpoint monthly counters; footer shows "Month: X/2,000" with color warnings at 75%+ and 90%+. Search simplification: `buildSearchParams()` now strips parentheticals from title and country upfront, Strategy 2 (parenthetical retry) removed â€” worst-case search drops from 4 to 3 API calls. New App Settings section: per-data-type cache TTL selects (30-360 days or "No caching"), monthly API limit, manual usage adjustment input, Numista dashboard link, Clear Cache button. New IPC handlers: `get-monthly-usage`, `set-monthly-usage`, `set-monthly-usage-total`, `clear-api-cache`. User manual updated with section 19 covering cache, settings, usage tracking, and Numista quota. |
| Feb 8 | numista-api.js | **Issue Matching Gregorian Year Fix** - Fixed issue picker showing all dates instead of just matching issues for coins using non-Gregorian dating (e.g., Japanese Meiji era). `matchIssue()` year filter was only checking the `year` field (era-specific, e.g., 14 for Meiji 14) but not `gregorian_year` (e.g., 1881). A coin with year 1881 matched zero issues because no issue has `year: 1881`. Now checks both `i.year` and `i.gregorian_year` against the user's year, correctly filtering to the 2 matching issues for 1881 Japan 1 Sen. |
| Feb 8 | app.js | **Auto-Propagate Cross-Country Catalog Fix** - Fixed auto-propagate falsely matching coins from different countries that share the same non-Numista catalog number (e.g., KM#132 exists in both USA and France). Non-Numista catalog systems (KM, Schon, Yeoman) reuse numbers across countries, so catalog-based matching now requires country/issuer validation. Added `countriesMatch()` helper with bi-directional includes for name variations. Numista ID matching (Priority 1) is unaffected since Numista IDs are globally unique. Coins with empty country fields are skipped for non-Numista catalog matches since their country cannot be verified. |
| Feb 8 | settings-manager.js, app.js | **Remember View State on Close** - App now remembers the current page, scroll position, filters (status, freshness), and sort settings when closed. On next launch with a default collection, the coin list restores to the same page/position/filters/sort the user left off at. State is saved per-collection via `uiPreferences.lastViewState` and persisted on each page/filter/sort change (debounced) plus on window close. View state is restored in `loadCollectionScreen()` before `loadCoins()` so the first render uses saved state. Reset Filters button clears saved state. |
| Feb 8 | app.js, main.css | **Issue Picker Pre-Selection** - When re-enriching a coin that already has issue data, the issue picker modal now pre-selects the previously chosen issue (radio checked, row highlighted) and shows a blue "PREVIOUS SELECTION" badge. The "Apply Selection" button is immediately enabled. Users can still change their selection. First-time enrichments are unaffected. |
| Feb 8 | denomination-aliases.json, index.js, preload.js, app.js | **Pence/Penny Alias Fix + Alias Deduplication** - Fixed "Pence" being aliased to "penny" which broke search for all Pence-denominated coins (e.g., Ireland 20 Pence 1998 returned medieval half-pennies instead of correct results). Split "pence" into its own canonical group since Numista treats Pence and Penny as distinct denominations. Eliminated 90-line hardcoded alias map duplication in preload.js by loading aliases from main process via `ipcRenderer.sendSync('get-denomination-aliases')` at startup â€” `denomination-aliases.json` is now the single source of truth. Added defensive duplicate check in `buildSearchParams()` that compares both normalized and original denomination forms against the title before appending, preventing contradictory search terms. |
| Feb 7 | EULA.txt, eula-windows.rtf, installer.nsh, updater.js, validate-version.js, post-version.js, package.json, electron-builder.yml, index.js, preload.js, app.js | **Installer Distribution Phase 1** - EULA in NSIS installer (RTF license screen + marker file for skipping in-app EULA), auto-update module (electron-updater + electron-log with manual "Check for Updates" menu item), version bump scripts (preversion validation, postversion reminders), installer EULA marker detection in checkEulaOnStartup(). New files: EULA.txt (plain text), build/eula/eula-windows.rtf, build/installer.nsh (creates/removes marker), scripts/validate-version.js, scripts/post-version.js, src/main/updater.js. Modified: package.json (build:win, version scripts, electron-updater/electron-log deps), electron-builder.yml (EULA license screen, NSIS include), index.js (updater import, IPC handlers, menu item), preload.js (checkInstallerEulaMarker, checkForUpdates channels), app.js (installer marker check before in-app EULA). |
| Feb 7 | denomination-aliases.json, denomination-normalizer.js, numista-api.js, preload.js, app.js | **Denomination Alias Normalizer** - Added denomination normalizer module to fix unit matching failures for transliteration/spelling variants. Coins with "kopeks" vs Numista "Kopeck" (dice=0.6, below 0.7 threshold) now match via alias lookup, fixing a 45-point scoring swing (-20 penalty to +25 bonus). External JSON alias file covers 100+ denominations across 16 regional groups. Main process uses `denomination-normalizer.js` module; renderer uses inlined copy in `preload.js` (Electron 28 sandbox prevents `require('fs')`). Search queries normalize spelling via `normalizeUnitForSearch()` while preserving plurality (Numista search is singular/plural sensitive: "kopeck" returns 0 results, "kopecks" finds matches). Three search builders updated: `buildSearchParams`, `buildCoreQuery`, `buildMinimalQuery`. Dice coefficient fallback preserved for unlisted denominations. |
| Feb 8 | default-field-mapping.js, field-mapper.js, app.js, main.css | **Field Comparison Consistent Ordering** - Fields in "Review and Select Fields" screen now display in consistent order grouped by category matching Data Settings API toggles. Added `category` (main/issue/pricing) and `displayOrder` properties to all 33 field definitions. Sort logic sorts by category then displayOrder. Category headers ("Type Data", "Issue Data", "Pricing Data") only appear when multiple categories are present (e.g., after fetching issue or pricing data) - no headers when only type data is shown. |
| Feb 8 | opennumismat-db.js | **Edge Image Display Fix** - Fixed edge images not displaying in field comparison "Current" column even when present in database. `getCoinImages()` was returning `edge: null` hardcoded. Now properly fetches edge image from photos table using `coin.edgeimg`. |
| Feb 8 | opennumismat-db.js | **Image Column Update Fix** - Fixed downloaded images not being linked to coins. `updateCoinImages()` was calling `updateCoin()` which blocked protected fields (obverseimg/reverseimg/edgeimg). Now uses direct SQL UPDATE to bypass protection when setting valid photo IDs. |
| Feb 8 | app.js, main.css | **Inline Image Field Previews** - Replaced separate "Image Comparison" section with inline image previews in the obverseimg/reverseimg/edgeimg field rows. Each image field now shows Current vs Numista images side-by-side (80x80px, hover to zoom 2.5x). Removed redundant "Download Images to Collection" button since images are now auto-downloaded when image fields are selected during merge. |
| Feb 7 | index.js | **Auto-Download Images on Merge** - When image fields (obverseimg, reverseimg, edgeimg) are selected in field comparison and user clicks "Apply Changes", images are now automatically downloaded from Numista and stored in the photos table. Previously users had to use a separate "Download Images" button. URLs are fetched from numistaData.obverse/reverse/edge.picture, downloaded via imageHandler, and stored via storeImagesForCoin(). |
| Feb 7 | main.css | **Fetch More Data UI Overflow Fix** - Fixed "Additional Data Available" section buttons being clipped on narrow screens. Added flex-wrap, proper min-width, and overflow handling to fetch-more-card and fetch-more-data-section. |
| Feb 7 | app.js, image-handler.js | **Edge Image URL Fallback** - Fixed edge images not downloading because Numista API uses `edge.picture` (nested) instead of `edge_thumbnail` (top-level). Added fallback from `edge_thumbnail` to `edge.picture` in handleImageDownload() and image-handler.js. |
| Feb 7 | opennumismat-db.js | **Image Storage Table Fix** - Fixed downloaded images not appearing in OpenNumismat. Images were being stored in the `images` table but `obverseimg`/`reverseimg`/`edgeimg` columns reference the `photos` table. Added `insertPhoto()` method and updated `storeImagesForCoin()` to use photos table. |
| Feb 7 | app.js, numista-api.js | **Numista ID Perfect Match** - Search results now show 100% confidence for coins that were previously enriched with the same Numista type. Checks `coin.metadata.basicData.numistaId` against search result `id` field. Ensures previously matched coins appear at top of search results. |
| Feb 7 | app.js | **Edge Image Download Fix** - Fixed edge images not being downloaded when clicking "Download Images". The `edge_thumbnail` from full type data was being overwritten with `undefined` from search results (which don't include edge thumbnails). Now preserves the edge_thumbnail from basicData. |
| Feb 6 | app.js | **Premium Features Advertising Update** - Updated license prompt modal and EULA to list both premium features: Fast Pricing Mode and Auto-Propagate. License prompt now shows feature names with descriptions. EULA Section 3(b) now mentions both batch pricing updates and batch type data propagation. |
| Feb 6 | user-manual.html, TASK-3.12, PHASE3-WORK-PLAN.md | **Task 3.12 Documentation Complete** - Added Auto-Propagate section to user manual with full feature documentation (how it works, what data gets propagated, matching criteria, skipped coins, disabling the feature). Updated License Tiers table to include Auto-Propagate. Updated FAQ with premium feature list. Marked Task 3.12 as fully complete in task document and work plan. |
| Feb 6 | app.js | **Auto-Propagate Progress Bar** - Added inline progress bar to batch type propagation modal. Shows "X/Y (Z%)" format with visual progress bar during operation, matching Fast Pricing Mode UX. Displays current coin being processed. Modal transitions to results view when complete. |
| Feb 6 | app.js | **Match List Scroll Fix** - Fixed matching coins list not returning to top when selecting a new coin. Added scroll-to-top logic in showScreen() when transitioning to match screen, ensuring `.app-main` container resets to top position. |
| Feb 6 | index.js, app.js | **Auto-Propagate Field Selection Fix** - Fixed auto-propagate overwriting fields that weren't selected for the original merge. Previously, propagate-type-data hardcoded all type-level fields to `true`. Now passes `selectedFields` from the original merge through the propagation flow (`showBatchTypePropagationPrompt` â†’ `applyBatchTypePropagation` â†’ `propagateTypeData` IPC). Handler now only propagates fields the user explicitly checked. Added skip logic for coins when no applicable fields are selected. |
| Feb 6 | index.js, app.js | **Auto-Propagate Bug Fix** - Fixed auto-propagate prompt not appearing after enrichment. Issue 1: `get-coins` IPC handler now parses metadata from note field so coins have `metadata.basicData.numistaId` available for matching. Issue 2: Fixed wrong fallback defaults in `getCatalogSlotMapping()` - was using 'Krause'/'Numista'/null/null, now correctly uses 'KM'/'SchÃ¶n'/'Y'/'Numista' to match default-field-mapping.js and Numista API catalog codes. |
| Feb 6 | app.js, numista-api.js | **Coin Match Scoring Improvements** - Fixed broken denomination matching (was comparing numeric 1 vs 0.01, now uses text comparison). Added progressive search fallback for zero-result queries (strips parenthetical terms like "(Nazi)", tries simplified queries). Rebalanced scoring weights: Title 30pts, Year 25pts (+bonus) or -15pts (penalty for out-of-range), Country 20pts, Denomination 25pts (match) or -20pts (mismatch), Category +10pts (standard circulation) or -10pts (patterns/proofs). Fixed "1 Cent" vs "1 Dime" false match (same numeric value but different units now penalized). Extracts denomination from title as fallback when value.text missing from API response. |
| Feb 6 | settings-manager.js, app.js, index.html, TASK-3.12 | **Task 3.12.11 Auto-Propagate Toggle** - Added checkbox in Data Settings to enable/disable the Auto-Propagate feature (default: enabled). When disabled, the post-merge detection prompt is skipped. Updated PREMIUM_FEATURES name to "Auto-Propagate" for consistent user-facing terminology. Setting persists via fetchSettings.enableAutoPropagate. |
| Feb 6 | index.js, numista-api.js, app.js, index.html, main.css | **Task 3.12 Completion** - Silent Type Data Reuse (3.12.4): Added typeDataCache Map in main process, caches type data by typeId, cleared on collection load, skips API calls for previously fetched types. Empty Mintmark Setting UI (3.12.7): Added radio buttons in Data Settings for empty mintmark interpretation (no_mint_mark/unknown). Issue/Pricing Matching (3.12.8): matchIssue() now accepts options with emptyMintmarkInterpretation, detects privy marks and signatures in issues, returns privyMarksDetected/signaturesDetected flags. Skipped Coins Handling (3.12.9): Enhanced applyBatchTypePropagation() with detailed tracking of full-data vs type-only updates, skip reasons stored in batchProcessed metadata, improved results modal showing skip list with reasons. |
| Feb 6 | app.js, main.css, index.js, preload.js, settings-manager.js, PHASE3-WORK-PLAN.md | **Task 3.12 Batch Type Data Propagation (PREMIUM)** - After enriching a coin, detects other coins in the collection sharing the same Numista type (via numistaId or catalog numbers). Shows matching coins grouped into True Duplicates (same type+year+mintmark - can receive ALL data) and Same Type/Different Issue (type data only). Detection is FREE; applying to all matching coins requires premium license. Implements strict catalog matching (ALL populated slots must match), normalizeCatalogNumber() for prefix stripping, categorizeMatchingCoins() for duplicate detection. Adds propagate-type-data IPC handler for batch database updates. Adds emptyMintmarkInterpretation setting (no_mint_mark/unknown). Premium modal with gold gradient styling. |
| Feb 5 | index.html, app.js, main.css | **Header Consolidation** - Merged collection controls into main app header. Collection title now displays centered in header when collection is open. Combined "App Settings" and "Data Settings" into a single gear icon dropdown button (saves header space). Fast Pricing Mode and Close Collection buttons moved to header actions area. Removed separate collection-header section from collection screen for cleaner layout. |
| Feb 5 | index.html, app.js, main.css, settings-manager.js | **Sticky Info Bar Toggle** - Stats and filters area redesigned as a unified card with dog-ear corner pin toggle. Click the thumbtack icon on the top-left corner to pin/unpin the info bar. When pinned, the card stays fixed at the top while scrolling through the coin list. Thumbtack rotates from slanted (unpinned) to vertical (pinned) with smooth animation. Preference persists per-collection via uiPreferences.stickyInfoBar setting. |
| Feb 5 | index.html, app.js, main.css, index.js, preload.js, settings-manager.js | **Grid View Mode** - Added toggleable grid view as alternative to list view for coin collection. Responsive CSS Grid layout (auto-fill with 180px min cards, adapts to window size). Toggle button with SVG icons in filters bar. View Mode submenu in Electron View menu (List/Grid radio options). Preference persists per-collection via uiPreferences.defaultView setting. Grid cards show larger thumbnails (60px), 2-line truncated title, status borders preserved. Full Fast Pricing Mode compatibility: checkboxes in top-left corner with backdrop, fp-updated/fp-failed/fp-ineligible status styling. |
| Feb 5 | index.js, app.js, preload.js | **Fast Pricing Menu Integration** - Added Fast Pricing Mode controls to application menu bar. View menu: Enter/Exit Fast Pricing Mode (premium-gated with license prompt for non-supporters). Edit menu: Select All Eligible for Pricing, Select Displayed for Pricing, Clear Pricing Selection, Start Pricing Update (N)... with dynamic count. Menu state syncs in real-time with toolbar selections. |
| Feb 5 | user-manual.html | **User Manual v1.1 Update** - Comprehensive documentation update covering all Phase 3 features: EULA acceptance flow, License Management section (Free vs Supporter tiers, device limits, activation/deactivation), Fast Pricing Mode premium feature, expanded Menu Bar & Keyboard Shortcuts section with all menu items and accelerators, App Settings vs Data Settings separation, Default Collection feature, Search Category filter, improved Issue Picker with images and sorting, Image Lightbox feature, maxBackups setting. Added new troubleshooting items for license issues. Added 7 new licensing FAQ entries. Updated TOC navigation for all new sections. |
| Feb 5 | app.js, index.html, main.css | **Fast Pricing Mode UI Improvements** - Renamed button from "Fast Pricing Update" to "Fast Pricing Mode" for clearer toggle behavior. Added inline progress bar in toolbar showing "2/50 (4%)" format. Coin completion now uses persistent row highlighting (green border+tint for success, red for failure) instead of checkmark icons - highlighting persists after batch completes until exiting mode. Fixed multi-page tracking so coins updated on other pages show highlighting when navigating to them. |
| Feb 5 | app.js | **UX Fix** - Collection list now maintains position when returning from match/comparison screens. Uses `scrollIntoView()` to center the clicked coin in the viewport on return, works reliably across all pagination pages. Applies to all return paths (back to list, apply changes, skip). |
| Feb 5 | index.html, numista-api.js, app.js, main.css | **Bug Fixes** - Fixed "Skip This Coin" button (corrupted HTML tag), fixed issue picker to show ALL year-matched issues sorted by match quality (best matches first), fixed mintmark matching logic so "no mintmark" correctly matches "no mintmark" issues, added "Other options" section header when mixed match qualities |
| Feb 5 | app.js, index.html, main.css, index.js, preload.js | **Task 3.9 Fast Pricing Update (PREMIUM)** - Batch pricing updates for matched coins via "Fast Pricing Mode". Enter mode via button (premium-gated), checkboxes appear next to eligible coins (must have numistaId AND issueId). Selection options: Select All Eligible, Select Displayed, Clear. Confirmation dialog with estimated time, single pre-batch backup, 1-second rate limiting. Real-time progress in footer status bar, coin row visual feedback (checkmark/X), UI locking during batch. Successful coins deselected for easy resume on cancel. Completion modal with results summary. |
| Feb 5 | app.js | **EULA v2.0 Update** - Added License Tiers section (Free vs Supporter, 5-device limit, non-transferable, covers current major version + all updates, discounted upgrades to future major versions, feature access terms), Data Collection & Privacy section (local-only data, no PII collected, device fingerprint disclosure), California Privacy Rights (CCPA/CPRA compliance - right to know/delete/opt-out/non-discrimination), No Obligation to Support section (no guaranteed updates/support/maintenance, may discontinue at any time), Refunds section, Changes to Agreement section, updated restrictions to cover license key sharing/circumvention |
| Feb 5 | index.html, app.js, main.css, index.js | **License UI Indicators** - Version badge in header ("FREE VERSION" uppercase gray gradient / "Supporter Edition" gold), Fast Pricing button shows locked/unlocked state with lock icon and grayed styling, "Purchase License Key" menu item in Help menu (hidden for supporters), UI refresh on deactivation, device limit corrected to 5, removed neverAskAgain option (nag only stops with active license) |
| Feb 5 | index.js | **Polar Sandbox + License Fixes** - Switched to Polar sandbox for testing, fixed license validation to check `result.licenseKey.status` instead of `result.status`, fixed device fingerprinting to use consistent machine ID (hostname+platform+MAC hash) instead of timestamp to prevent duplicate activations |
| Feb 4 | index.js, preload.js, index.html, app.js | **License Management** - App Settings section for license management (device label, activation date, activation ID), validate/deactivate buttons, periodic license validation every 7 days with offline grace period, activation limit error handling (5 devices) |
| Feb 4 | index.js, preload.js, app.js, package.json | **Task 3.8 Licensing System** - Polar SDK integration, license key validation, About dialog with supporter status, license prompt at enrichment thresholds (20, then every 20), premium feature gating infrastructure |
| Feb 3 | index.html, app.js, main.css | **UI Compaction** - Stats bar + summary on same row (~250px saved), pagination moved to footer, error/skip counts as hover tooltips |
| Feb 3 | index.html, app.js, main.css, user-manual.html | **Logo Integration** - Added logo_with_text.svg to header, welcome screen, About dialog, EULA, and User Manual; icon.png/icon.ico added to build folder for app icon |
| Feb 3 | Multiple | **Rebrand** - Renamed from "Numismat Enrichment Tool" to "NumiSync Wizard" with subtitle "for OpenNumismat" |
| Feb 3 | index.js | Help menu - User Manual opens in dedicated Electron window (F1), centered on same screen as main window |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - Settings menu now separates App Settings (API key, backup) from Data Settings (fetch options, field mappings) |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - cross-platform Electron menu, Recent Collections tracking, keyboard shortcuts, menu state management |
| Feb 3 | PHASE3-WORK-PLAN.md | Added Task 3.0 Application Menu Bar - cross-platform Electron menu with Recent Collections, state management |
| Feb 3 | main.css | Issue picker image zoom - hover to enlarge 4x (matching coin selection behavior), overflow handling |
| Feb 3 | index.js, preload.js, index.html, app.js | Default Collection feature - auto-load on startup, browse/set/clear in Settings |
| Feb 3 | index.html, app.js, main.css | Task 2.5 Legal & Compliance - EULA modal, first-launch acceptance, Numista attribution in Settings |
| Feb 3 | electron-builder.yml, package.json, LICENSE.txt, build/*, docs/BUILD-GUIDE.md | Task 2.4 Packaging - electron-builder config, NSIS installer, build scripts, build documentation |
| Feb 2 | app.js, main.css | Advanced Field Mapping UI - tab bar, source dropdowns, bulk enable/disable |
| Feb 2 | opennumismat-db.js, settings-manager.js, index.js, index.html, app.js | Backup policy - maxBackups setting, autoBackup enforcement, PROTECTED_FIELDS guard |
| Feb 2 | mintmark-normalizer.js (NEW), numista-api.js, app.js, preload.js | Advanced matching - mintmark normalization, Dice coefficient fuzzy matching, issuer code caching |
| Feb 2 | index.js, app.js | Database safety check - lock detection, blocking warning dialog |
| Feb 2 | index.html, app.js, main.css | Image lightbox - click to view full size, hover zoom increase |
| Feb 2 | app.js, settings-manager.js, index.js, index.html | Category-based search parameter (coins/banknotes/exonumia filter) |
| Feb 2 | index.html, app.js, main.css, index.js, preload.js | Issue picker enhancements - user coin images, Numista link, mint registration fix |
| Feb 2 | app.js | Search results - confidence sorting, replaced Value with Category field |
| Feb 2 | index.js, app.js | Session call counter fix - increment on API calls, display refresh |
| Feb 1 | app.js | Status bar API call estimate fix - update after collection load |
| Feb 1 | settings-manager.js, index.js, index.html, app.js | Task 2.9 Settings file management - API key migration, field mappings defaults, reset button |
| Feb 1 | index.html, main.css, app.js | Counter strip redesign - 3 data-type cards with progress bars |
| Feb 1 | index.js | Pricing data fix - removed dead `incrementApiCalls` call blocking return |
| Feb 1 | opennumismat-db.js, main.css | Image display fix - photos table vs images table, enlarged selected coin images |
| Jan 31 | index.js, progress-tracker.js, app.js | Skip functionality - database persistence, statistics counters, prohibited icon |
| Jan 31 | index.html, main.css, app.js, index.js, preload.js | Issue Picker UI - modal, styling, pricing fetch for selected issue |
| Jan 31 | settings-manager.js, numista-api.js, index.html, app.js | Data independence - all three data types optional, smart issue matching |
| Jan 31 | app.js, numista-api.js | Image handling fixes - preserve thumbnails, correct table reference |
| Jan 31 | numista-api.js | Issue data fix - API returns array directly, not wrapped in `.issues` |
| Jan 31 | app.js | Automatic search fix - removed series field, year in query string |
| Jan 31 | package.json | Added axios dependency |
| Jan 31 | index.html, app.js | Emoji encoding fix - Python binary replacement for corrupted UTF-8 |
| Jan 31 | app.js, index.html, main.css | Pagination - 100 coins per page, navigation controls |
| Jan 28 | index.js | progressTracker method fix - updateCoinInCache not updateCoinStatus |
| Jan 28 | index.js | Metadata write after merge - icons now show merged status |

---

## Feature Releases

### Phase 2 - Enhanced Features (January-February 2026)

**Completed Tasks:**
- Task 2.1: Metadata storage in note field (HTML comments)
- Task 2.2: Granular status tracking (basic/issue/pricing)
- Task 2.3: Data Settings UI + Advanced Field Mapping
- Task 2.4: Conditional API calls + Issue Picker
- Task 2.5: Freshness indicators
- Task 2.6: Filter & Sort
- Task 2.8: Images (display, download, comparison)
- Task 2.9: Settings file management

**Not Started:**
- Task 2.7: Fetch More Data

### Phase 1 - Core Functionality (January 2026)

- Numista API integration
- Basic coin search and matching
- Field comparison and selective merging
- Progress tracking
- OpenNumismat database integration
- Settings management
- Manual search capability
- Skip coin functionality

---

## Notes Work Plan Status

### Phase 1 (Tackle Now) - COMPLETE
- 1.1 Session Call Counter Fix
- 1.2 Search Results Display Improvements
- 1.3 Select Issue Screen Enhancements
- 1.4 Metadata Preservation Verification
- 1.5 Category-Based Search Parameter
- 1.6 UI Polish Items
- 1.7 Database Safety Check

### Phase 2 (Tackle Later) - PARTIAL
- 2.1 Advanced Matching & Normalization - COMPLETE
- 2.2 Backup Policy & Data Safety - COMPLETE
- 2.3 User-Configurable Field Mapping - COMPLETE
- 2.4 Packaging & Distribution - COMPLETE
- 2.5 Legal & Compliance - COMPLETE
- 2.6 About Page & Licensing System - COMPLETE (Task 3.8)
- 2.7 Multi-Source Data Fetching - NOT STARTED
- 2.8 OpenNumismat Plugin Integration - NOT STARTED
