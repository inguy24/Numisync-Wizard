# Changelog

All notable changes to NumiSync Wizard for OpenNumismat.

## Fix History (Compressed)

| Date | Files | Summary |
|------|-------|---------|
| Feb 9 | docs/ | **Version 2 Work Plan Created** - Archived PHASE3-WORK-PLAN.md to `docs/archive/PHASE3-WORK-PLAN-COMPLETE.md` per CLAUDE.md Â§8. Created VERSION2-WORK-PLAN.md consolidating incomplete Phase 3 tasks (3.1-3.7 OAuth & Numista Sync features) plus deferred tasks (3.8.3 Auto-Update Check, 3.10 Multi-Source Fetching, 3.11 Plugin Integration) into new work plan. Tasks renumbered 2.1-2.10. Completed Phase 3 tasks remain: 3.0 Application Menu Bar, 3.8 About/Licensing (partial), 3.9 Fast Pricing Update ðŸ’Ž, 3.12 Auto-Propagate ðŸ’Ž. Version 2 will implement core Numista sync functionality (one-way OpenNumismat â†’ Numista collection upload with OAuth 2.0, data mapping, batch operations). |
| Feb 9 | docs/ | **Task 2.3 Advanced Field Mapping - COMPLETE** - Comprehensive audit confirms all 6 implementation steps from Advanced-Field-Mapping-PLAN.md are complete: (1) NUMISTA_SOURCES registry with 45+ source definitions in `default-field-mapping.js`, (2) `buildFieldMapperConfig()` in `settings-manager.js` to translate user settings to FieldMapper config, (3) Gap fixed - all 3 FieldMapper instantiations now use `settingsManager.buildFieldMapperConfig()`, (4) 6 IPC handlers + preload bridge methods for field mapping management, (5) Tabbed UI in Data Settings modal with Field Mappings tab, source dropdowns, bulk enable/disable, filter toolbar, export/import/reset capabilities, (6) CSS styles for tabs, wide modal, field mapping table. Feature completed February 2, 2026. Plan archived to `docs/archive/Advanced-Field-Mapping-PLAN-COMPLETE.md` per CLAUDE.md Â§8. |
| Feb 9 | index.js, app.js, numista-api.js, progress-tracker.js | **Pre-Release Audit Bug Fixes** - Comprehensive audit of search, retrieval, and auto-propagation system found 6 issues. (1) CRITICAL: Fast Pricing grade-to-price mapping was reversed vs normal merge flow - `price1` was mapped to Fair instead of Uncirculated, `price4` to Uncirculated instead of Fair. Every coin updated via Fast Pricing had prices swapped. Fixed mapping to match `field-mapper.js` convention: `price1=UNC, price2=XF, price3=VF, price4=F`. (2) CRITICAL: `applyBatchTypePropagation()` determined skip reasons using `duplicates[0].coin` (a matching collection coin) instead of the enriched source coin. When `duplicates` was empty, `enrichedYear` became `null` and ALL same-type coins showed "Different year". Fixed by passing `enrichedCoin` through the result object from `showBatchTypePropagationPrompt()` and using it for year/mintmark comparison. (3) HIGH: `get-coin-details` IPC handler did not parse metadata from the note field, while `get-coins` did. Any downstream code accessing `coin.metadata` after `get-coin-details` got `undefined`. Added metadata parsing matching `get-coins` behavior. (4) MINOR: Manual search issuer resolution failure was silently caught with empty `catch (e) {}`. Added `console.warn` logging for non-fatal issuer resolution failures. (5) MEDIUM: Removed dead `buildSearchQuery()` method from `NumistaAPI` class - leftover from old approach that appended `coin.country` directly to query text. All callers now use `buildSearchParams()` in renderer with the `issuer` parameter. (6) LOW: `loadProgress()` initial structure was missing `skipped: 0` in per-datatype stats (`basicData`, `issueData`, `pricingData`), while `resetStatistics()` included it. Added `skipped: 0` to all three for consistency. |
| Feb 9 | index.js | **Auto-Propagate Mint Resolution Fix** - Fixed two bugs preventing recent mint resolution and array-join fixes from carrying through auto-propagation. (1) `mint` field was missing from `typeLevelFields` in `propagate-type-data` IPC handler, so even when the user selected `mint` in the comparison screen it was silently dropped during batch propagation. Added `mint` to the allowed type-level fields list. (2) `mergeFields()` call in `propagate-type-data` did not pass `coinData` (the target coin's mintmark), so `resolveMintName()` in `mapToOpenNumismat()` could not fall back to the coin's `.db` mintmark when `issueData.mint_letter` was unavailable. For "same type, different issue" coins where `issueData` is null, this caused mint resolution to fall through entirely to `transformMintName()` which picks `mints[0]` â€” the old buggy behavior. Now passes `{ mintmark: currentCoin.mintmark }` matching how `merge-data` already does it. The `transformRulerPeriod()` fix (array join with deduplication) carries through automatically since it changed the transform function in `default-field-mapping.js` used by both paths. |
| Feb 9 | index.js | **Remember Window Position & Size** - App now saves window position, size, and maximized state to `settings.json` on close and restores them on next launch. Uses Electron's `screen.getAllDisplays()` to validate saved position is still on a connected monitor â€” gracefully falls back to default 1400x900 centered if the saved monitor is disconnected. Tracks pre-maximized bounds separately so unmaximizing after restore returns to the correct size/position. |
| Feb 9 | mintmark-normalizer.js, field-mapper.js, default-field-mapping.js, index.js, app.js | **Mint Name Resolution from Mint Letter** - Fixed mint field always picking first entry from type's `mints` array (e.g., "United States Mint of Philadelphia") regardless of which mint actually produced the coin. The `mint` field is MAIN data from the type endpoint, which returns ALL mints for a coin type. Previously `transformMintName()` blindly returned `mints[0].name`. Now correlates the mint letter (from issue data's `mint_letter` or the coin's .db `mintmark` as fallback) with the correct mint name using three strategies: (1) direct `letter` field match on mint objects, (2) reverse lookup via `US_MINT_MAP`/`WORLD_MINT_MAP` city-name maps, (3) parenthetical letter match. Added `resolveMintName()` to mintmark-normalizer.js, mint special-case block in field-mapper.js `mapToOpenNumismat()`, and `coinData` parameter threading through `compareFields`/`mergeFields`/`merge-data` IPC handler. When mint is resolved from a letter, the comparison screen pre-checks the mint field box via new `recommendUpdate` flag propagated through the comparison pipeline to `createDefaultSelection()`. Falls back to first mint when no mint letter is available. General transform in `mapToOpenNumismat()` now skips `mint` field (handled entirely in special case) to prevent `transformMintName()` from re-processing the resolved string value. |
| Feb 9 | default-field-mapping.js | **Ruler Period Array Join** - Fixed `transformRulerPeriod()` picking only the first ruler's dynasty/group (`value[0].group.name`), same `[0]`-picking pattern as the mint bug. Now joins all unique group names with `' / '` separator, matching the convention used by `transformRulerNames()`, `transformDesigners()`, and `transformEngravers()`. Deduplication via `Set` ensures co-rulers sharing the same dynasty produce a single value while different dynasties are preserved. |
| Feb 9 | app.js, index.js, numista-api.js | **Structured Search Query + Issuer Hierarchy Fix + Search Pagination + Manual Search Issuer + Coin List Fallback** - Fixed automatic searches wasting API calls and returning wrong results due to two issues: (1) `buildSearchParams()` used `coin.title` as the primary query source, passing un-normalized denomination plurals (e.g., "Crowns" instead of "Crown") that Numista cannot resolve. Restructured to build queries from structured fields first (`coin.value` + `normalizeUnitForSearch(coin.unit)` + `coin.year`), falling back to title only when structured fields are missing. Title fallback strips country name and applies `normalizeDenominationInQuery()`. Removed hardcoded `count: 20` to use the API default of 50. (2) `resolveIssuerCode()` used `.find()` which returned the first matching issuer â€” the section-level parent (e.g., "United Kingdom" group including Falkland Islands, Gibraltar) instead of the specific country. Numista's `/issuers` API returns a hierarchy with `level` (1-5) and `parent` fields. Fixed to use `.filter()` + pick highest `level` for exact matches, and prefer higher-level issuers in fuzzy matching. This eliminated territory coins polluting search results. Added search results pagination: when API returns more than 50 results (the per-page max), a "Load More Results (showing X of Y)" button appears at the bottom of the match list. Each click fetches the next page (1 API call) and appends results. Pagination state tracked in `AppState.searchPagination` across both automatic and manual search paths. Also added issuer filter to manual searches via `resolveIssuer()` passed to `manual-search-numista` backend handler (which now accepts `page` parameter). Added `buildCoinDisplayLabel()` fallback for coin list â€” shows denomination from structured fields (e.g., "1 Crown") instead of "(Untitled)" when title is empty. |
| Feb 8 | preload.js, numista-api.js, denomination-normalizer.js, denomination-aliases.json | **Unicode Normalization Fix for Match Confidence Scoring** - Fixed accented denomination names (e.g., Swedish "Ã–re", Czech "HalÃ©Å™Å¯") causing ~45-point scoring penalty due to Unicode NFC vs NFD mismatch. When OpenNumismat stores "Ã¶" as a single precomposed character (NFC, U+00F6) but Numista API returns it as base letter + combining diaeresis (NFD, U+006F+U+0308), string comparison fails even though characters render identically. Added `normalize('NFC')` to both `diceCoefficient()` functions (preload.js and numista-api.js) for consistent bigram generation. Added accent-stripping fallback to both `normalizeUnit()` functions (preload.js and denomination-normalizer.js): first tries NFC-normalized lookup in alias map, then strips diacritics via NFD decomposition + combining mark removal and retries. This maps "Ã¶re"â†’"ore", "cÃ³rdoba"â†’"cordoba", etc. automatically. Added "Ã¶re" as explicit alias for "ore" in denomination-aliases.json. All changes are local string operations â€” zero additional API calls. |
| Feb 8 | denomination-aliases.json, issuer-aliases.json (new), numista-api.js, denomination-normalizer.js, default-field-mapping.js, index.js, preload.js, app.js | **Heller/HalÃ©Å™Å¯ Cross-Referenced Denomination + Issuer Alias Extraction + Unicode Unit Fix** - Fixed Bohemia and Moravia coins returning 0 search results because Numista uses "HalÃ©Å™Å¯" (Czech) not "Heller" (German) in coin titles, and the API doesn't cross-match them. Solution: denomination-aliases.json now supports cross-referenced entries â€” "heller" and "halÃ©Å™" each list the other's aliases, creating bidirectional equivalence. The normalizer builds an `allCanonicalsMap` tracking every canonical a given alias belongs to. New `getAlternateSearchForms()` function returns all variant search forms (e.g., both "hellers" and "halÃ©Å™Å¯"). New search Strategy 4 in `searchForMatches()`: when strategies 1-3 return 0 results and the denomination has alternate forms, retries with each alternate. Also extracted hardcoded `ISSUER_ALIASES` from numista-api.js into `src/data/issuer-aliases.json` for easier maintenance. Added "Bohemia and Moravia" / "Protectorate of Bohemia and Moravia" / "BÃ¶hmen und MÃ¤hren" as issuer aliases (code: `boheme_moravie`). Fixed `transformValueUnit()` regex using ASCII-only `[A-Za-z]` which failed to extract unit from "10 HalÃ©Å™Å¯" (accented characters). Changed to Unicode-aware `[\p{L}]+$/u` to match any language's letters. |
| Feb 8 | denomination-aliases.json, denomination-normalizer.js, index.js, preload.js, app.js | **Denomination Plural/Singular Support + Missing Currencies** - Restructured denomination-aliases.json from flat arrays to `{ aliases: [...], plural: "..." }` object format with explicit plural forms for every denomination. Numista search is strict about singular vs plural ("1 centavo" matches, "1 centavos" does not). Previously `normalizeUnitForSearch()` used a flawed heuristic (check if input ends in 's', re-add 's' after normalization) which failed for non-English plurals (sol/soles, leu/lei, lira/lire) and misidentified singular words ending in 's' (fils, lats). New approach: `getSearchForm(canonical, numericValue)` uses the coin's numeric value to select the correct form â€” value=1 returns singular, value!=1 returns explicit plural from PLURAL_MAP. Updated `loadAliases()` to build both ALIAS_MAP and PLURAL_MAP from new JSON structure. IPC handler sends both maps to renderer. Added `normalizeDenominationInQuery()` for manual search: parses free-text for `<number> <denomination>` patterns and corrects plurality before sending to Numista API. Shows user the corrected query when normalization changes the input. Added ~40 missing UN-recognized currency denominations with researched alternate spellings: lek/qintar, dram/luma, manat/qapik, taka/poisha, ngultrum/chetrum, fening, riel, gourde, kip/att, lempira, quetzal, cordoba, rufiyaa/laari, metical, nakfa, somoni/diram, togrog/mongo, hryvnia, sum/tiyin, som/tyiyn, tenge/tyin, lari/tetri, balboa, sentimo, sente/lisente, khoums, iraimbilanja, and more. Added missing plural forms to all existing entries (cents, centavos, francs, dollars, pounds, etc.). |
| Feb 8 | logger.js (new), updater.js, index.js, preload.js, app.js, index.html, user-manual.html, numista-api.js, opennumismat-db.js, field-mapper.js, progress-tracker.js, metadata-manager.js, settings-manager.js, api-cache.js, image-handler.js, freshness-calculator.js | **Structured Logging, Support Workflow & Report an Issue** - Migrated all 383 `console.*` statements across 13 main-process/module files to `electron-log` via new centralized `src/main/logger.js` module. Each module uses scoped loggers (e.g., `[Database]`, `[NumistaAPI]`). Log levels mapped: `console.error` -> `log.error`, `console.warn` -> `log.warn`, operational milestones -> `log.info`, verbose traces -> `log.debug`. Renderer `console.*` captured automatically via `spyRendererConsole`. Added user-configurable log level setting in App Settings (error/warn/info/debug, default: info) with runtime switching. Added "Download Log File" button in Settings and "Report an Issue" modal (Help menu) with links to User Manual, GitHub Issues, and log download. New `export-log-file` IPC handler copies log to user-chosen location via Save As dialog. Log file: `%APPDATA%/NumiSync Wizard/logs/numisync-wizard.log` (5MB max, auto-rotated). Emoji characters in opennumismat-db.js and field-mapper.js replaced with ASCII equivalents (`[OK]`, `[MISMATCH]`, `[SKIP]`). User manual updated with new "Getting Help" section (section 18). |
| Feb 8 | denomination-aliases.json, app.js, numista-api.js | **Euro Denomination Scoring Fix** - Fixed "Euro Cents" results scoring higher than "Euro" results when matching coins with unit="Euro" but no numeric value. Three root causes: (1) Numista search API doesn't return `value` in results, so code falls back to title regex which only captured single-word units (`/^[\d.]+\s*[a-zA-Z]+/` â†’ "2 Euro" from "2 Euro Cents"), losing the "Cents" distinction. Fixed regex to capture up to first separator (`/^[\d.]+\s*[^-â€“(,]+/` â†’ "2 Euro Cents"). (2) When coin has unit but no numeric value, denomination scoring was entirely skipped. Added unit-only comparison branch: +15 for unit match, -10 for mismatch. (3) "Euro" and "Euro Cent" were missing from denomination aliases. Added euro section with variants (euro/euros/eur, euro cent/euro cents/eurocent). |
| Feb 8 | numista-api.js, index.js | **Session Counter Accuracy Fix** - Session counter in `fetch-coin-data` and `fetch-issue-data` IPC handlers was heuristically counting API calls based on which data types were requested, overcounting by 1 when `getType()` or `getTypeIssues()` returned from persistent cache instead of making a real HTTP call. Added `apiCallCount` property to NumistaAPI class, incremented in `request()` only on actual HTTP calls. IPC handlers now read `api.apiCallCount` instead of guessing. Session counter and monthly counter now always agree. |
| Feb 8 | api-cache.js (new), numista-api.js, index.js, preload.js, app.js, index.html, user-manual.html | **Persistent API Cache, Search Simplification & Monthly Usage Tracking** - New persistent disk cache (`numista_api_cache.json` in userData) stores issuers (90d default), type data (30d), and issue data (30d) across sessions. Eliminates redundant API calls â€” e.g., issuers list no longer re-fetched on every app launch. All 8 NumistaAPI instantiation points in index.js now pass persistent cache + user-configured TTLs. Usage tracking: `request()` auto-increments per-endpoint monthly counters; footer shows "Month: X/2,000" with color warnings at 75%+ and 90%+. Search simplification: `buildSearchParams()` now strips parentheticals from title and country upfront, Strategy 2 (parenthetical retry) removed â€” worst-case search drops from 4 to 3 API calls. New App Settings section: per-data-type cache TTL selects (30-360 days or "No caching"), monthly API limit, manual usage adjustment input, Numista dashboard link, Clear Cache button. New IPC handlers: `get-monthly-usage`, `set-monthly-usage`, `set-monthly-usage-total`, `clear-api-cache`. User manual updated with section 19 covering cache, settings, usage tracking, and Numista quota. |
| Feb 8 | numista-api.js | **Issue Matching Gregorian Year Fix** - Fixed issue picker showing all dates instead of just matching issues for coins using non-Gregorian dating (e.g., Japanese Meiji era). `matchIssue()` year filter was only checking the `year` field (era-specific, e.g., 14 for Meiji 14) but not `gregorian_year` (e.g., 1881). A coin with year 1881 matched zero issues because no issue has `year: 1881`. Now checks both `i.year` and `i.gregorian_year` against the user's year, correctly filtering to the 2 matching issues for 1881 Japan 1 Sen. |
| Feb 8 | app.js | **Auto-Propagate Cross-Country Catalog Fix** - Fixed auto-propagate falsely matching coins from different countries that share the same non-Numista catalog number (e.g., KM#132 exists in both USA and France). Non-Numista catalog systems (KM, Schon, Yeoman) reuse numbers across countries, so catalog-based matching now requires country/issuer validation. Added `countriesMatch()` helper with bi-directional includes for name variations. Numista ID matching (Priority 1) is unaffected since Numista IDs are globally unique. Coins with empty country fields are skipped for non-Numista catalog matches since their country cannot be verified. |
| Feb 8 | settings-manager.js, app.js | **Remember View State on Close** - App now remembers the current page, scroll position, filters (status, freshness), and sort settings when closed. On next launch with a default collection, the coin list restores to the same page/position/filters/sort the user left off at. State is saved per-collection via `uiPreferences.lastViewState` and persisted on each page/filter/sort change (debounced) plus on window close. View state is restored in `loadCollectionScreen()` before `loadCoins()` so the first render uses saved state. Reset Filters button clears saved state. |
| Feb 8 | app.js, main.css | **Issue Picker Pre-Selection** - When re-enriching a coin that already has issue data, the issue picker modal now pre-selects the previously chosen issue (radio checked, row highlighted) and shows a blue "PREVIOUS SELECTION" badge. The "Apply Selection" button is immediately enabled. Users can still change their selection. First-time enrichments are unaffected. |
| Feb 8 | denomination-aliases.json, index.js, preload.js, app.js | **Pence/Penny Alias Fix + Alias Deduplication** - Fixed "Pence" being aliased to "penny" which broke search for all Pence-denominated coins (e.g., Ireland 20 Pence 1998 returned medieval half-pennies instead of correct results). Split "pence" into its own canonical group since Numista treats Pence and Penny as distinct denominations. Eliminated 90-line hardcoded alias map duplication in preload.js by loading aliases from main process via `ipcRenderer.sendSync('get-denomination-aliases')` at startup â€” `denomination-aliases.json` is now the single source of truth. Added defensive duplicate check in `buildSearchParams()` that compares both normalized and original denomination forms against the title before appending, preventing contradictory search terms. |
| Feb 7 | EULA.txt, eula-windows.rtf, installer.nsh, updater.js, validate-version.js, post-version.js, package.json, electron-builder.yml, index.js, preload.js, app.js | **Installer Distribution Phase 1** - EULA in NSIS installer (RTF license screen + marker file for skipping in-app EULA), auto-update module (electron-updater + electron-log with manual "Check for Updates" menu item), version bump scripts (preversion validation, postversion reminders), installer EULA marker detection in checkEulaOnStartup(). New files: EULA.txt (plain text), build/eula/eula-windows.rtf, build/installer.nsh (creates/removes marker), scripts/validate-version.js, scripts/post-version.js, src/main/updater.js. Modified: package.json (build:win, version scripts, electron-updater/electron-log deps), electron-builder.yml (EULA license screen, NSIS include), index.js (updater import, IPC handlers, menu item), preload.js (checkInstallerEulaMarker, checkForUpdates channels), app.js (installer marker check before in-app EULA). |
| Feb 7 | denomination-aliases.json, denomination-normalizer.js, numista-api.js, preload.js, app.js | **Denomination Alias Normalizer** - Added denomination normalizer module to fix unit matching failures for transliteration/spelling variants. Coins with "kopeks" vs Numista "Kopeck" (dice=0.6, below 0.7 threshold) now match via alias lookup, fixing a 45-point scoring swing (-20 penalty to +25 bonus). External JSON alias file covers 100+ denominations across 16 regional groups. Main process uses `denomination-normalizer.js` module; renderer uses inlined copy in `preload.js` (Electron 28 sandbox prevents `require('fs')`). Search queries normalize spelling via `normalizeUnitForSearch()` while preserving plurality (Numista search is singular/plural sensitive: "kopeck" returns 0 results, "kopecks" finds matches). Three search builders updated: `buildSearchParams`, `buildCoreQuery`, `buildMinimalQuery`. Dice coefficient fallback preserved for unlisted denominations. |
| Feb 8 | default-field-mapping.js, field-mapper.js, app.js, main.css | **Field Comparison Consistent Ordering** - Fields in "Review and Select Fields" screen now display in consistent order grouped by category matching Data Settings API toggles. Added `category` (main/issue/pricing) and `displayOrder` properties to all 33 field definitions. Sort logic sorts by category then displayOrder. Category headers ("Type Data", "Issue Data", "Pricing Data") only appear when multiple categories are present (e.g., after fetching issue or pricing data) - no headers when only type data is shown. |
| Feb 8 | opennumismat-db.js | **Edge Image Display Fix** - Fixed edge images not displaying in field comparison "Current" column even when present in database. `getCoinImages()` was returning `edge: null` hardcoded. Now properly fetches edge image from photos table using `coin.edgeimg`. |
| Feb 8 | opennumismat-db.js | **Image Column Update Fix** - Fixed downloaded images not being linked to coins. `updateCoinImages()` was calling `updateCoin()` which blocked protected fields (obverseimg/reverseimg/edgeimg). Now uses direct SQL UPDATE to bypass protection when setting valid photo IDs. |
| Feb 8 | app.js, main.css | **Inline Image Field Previews** - Replaced separate "Image Comparison" section with inline image previews in the obverseimg/reverseimg/edgeimg field rows. Each image field now shows Current vs Numista images side-by-side (80x80px, hover to zoom 2.5x). Removed redundant "Download Images to Collection" button since images are now auto-downloaded when image fields are selected during merge. |
| Feb 7 | index.js | **Auto-Download Images on Merge** - When image fields (obverseimg, reverseimg, edgeimg) are selected in field comparison and user clicks "Apply Changes", images are now automatically downloaded from Numista and stored in the photos table. Previously users had to use a separate "Download Images" button. URLs are fetched from numistaData.obverse/reverse/edge.picture, downloaded via imageHandler, and stored via storeImagesForCoin(). |
| Feb 7 | main.css | **Fetch More Data UI Overflow Fix** - Fixed "Additional Data Available" section buttons being clipped on narrow screens. Added flex-wrap, proper min-width, and overflow handling to fetch-more-card and fetch-more-data-section. |
| Feb 7 | app.js, image-handler.js | **Edge Image URL Fallback** - Fixed edge images not downloading because Numista API uses `edge.picture` (nested) instead of `edge_thumbnail` (top-level). Added fallback from `edge_thumbnail` to `edge.picture` in handleImageDownload() and image-handler.js. |
| Feb 7 | opennumismat-db.js | **Image Storage Table Fix** - Fixed downloaded images not appearing in OpenNumismat. Images were being stored in the `images` table but `obverseimg`/`reverseimg`/`edgeimg` columns reference the `photos` table. Added `insertPhoto()` method and updated `storeImagesForCoin()` to use photos table. |
| Feb 7 | app.js, numista-api.js | **Numista ID Perfect Match** - Search results now show 100% confidence for coins that were previously enriched with the same Numista type. Checks `coin.metadata.basicData.numistaId` against search result `id` field. Ensures previously matched coins appear at top of search results. |
| Feb 7 | app.js | **Edge Image Download Fix** - Fixed edge images not being downloaded when clicking "Download Images". The `edge_thumbnail` from full type data was being overwritten with `undefined` from search results (which don't include edge thumbnails). Now preserves the edge_thumbnail from basicData. |
| Feb 6 | app.js | **Premium Features Advertising Update** - Updated license prompt modal and EULA to list both premium features: Fast Pricing Mode and Auto-Propagate. License prompt now shows feature names with descriptions. EULA Section 3(b) now mentions both batch pricing updates and batch type data propagation. |
| Feb 6 | user-manual.html, TASK-3.12, PHASE3-WORK-PLAN.md | **Task 3.12 Documentation Complete** - Added Auto-Propagate section to user manual with full feature documentation (how it works, what data gets propagated, matching criteria, skipped coins, disabling the feature). Updated License Tiers table to include Auto-Propagate. Updated FAQ with premium feature list. Marked Task 3.12 as fully complete in task document and work plan. |
| Feb 6 | app.js | **Auto-Propagate Progress Bar** - Added inline progress bar to batch type propagation modal. Shows "X/Y (Z%)" format with visual progress bar during operation, matching Fast Pricing Mode UX. Displays current coin being processed. Modal transitions to results view when complete. |
| Feb 6 | app.js | **Match List Scroll Fix** - Fixed matching coins list not returning to top when selecting a new coin. Added scroll-to-top logic in showScreen() when transitioning to match screen, ensuring `.app-main` container resets to top position. |
| Feb 6 | index.js, app.js | **Auto-Propagate Field Selection Fix** - Fixed auto-propagate overwriting fields that weren't selected for the original merge. Previously, propagate-type-data hardcoded all type-level fields to `true`. Now passes `selectedFields` from the original merge through the propagation flow (`showBatchTypePropagationPrompt` â†’ `applyBatchTypePropagation` â†’ `propagateTypeData` IPC). Handler now only propagates fields the user explicitly checked. Added skip logic for coins when no applicable fields are selected. |
| Feb 6 | index.js, app.js | **Auto-Propagate Bug Fix** - Fixed auto-propagate prompt not appearing after enrichment. Issue 1: `get-coins` IPC handler now parses metadata from note field so coins have `metadata.basicData.numistaId` available for matching. Issue 2: Fixed wrong fallback defaults in `getCatalogSlotMapping()` - was using 'Krause'/'Numista'/null/null, now correctly uses 'KM'/'SchÃ¶n'/'Y'/'Numista' to match default-field-mapping.js and Numista API catalog codes. |
| Feb 6 | app.js, numista-api.js | **Coin Match Scoring Improvements** - Fixed broken denomination matching (was comparing numeric 1 vs 0.01, now uses text comparison). Added progressive search fallback for zero-result queries (strips parenthetical terms like "(Nazi)", tries simplified queries). Rebalanced scoring weights: Title 30pts, Year 25pts (+bonus) or -15pts (penalty for out-of-range), Country 20pts, Denomination 25pts (match) or -20pts (mismatch), Category +10pts (standard circulation) or -10pts (patterns/proofs). Fixed "1 Cent" vs "1 Dime" false match (same numeric value but different units now penalized). Extracts denomination from title as fallback when value.text missing from API response. |
| Feb 6 | settings-manager.js, app.js, index.html, TASK-3.12 | **Task 3.12.11 Auto-Propagate Toggle** - Added checkbox in Data Settings to enable/disable the Auto-Propagate feature (default: enabled). When disabled, the post-merge detection prompt is skipped. Updated PREMIUM_FEATURES name to "Auto-Propagate" for consistent user-facing terminology. Setting persists via fetchSettings.enableAutoPropagate. |
| Feb 6 | index.js, numista-api.js, app.js, index.html, main.css | **Task 3.12 Completion** - Silent Type Data Reuse (3.12.4): Added typeDataCache Map in main process, caches type data by typeId, cleared on collection load, skips API calls for previously fetched types. Empty Mintmark Setting UI (3.12.7): Added radio buttons in Data Settings for empty mintmark interpretation (no_mint_mark/unknown). Issue/Pricing Matching (3.12.8): matchIssue() now accepts options with emptyMintmarkInterpretation, detects privy marks and signatures in issues, returns privyMarksDetected/signaturesDetected flags. Skipped Coins Handling (3.12.9): Enhanced applyBatchTypePropagation() with detailed tracking of full-data vs type-only updates, skip reasons stored in batchProcessed metadata, improved results modal showing skip list with reasons. |
| Feb 6 | app.js, main.css, index.js, preload.js, settings-manager.js, PHASE3-WORK-PLAN.md | **Task 3.12 Batch Type Data Propagation (PREMIUM)** - After enriching a coin, detects other coins in the collection sharing the same Numista type (via numistaId or catalog numbers). Shows matching coins grouped into True Duplicates (same type+year+mintmark - can receive ALL data) and Same Type/Different Issue (type data only). Detection is FREE; applying to all matching coins requires premium license. Implements strict catalog matching (ALL populated slots must match), normalizeCatalogNumber() for prefix stripping, categorizeMatchingCoins() for duplicate detection. Adds propagate-type-data IPC handler for batch database updates. Adds emptyMintmarkInterpretation setting (no_mint_mark/unknown). Premium modal with gold gradient styling. |
| Feb 5 | index.html, app.js, main.css | **Header Consolidation** - Merged collection controls into main app header. Collection title now displays centered in header when collection is open. Combined "App Settings" and "Data Settings" into a single gear icon dropdown button (saves header space). Fast Pricing Mode and Close Collection buttons moved to header actions area. Removed separate collection-header section from collection screen for cleaner layout. |
| Feb 5 | index.html, app.js, main.css, settings-manager.js | **Sticky Info Bar Toggle** - Stats and filters area redesigned as a unified card with dog-ear corner pin toggle. Click the thumbtack icon on the top-left corner to pin/unpin the info bar. When pinned, the card stays fixed at the top while scrolling through the coin list. Thumbtack rotates from slanted (unpinned) to vertical (pinned) with smooth animation. Preference persists per-collection via uiPreferences.stickyInfoBar setting. |
| Feb 5 | index.html, app.js, main.css, index.js, preload.js, settings-manager.js | **Grid View Mode** - Added toggleable grid view as alternative to list view for coin collection. Responsive CSS Grid layout (auto-fill with 180px min cards, adapts to window size). Toggle button with SVG icons in filters bar. View Mode submenu in Electron View menu (List/Grid radio options). Preference persists per-collection via uiPreferences.defaultView setting. Grid cards show larger thumbnails (60px), 2-line truncated title, status borders preserved. Full Fast Pricing Mode compatibility: checkboxes in top-left corner with backdrop, fp-updated/fp-failed/fp-ineligible status styling. |
| Feb 5 | index.js, app.js, preload.js | **Fast Pricing Menu Integration** - Added Fast Pricing Mode controls to application menu bar. View menu: Enter/Exit Fast Pricing Mode (premium-gated with license prompt for non-supporters). Edit menu: Select All Eligible for Pricing, Select Displayed for Pricing, Clear Pricing Selection, Start Pricing Update (N)... with dynamic count. Menu state syncs in real-time with toolbar selections. |
| Feb 5 | user-manual.html | **User Manual v1.1 Update** - Comprehensive documentation update covering all Phase 3 features: EULA acceptance flow, License Management section (Free vs Supporter tiers, device limits, activation/deactivation), Fast Pricing Mode premium feature, expanded Menu Bar & Keyboard Shortcuts section with all menu items and accelerators, App Settings vs Data Settings separation, Default Collection feature, Search Category filter, improved Issue Picker with images and sorting, Image Lightbox feature, maxBackups setting. Added new troubleshooting items for license issues. Added 7 new licensing FAQ entries. Updated TOC navigation for all new sections. |
| Feb 5 | app.js, index.html, main.css | **Fast Pricing Mode UI Improvements** - Renamed button from "Fast Pricing Update" to "Fast Pricing Mode" for clearer toggle behavior. Added inline progress bar in toolbar showing "2/50 (4%)" format. Coin completion now uses persistent row highlighting (green border+tint for success, red for failure) instead of checkmark icons - highlighting persists after batch completes until exiting mode. Fixed multi-page tracking so coins updated on other pages show highlighting when navigating to them. |
| Feb 5 | app.js | **UX Fix** - Collection list now maintains position when returning from match/comparison screens. Uses `scrollIntoView()` to center the clicked coin in the viewport on return, works reliably across all pagination pages. Applies to all return paths (back to list, apply changes, skip). |
| Feb 5 | index.html, numista-api.js, app.js, main.css | **Bug Fixes** - Fixed "Skip This Coin" button (corrupted HTML tag), fixed issue picker to show ALL year-matched issues sorted by match quality (best matches first), fixed mintmark matching logic so "no mintmark" correctly matches "no mintmark" issues, added "Other options" section header when mixed match qualities |
| Feb 5 | app.js, index.html, main.css, index.js, preload.js | **Task 3.9 Fast Pricing Update (PREMIUM)** - Batch pricing updates for matched coins via "Fast Pricing Mode". Enter mode via button (premium-gated), checkboxes appear next to eligible coins (must have numistaId AND issueId). Selection options: Select All Eligible, Select Displayed, Clear. Confirmation dialog with estimated time, single pre-batch backup, 1-second rate limiting. Real-time progress in footer status bar, coin row visual feedback (checkmark/X), UI locking during batch. Successful coins deselected for easy resume on cancel. Completion modal with results summary. |
| Feb 5 | app.js | **EULA v2.0 Update** - Added License Tiers section (Free vs Supporter, 5-device limit, non-transferable, covers current major version + all updates, discounted upgrades to future major versions, feature access terms), Data Collection & Privacy section (local-only data, no PII collected, device fingerprint disclosure), California Privacy Rights (CCPA/CPRA compliance - right to know/delete/opt-out/non-discrimination), No Obligation to Support section (no guaranteed updates/support/maintenance, may discontinue at any time), Refunds section, Changes to Agreement section, updated restrictions to cover license key sharing/circumvention |
| Feb 5 | index.html, app.js, main.css, index.js | **License UI Indicators** - Version badge in header ("FREE VERSION" uppercase gray gradient / "Supporter Edition" gold), Fast Pricing button shows locked/unlocked state with lock icon and grayed styling, "Purchase License Key" menu item in Help menu (hidden for supporters), UI refresh on deactivation, device limit corrected to 5, removed neverAskAgain option (nag only stops with active license) |
| Feb 5 | index.js | **Polar Sandbox + License Fixes** - Switched to Polar sandbox for testing, fixed license validation to check `result.licenseKey.status` instead of `result.status`, fixed device fingerprinting to use consistent machine ID (hostname+platform+MAC hash) instead of timestamp to prevent duplicate activations |
| Feb 4 | index.js, preload.js, index.html, app.js | **License Management** - App Settings section for license management (device label, activation date, activation ID), validate/deactivate buttons, periodic license validation every 7 days with offline grace period, activation limit error handling (5 devices) |
| Feb 4 | index.js, preload.js, app.js, package.json | **Task 3.8 Licensing System** - Polar SDK integration, license key validation, About dialog with supporter status, license prompt at enrichment thresholds (20, then every 20), premium feature gating infrastructure |
| Feb 3 | index.html, app.js, main.css | **UI Compaction** - Stats bar + summary on same row (~250px saved), pagination moved to footer, error/skip counts as hover tooltips |
| Feb 3 | index.html, app.js, main.css, user-manual.html | **Logo Integration** - Added logo_with_text.svg to header, welcome screen, About dialog, EULA, and User Manual; icon.png/icon.ico added to build folder for app icon |
| Feb 3 | Multiple | **Rebrand** - Renamed from "Numismat Enrichment Tool" to "NumiSync Wizard" with subtitle "for OpenNumismat" |
| Feb 3 | index.js | Help menu - User Manual opens in dedicated Electron window (F1), centered on same screen as main window |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - Settings menu now separates App Settings (API key, backup) from Data Settings (fetch options, field mappings) |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - cross-platform Electron menu, Recent Collections tracking, keyboard shortcuts, menu state management |
| Feb 3 | PHASE3-WORK-PLAN.md | Added Task 3.0 Application Menu Bar - cross-platform Electron menu with Recent Collections, state management |
| Feb 3 | main.css | Issue picker image zoom - hover to enlarge 4x (matching coin selection behavior), overflow handling |
| Feb 3 | index.js, preload.js, index.html, app.js | Default Collection feature - auto-load on startup, browse/set/clear in Settings |
| Feb 3 | index.html, app.js, main.css | Task 2.5 Legal & Compliance - EULA modal, first-launch acceptance, Numista attribution in Settings |
| Feb 3 | electron-builder.yml, package.json, LICENSE.txt, build/*, docs/BUILD-GUIDE.md | Task 2.4 Packaging - electron-builder config, NSIS installer, build scripts, build documentation |
| Feb 2 | app.js, main.css | Advanced Field Mapping UI - tab bar, source dropdowns, bulk enable/disable |
| Feb 2 | opennumismat-db.js, settings-manager.js, index.js, index.html, app.js | Backup policy - maxBackups setting, autoBackup enforcement, PROTECTED_FIELDS guard |
| Feb 2 | mintmark-normalizer.js (NEW), numista-api.js, app.js, preload.js | Advanced matching - mintmark normalization, Dice coefficient fuzzy matching, issuer code caching |
| Feb 2 | index.js, app.js | Database safety check - lock detection, blocking warning dialog |
| Feb 2 | index.html, app.js, main.css | Image lightbox - click to view full size, hover zoom increase |
| Feb 2 | app.js, settings-manager.js, index.js, index.html | Category-based search parameter (coins/banknotes/exonumia filter) |
| Feb 2 | index.html, app.js, main.css, index.js, preload.js | Issue picker enhancements - user coin images, Numista link, mint registration fix |
| Feb 2 | app.js | Search results - confidence sorting, replaced Value with Category field |
| Feb 2 | index.js, app.js | Session call counter fix - increment on API calls, display refresh |
| Feb 1 | app.js | Status bar API call estimate fix - update after collection load |
| Feb 1 | settings-manager.js, index.js, index.html, app.js | Task 2.9 Settings file management - API key migration, field mappings defaults, reset button |
| Feb 1 | index.html, main.css, app.js | Counter strip redesign - 3 data-type cards with progress bars |
| Feb 1 | index.js | Pricing data fix - removed dead `incrementApiCalls` call blocking return |
| Feb 1 | opennumismat-db.js, main.css | Image display fix - photos table vs images table, enlarged selected coin images |
| Jan 31 | index.js, progress-tracker.js, app.js | Skip functionality - database persistence, statistics counters, prohibited icon |
| Jan 31 | index.html, main.css, app.js, index.js, preload.js | Issue Picker UI - modal, styling, pricing fetch for selected issue |
| Jan 31 | settings-manager.js, numista-api.js, index.html, app.js | Data independence - all three data types optional, smart issue matching |
| Jan 31 | app.js, numista-api.js | Image handling fixes - preserve thumbnails, correct table reference |
| Jan 31 | numista-api.js | Issue data fix - API returns array directly, not wrapped in `.issues` |
| Jan 31 | app.js | Automatic search fix - removed series field, year in query string |
| Jan 31 | package.json | Added axios dependency |
| Jan 31 | index.html, app.js | Emoji encoding fix - Python binary replacement for corrupted UTF-8 |
| Jan 31 | app.js, index.html, main.css | Pagination - 100 coins per page, navigation controls |
| Jan 28 | index.js | progressTracker method fix - updateCoinInCache not updateCoinStatus |
| Jan 28 | index.js | Metadata write after merge - icons now show merged status |

---

## Feature Releases

### Phase 2 - Enhanced Features (January-February 2026)

**Completed Tasks:**
- Task 2.1: Metadata storage in note field (HTML comments)
- Task 2.2: Granular status tracking (basic/issue/pricing)
- Task 2.3: Data Settings UI + Advanced Field Mapping
- Task 2.4: Conditional API calls + Issue Picker
- Task 2.5: Freshness indicators
- Task 2.6: Filter & Sort
- Task 2.8: Images (display, download, comparison)
- Task 2.9: Settings file management

**Not Started:**
- Task 2.7: Fetch More Data

### Phase 1 - Core Functionality (January 2026)

- Numista API integration
- Basic coin search and matching
- Field comparison and selective merging
- Progress tracking
- OpenNumismat database integration
- Settings management
- Manual search capability
- Skip coin functionality

---

## Notes Work Plan Status

### Phase 1 (Tackle Now) - COMPLETE
- 1.1 Session Call Counter Fix
- 1.2 Search Results Display Improvements
- 1.3 Select Issue Screen Enhancements
- 1.4 Metadata Preservation Verification
- 1.5 Category-Based Search Parameter
- 1.6 UI Polish Items
- 1.7 Database Safety Check

### Phase 2 (Tackle Later) - PARTIAL
- 2.1 Advanced Matching & Normalization - COMPLETE
- 2.2 Backup Policy & Data Safety - COMPLETE
- 2.3 User-Configurable Field Mapping - COMPLETE
- 2.4 Packaging & Distribution - COMPLETE
- 2.5 Legal & Compliance - COMPLETE
- 2.6 About Page & Licensing System - COMPLETE (Task 3.8)
- 2.7 Multi-Source Data Fetching - NOT STARTED
- 2.8 OpenNumismat Plugin Integration - NOT STARTED
