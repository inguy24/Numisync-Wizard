# Changelog

All notable changes to NumiSync Wizard for OpenNumismat.

**Type key:** `Feature` = new functionality · `Fix` = bug fix · `Internal` = docs, CI, tooling, AI context

> **Format note:** The `Type` column was introduced in v1.0.3. Earlier entries are in the [Pre-v1.0.3 History](#pre-v103-history-compressed--no-type-column) section without type classification.

---

## v1.1.5

| Date | Type | Files | Summary |
|------|------|-------|---------|
| Feb 26 | Internal | docs/_layouts/default.html, docs/fr/download.md, docs/de/download.md, docs/es/download.md, docs/ru/download.md, docs/ja/download.md, docs/zh-CN/download.md, docs/zh-TW/download.md, docs/it/download.md, docs/pt/download.md, docs/nl/download.md | **Multi-language website — language switcher flags, nav/footer translation, 404 fix, localized Store badges** — Fixed 404 on language switching from non-index pages (langPath generated trailing slash `/download/` but Jekyll serves pages at `/download`; removed trailing slash from all non-index paths). Added Unicode flag emojis to language dropdown. Nav bar and footer link text ("Report an Issue", "Privacy Policy") now translate via JS for all 11 languages. Updated Microsoft Store badge images on all 10 translated download pages to their locale-specific SVGs (fr-fr, de-de, es-es, ru-ru, ja-jp, zh-cn, zh-tw, it-it, pt-br, nl-nl). |
| Feb 26 | Internal | docs/_layouts/default.html, docs/index.md, docs/download.md, docs/installation.md, docs/quickstart.md, docs/license.md, docs/fr/, docs/de/, docs/es/, docs/it/, docs/pt/, docs/nl/, docs/ru/, docs/ja/, docs/zh-CN/, docs/zh-TW/ | **Multi-language website — 10 languages, 50 translated pages** — Added language switcher dropdown to nav (11 languages including English), browser locale auto-detection on first visit, localStorage preference persistence, and hreflang tags in `<head>` for SEO. Created translated pages in fr, de, es, it, pt, nl, ru, ja, zh-CN, zh-TW (5 pages each). All translated pages preserve HTML structure, image paths, and URLs verbatim; product names (NumiSync Wizard, OpenNumismat, Numista), UI labels, platform names, and grade abbreviations kept in English per translation rules. |
|------|------|-------|---------|
| Feb 25 | Internal | docs/_layouts/default.html, docs/download.md, docs/license.md, docs/privacy.md | **Add Google Analytics 4 tracking** — GA4 page-view tracking on all website pages; download click events per platform (windows_store, macos_intel, macos_arm, linux_appimage, linux_deb, linux_rpm); license purchase click event; privacy policy updated to disclose website analytics while preserving the desktop app's zero-data guarantee. |
| Feb 24 | Fix | src/modules/api-cache.js, src/modules/numista-api.js, src/main/index.js | **Per-key API usage tracking** — Monthly call counts are now tracked independently per API key; switching to a new key resets the counter for that key while preserving the previous key's count, and switching back restores it. Existing counts are automatically migrated to the current key on first use. |
| Feb 24 | Internal | src/main/updater.js | **"What's New" modal now fires for EXE auto-updates too** — `checkIfRecentlyUpdated()` was only called in the Store branch; EXE users never saw the modal after a restart following an auto-update. Added the same 2-second delayed call to the EXE path so both install methods show release notes on first launch after an update. |
| Feb 24 | Internal | src/main/updater.js, src/renderer/styles/main.css | **Wire up "What's New" modal for Store auto-updates** — `show-whats-new` IPC event was fired by main but silently dropped by renderer (no CSS for `.modal-overlay`/`.modal-dialog`, and `checkIfRecentlyUpdated()` called `checkGitHubVersion()` which returns no notes when current = latest). Fixed: added `fetchVersionReleaseNotes(version)` that fetches the specific release tag (`/releases/tags/v{version}`) so notes for the just-installed version are always retrieved; `checkIfRecentlyUpdated()` now uses it. Added missing `.modal-overlay` (fixed full-screen backdrop) and `.modal-dialog` (centered surface box) CSS. Removed the `store-update-available` passive notification that fired against GitHub before Microsoft Store certification was complete, causing misleading "update available" messages during the Store's 1–3 day certification window. |
| Feb 24 | Internal | docs/download.md | **Microsoft Store listing live — replaced "Coming Soon" placeholder with official badge** — App certified by Microsoft; download page now links to `https://apps.microsoft.com/detail/9N1TDJTPHSMN` via the official "Get it from Microsoft" badge. Direct download (.exe) remains pending code signing. |
| Feb 24 | Fix | src/renderer/app.js | **Session and monthly API counters showed 0 until first user action — status bar never populated on collection load** — `loadCollectionScreen()` updated the fetch-settings label but never called `refreshSessionCounter()`, so `Session: 0 calls` and `Month: 0/2,000` persisted until some other action triggered a refresh. Fixed by adding `await refreshSessionCounter()` at the end of `loadCollectionScreen()`, covering every load path (auto-load at startup, manual open, menu open). Removed the redundant duplicate `getStatistics`/`updateSessionCallDisplay` calls that were in the auto-load init block. |
| Feb 24 | Fix | src/renderer/app.js | **Fast Pricing Mode session counter never updated — showed 0 calls after entire batch** — `startFastPricingUpdate()` called `loadCoins()` and `renderCoinList()` after the batch loop but never called `refreshSessionCounter()`. The main process correctly incremented `progressTracker.incrementSessionCalls(1)` for each `fast-pricing-update` IPC call, but the renderer display was never told to re-read the count. Fixed by adding `await refreshSessionCounter()` at the end of `startFastPricingUpdate()`. |
| Feb 23 | Fix | src/renderer/app.js | **Fast Pricing estimated time showed "0s" for all batch sizes** — Two `function formatDuration` declarations existed in app.js (line ~2369 taking seconds, line ~6111 taking milliseconds). JavaScript function hoisting means the second declaration always wins, so `confirmFastPricingUpdate` was passing raw seconds (e.g. 425) to the milliseconds version, which computed `Math.floor(425/1000) = 0` → `"0s"`. Fixed by removing the dead first declaration and converting the call to `formatDuration(estimatedSeconds * 1000)`, so 386 coins now correctly shows `~7m 5s`. |
| Feb 23 | Fix | src/modules/field-mapper.js, src/modules/settings-manager.js, src/main/index.js | **Price fields bypassed field mapping system — hardcoded mapping ignored user settings, stale prices never cleared** — `extractPriceFields()` hardcoded `price1=F … price4=UNC` and was called directly in both `mapToOpenNumismat()` and `fast-pricing-update`, completely bypassing the configurable field mapping system (the source dropdowns in Field Mappings had zero effect on what was written). Additionally, when Numista returned no price for a grade (e.g., no Fine price), the corresponding DB column was never touched, leaving old wrong values in place. Two fixes: (1) removed `extractPriceFields()` entirely — price fields now flow through the standard `getNestedValue(dataForLookup, numistaPath)` path like every other field; pricingData is merged into a `dataForLookup` object as `{ pricing: { f, vf, xf, unc } }` before the field loop so `'pricing.f'` resolves correctly; (2) when `pricingData` was fetched, all 4 price columns are always written — `null` for any grade not in the Numista response, overwriting stale values. `fast-pricing-update` similarly uses `buildFieldMapperConfig()` to resolve each field's `numistaPath` and writes all 4 columns explicitly. Settings migration added to `mergeFieldMappings()` to auto-correct the reversed sourceKeys (`price1: pricing_unc → pricing_f`, etc.) saved by previous buggy versions — users no longer need to manually reset field mappings. |
| Feb 23 | Fix | src/modules/field-mapper.js, src/modules/default-field-mapping.js, CLAUDE.md, docs/reference/PROJECT-REFERENCE.md | **Price grade→field mapping was reversed — UNC prices saved to Fine field, Fine prices saved to UNC field** — OpenNumismat numbers price columns ascending from worst to best grade: `price1=F (Fine)`, `price2=VF`, `price3=XF`, `price4=UNC`. All code and documentation had this backwards (`price1=UNC, price4=F`), causing every enriched coin to have its UNC and Fine prices swapped in the OpenNumismat UI. Root cause: the Feb 9 "Pre-Release Audit" fix saw fast-pricing using the correct `price1=F` mapping, assumed it was wrong, and reversed it to match `field-mapper.js` which was itself incorrect; the Feb 23 `extractPriceFields()` consolidation then cemented the wrong mapping as the documented canonical truth. Fix: reversed `extractPriceFields()` to `grades.f→price1, grades.vf→price2, grades.xf→price3, grades.unc→price4`; updated all four `price1-4` field descriptions and `defaultSourceKey` values in `default-field-mapping.js`; corrected schema table in `PROJECT-REFERENCE.md`; rewrote Lesson 21 in `CLAUDE.md` with full incident history and verification guidance (query the actual DB column, never trust display order or prior docs). Applies to both the regular merge path and fast-pricing — both call `extractPriceFields()`. |
| Feb 23 | Fix | src/modules/numista-api.js | **Mintmark 'P' (Philadelphia) never auto-matched pre-1980 US coins despite "missing mint mark" setting being on** — `matchIssue()` filtered year-matched issues with `i.mint_letter && mintmarksMatch(userMintmark, i.mint_letter)`, which excluded issues with no mint_letter (empty string) regardless of any setting. Pre-1980 Philadelphia coins on Numista have an empty `mint_letter`; OpenNumismat records them as `mintmark: 'P'`. With `emptyMintmarkInterpretation: 'no_mint_mark'` set, `P` and empty-mintmark should be equivalent, but the explicit `i.mint_letter &&` guard prevented this. Fix: after the mintmark filter yields 0 candidates, if `emptyMintmarkInterpretation === 'no_mint_mark'` and the user's mintmark normalises to `'P'`, fall back to matching no-mint-letter issues as a Philadelphia match. The fallback is safe because if `'P'` were a real explicit mint mark for that series (e.g. Perth Mint), the first filter would have found it and candidates would not be empty. With exactly one no-mark issue (the common case) the coin now auto-matches; with multiple the user sees a picker scoped to only the no-mark options rather than all three issues. |
| Feb 23 | Internal | src/modules/field-mapper.js, src/main/index.js, CLAUDE.md, docs/reference/PROJECT-REFERENCE.md, docs/reference/IPC-HANDLERS-QUICK-REF.md | **Consolidate duplicate price grade→field mapping into `FieldMapper.extractPriceFields()`** — The `price1=UNC / price2=XF / price3=VF / price4=F` mapping existed in two places with subtly different case handling: `mapToOpenNumismat()` used a direct `===` comparison against lowercase grade keys (fragile), while `fast-pricing-update` normalized grades with `.toLowerCase()` first (defensive). Added `static extractPriceFields(pricingData)` to `FieldMapper` as the single source of truth — it normalizes grade case, maps all four grades, and returns only keys present in the data. Both callers now use it. Updated Lesson 21 in CLAUDE.md and all reference doc line-number citations accordingly. |
| Feb 23 | Fix | src/main/index.js | **Auto-propagate omitted obversedesigner, obverseengraver, reversedesigner, reverseengraver, obverseimg, reverseimg, edgeimg, and series from type-level writes** — The `propagate-type-data` handler filtered user-selected fields against a hardcoded `typeLevelFields` allowlist that was missing these eight fields. Even when the user explicitly checked them in the comparison screen, they were silently dropped during propagation to same-type coins. The regular single-coin merge was unaffected (it uses `selectedFields` directly). Fixed by adding all eight missing fields to the allowlist. |
| Feb 23 | Fix | src/main/index.js | **Opening a coin detail then exiting without applying regressed the basic data icon from complete to in-progress** — When the user clicked a match card on the match screen, `update-coin-status` was called with `status: 'matched'`, which unconditionally built a fresh metadata object with `basicData: PENDING` and `issueData/pricingData: NOT_QUERIED`, overwriting any previously MERGED statuses in the in-memory progress cache. The database was never touched (correct data survived restarts), but during the session the coin cards showed the wrong icons. Fixed: the `'matched'` case now reads the coin's existing metadata from the database first and uses it as the base. `basicData` is only moved to `PENDING` if basic data retrieval is enabled in the current fetch settings and the existing status is not already `MERGED`. All other sections (issueData, pricingData) are preserved from the database, so previously applied data is never visually regressed by opening a coin. |
| Feb 23 | Feature | src/modules/settings-manager.js, src/renderer/app.js, src/renderer/index.html, src/resources/user-manual.html | **Use Stored Numista ID — skip search for previously matched coins** — Coins with a known Numista type ID now skip the search step and load the matched coin directly via `GET /types/{id}`, saving 1 API call per enrichment session. The ID is resolved from two sources in priority order: (1) enrichment metadata (`coin.metadata.basicData.numistaId`, set by a prior merge), and (2) the catalog database field mapped to `sourceKey === 'numista_id'` in the active field mapping (e.g. `catalognum4` by default — covers IDs the user entered manually before any merge). `AppState.numistaIdColumn` is cached once at collection load and refreshed after settings save. The match screen shows the stored match as a single pre-selected card (same appearance as a normal search result, including 180px obverse/reverse thumbnails from `typeData.obverse.thumbnail`); clicking the card proceeds to the comparison screen with zero additional API calls (the persistent API cache is already warm). "Search Again" overrides the stored match and runs a fresh search. Falls back to search automatically on 404 or any API error. Controlled by the new **Use Stored Numista ID** toggle in Data Settings (default: ON). `calculateConfidence()` returns 100 for the pre-selected card, rendering the green "100% match" badge. Fix included: `adaptedMatch` now includes `value` (the denomination `{numeric, text}` object) alongside the other search-result-equivalent fields so the denomination appears in the field comparison screen — matching the behaviour of the normal search flow when `basicData=false`. Deep type-level fields (ruler, weight, composition, etc.) are intentionally excluded from `adaptedMatch`; when `basicData=true` those fields reach the comparison via `result.basicData` as usual, since `handleMatchSelection` overwrites `AppState.selectedMatch` with `result.basicData` in that case. |
| Feb 23 | Fix | src/renderer/app.js | **"Search Again" button on match screen had no event listener and never worked** — The button (`id="searchAgainBtn"`) was present in the HTML but the corresponding click listener was never written in `app.js`. Added missing listener that clears `AppState.currentMatches` and calls `searchForMatches()`, enabling users to discard a direct match or any in-progress result set and run a fresh search. |
| Feb 24 | Fix | src/data/denomination-aliases.json | **Iranian dinar coins return no matches ("10 Dīnār - Rezā Pahlavī" not found by search for "10 dinars")** — Numista uses the diacritical transliteration "Dīnār" (macron ī/ā) as an invariant singular in all Iranian dinar coin titles regardless of quantity (e.g., "10 Dīnār", "50 Dīnār"). The plain English plural "dinars" used in S1 does not match this form. S2 (alternate denomination forms) was silently skipped because "dīnār" was absent from `denomination-aliases.json`, leaving `getAlternateSearchForms()` with nothing to try. S3 no-issuer fallback also used "dinars" and likewise failed. Fix: cross-referenced "dīnār" as a second canonical (mirrors the heller/haléř pattern): added "dīnār"/"dīnārs" to the existing `dinar` aliases, and added a new `dīnār` canonical with plural "dīnār" (invariant) and shared aliases. S2 now fires with `q="10 dīnār"` on Iran dinar failures. Also cross-referenced "manghir" as a second canonical for "akce": Numista titles Ottoman akçe/asper coins as "Manghir", so searching "akce" previously missed all of them; S2 now retries with "manghir". Research confirmed these are the only two denominations requiring macron/name-mismatch cross-referencing; all other world denominations (Arabic, Russian, Indian, East Asian, African) use plain Latin transliterations or are normalized by the Numista API. |
| Feb 23 | Fix | src/main/index.js, src/renderer/index.html, src/renderer/styles/main.css, src/resources/user-manual.html | **External links open inside app window instead of system browser (Microsoft Store certification failure)** — All `<a href="...">` links to external URLs were opening a new `BrowserWindow` inside the app rather than the system browser. Fixed via two-layer enforcement: (1) `setWindowOpenHandler` added to all `BrowserWindow` instances (main window, manual window) immediately after `loadFile()` to intercept all `target="_blank"` clicks and route them to `shell.openExternal()`; (2) external links in `index.html` converted from `target="_blank"` to `onclick="window.electronAPI.openExternal(...); return false;"`. Added `ext-link` CSS class rendering a `↗` indicator for all external links. Standalone `user-manual.html` retains `target="_blank"` (no preload access) — covered by the `setWindowOpenHandler` safety net. |
| Feb 22 | Fix | src/renderer/app.js, src/main/index.js | **Fractional denomination coins return no matches (Yemen 1/80 Rial 1931) + manual search year-in-q bug** — Two bugs. (1) Automatic search: the match-scoring code was updated in v1.1.2 to handle Unicode fraction characters returned by Numista (e.g., `"⅟₈₀ Riyal - Yahya"`), but the search *query* still sent the raw ASCII value from OpenNumismat (e.g., `coin.value="1/80"` → `q="1/80 rial"`). Numista's API does literal title matching; ASCII `"1/80"` does not match Unicode `"⅟₈₀"` in the Yahya coin's title, so the coin was invisible to all three search strategies. Fix: added `asciiToUnicodeFraction()` which converts ASCII fraction strings to their Unicode equivalents before they appear in `q`: standard vulgar fractions use precomposed Unicode characters (`"1/2"` → `"½"`, etc.); non-standard `"1/N"` fractions use FRACTION NUMERATOR ONE U+215F + subscript denominator digits (`"1/80"` → `"⅟₈₀"`); other non-standard fractions use FRACTION SLASH U+2044. Applied in S1 (`buildSearchParams`), S2 (alternate denomination forms), and S3 (no-issuer fallback). (2) Manual search: the raw user query (e.g., `"Yemen rial 1931"`) was passed as `q` with no parsing. `"1931"` in `q` returns 0 results because Numista type titles don't contain years (Lesson 32). Fix: extract 4-digit Gregorian year from the user's query → pass as `date` param; strip the coin's country name from `q` (issuer param already handles country). S3 fallback added to manual search: if issuer-constrained search returns 0 results, retry without `issuer`, moving country into `q`. `manual-search-numista` IPC handler updated to accept `date` param and log final API params as JSON to `main.log`. |

---

## v1.1.3

| Date | Type | Files | Summary |
|------|------|-------|---------|
| Feb 22 | Fix | src/renderer/app.js | **Match confidence penalised -20 for fractional denominations (e.g. "2 1/2 Shillings" scores 43% instead of ~63%)** — `parseNumericValue` handled pure ASCII fractions (`"1/2"`) and Unicode fractions (`"2½"`) but not mixed-number notation (`"2 1/2"` or `"21/2"`). `parseFloat("2 1/2")` stops at the space and returns `2`, while Numista's `value.text` of `"2½ Shillings"` correctly parsed to `2.5` via the Unicode path — causing a false mismatch and a -20 point penalty. Fix: added a mixed-number pattern `/^(\d+?)\s*(\d+)\/(\d+)$/` (non-greedy first group) inserted before the pure-fraction check. Handles both `"2 1/2"` (with space) and `"21/2"` (no space) → `2.5`; pure fractions like `"1/2"` still fall through to the existing check. |
| Feb 22 | Fix | src/modules/default-field-mapping.js | **Value field truncated for fractional denominations (e.g. "2½ Shillings" → "2")** — Numista returns fractional face values using Unicode vulgar fraction characters (e.g. `½` U+00BD) in `value.text`. The `transformValueNumber` regex `/^[\d\/\.]+/` is ASCII-only and stopped at the Unicode character, returning only the integer prefix. Fix: added a `UNICODE_FRACTIONS_TO_ASCII` map and a pre-pass in `transformValueNumber` that detects any Unicode fraction, extracts the integer prefix, and returns catalog-standard ASCII notation (e.g. `"2½ Shillings"` → `"2 1/2"`). All 13 common vulgar fraction characters covered. Notation follows Heritage Auctions / KM catalog convention; matches what OpenNumismat already stores for fractional denominations. |
| Feb 22 | Fix | src/renderer/app.js, docs/reference/PROJECT-REFERENCE.md, CLAUDE.md | **Historical sub-issuer coins return no matches (South Africa 1896 Shilling)** — Coins labeled with a modern country name (e.g., "South Africa") resolve to a modern Numista issuer code (`afrique_du_sud`) that only covers post-Union coins. Pre-Union issues (e.g., 1896 ZAR Shilling under "South African Republic") live in a completely different Numista issuer hierarchy and returned 0 results from all issuer-constrained searches. Fix: restructured `searchForMatches()` from 4 strategies to 3. Removed "core query" strategy (dead code — `buildCoreQuery` produced the same `q` as S1 whenever `coin.value` was present, and the `coreQuery !== baseParams.q` guard prevented it ever firing) and "minimal query" strategy (contradictory — passing `issuer=afrique_du_sud` while also putting "South Africa" into `q` required the country name to appear in the Numista coin title, which it never does; was strictly more restrictive than S1 and always returned a subset of S1's results). Replaced both with a single no-issuer fallback (new S3): drops `issuer` entirely, moves country name into `q` alongside the denomination (e.g., `q="South Africa 1 shilling"`), keeps `date` and `category` — mirrors how the Numista website's own full-text search finds coins regardless of issuer hierarchy. Documented the 3-strategy structure, reasoning, and removed-strategy rationale in PROJECT-REFERENCE.md and CLAUDE.md (Lesson 32) to prevent future drift. |
| Feb 22 | Fix | src/renderer/app.js, src/main/preload.js, src/modules/numista-api.js, docs/reference/PROJECT-REFERENCE.md | **Alias-resolved issuers score 0 for country match / dead scoring function removed** — Match confidence scoring was split across two functions: `calculateConfidence` in `app.js` (active, called by `renderMatches()`) and `calculateMatchConfidence` in `numista-api.js` (dead code, never called). Both were maintained in parallel for months, causing fixes to land in the wrong place. Root fix: (1) deleted `calculateMatchConfidence` from `numista-api.js` entirely; (2) exposed `ISSUER_ALIASES` to the renderer by loading `issuer-aliases.json` in `preload.js` and adding `issuerAliases` to `window.stringSimilarity`; (3) updated `calculateConfidence` in `app.js` to fall back to alias-code comparison (`issuerAliases[coinCountry] === match.issuer.code`) when raw string match fails — "Mandatory Palestine" now correctly scores +20 country points against "British Palestine" (code `palestine`); (4) documented the single-owner architecture in `PROJECT-REFERENCE.md` to prevent future drift. |
| Feb 22 | Fix | src/data/issuer-aliases.json | **Mandatory Palestine returns no search results** — "Mandatory Palestine" (the official name for the British Mandate territory 1920–1948) had no alias entry. Numista catalogs this issuer as "British Palestine" with code `palestine` (level 2, parent: Israel section). Without an alias, fuzzy matching failed to bridge "Mandatory"↔"British", returning zero results. Added alias family mapping "palestine", "mandatory palestine", "british palestine", "british mandate of palestine", "british mandate palestine", "palestine mandate", and "mandate of palestine" → `palestine`. Code verified via live /issuers API call 2026-02-22. |
| Feb 21 | Fix | src/data/issuer-aliases.json, src/modules/numista-api.js | **East Africa Protectorate returns no search results** — "East Africa Protectorate" had no alias entry, so fuzzy matching ran against all 11,756 Numista issuers. Two issuers share the identical name "East Africa" — `afrique_de_l_est` (level 1, British colonial) and `east_africa_islamic` (level 2, child of "Islamic states"). Both scored 0.6061 Dice; the old tie-breaker (higher level wins) picked `east_africa_islamic`, the wrong issuer, returning zero results. Fix 1: added alias entries for "east africa", "east africa protectorate", "british east africa", and "east africa colony" → `afrique_de_l_est` (verified via live /issuers API call 2026-02-21), bypassing fuzzy matching for known historical names. Fix 2: improved `resolveIssuerCode` tie-breaking to score the parent name against the query — an issuer with a relevant parent (e.g. parent="United Kingdom") is preferred over one with an irrelevant parent (e.g. parent="Islamic states"); parentless standalone issuers beat those with zero-scoring parents. Level number remains the final tiebreaker within the same hierarchy. |

---

## v1.1.2

| Date | Type | Files | Summary |
|------|------|-------|---------|
| Feb 19 | Internal | mcp/server.js, CLAUDE.md | **Add get_swagger_endpoint MCP tool** — New tool searches the 4,700-line Numista API swagger.yaml by path, HTTP method, or keyword. Returns full YAML definitions for matching endpoints (params, responses, schemas). Avoids reading the entire swagger spec for routine API lookups. |
| Feb 19 | Fix | src/renderer/app.js | **Empty Mintmark Interpretation ignored in issue picker** — Issue picker scored no-mintmark issues using `null === undefined` strict equality: Numista omits `mint_letter` entirely for Philadelphia coins (key absent → `undefined`), while OpenNumismat stores no mintmark as `null`. The `userHasMintmark` and `issueHasMintmark` expressions used `&&`-chaining without `!!`, so the comparison was always `null === undefined → false`, making `matchesMintmark` false for every blank-mint issue. Result: no PARTIAL MATCH badge appeared and no scoring separation — all year-matched issues rendered with equal weight regardless of the "No mint mark" setting. Fixed by normalizing both values with `!!` so `false === false` holds regardless of whether the underlying value is `null`, `undefined`, or `""`. Same normalization applied to `userHasType`/`issueHasComment` for consistency. |
| Feb 19 | Fix | src/modules/default-field-mapping.js | **Unit field missing from field comparison UI** — Numista API returns `value.text` with trailing whitespace (e.g., `"1 Dime "`). The `transformValueUnit` regex `/[\p{L}]+$/u` anchors to end-of-string, so the trailing space caused no match → null → unit field silently excluded from comparison. Fixed by trimming the input before applying the regex. |
| Feb 19 | Fix | src/data/issuer-aliases.json | **Issuer alias codes corrected via live API verification** — 5 of 8 entries in issuer-aliases.json used wrong codes (guessed by naming convention, never verified). United States and United Kingdom pointed to section-level codes that include child territories (causing Danish West Indies coins to appear in US searches). West Germany, East Germany, South Korea, and North Korea used codes that do not exist in the Numista API, causing 400 errors on every coin search for those countries. All 5 corrected: united-states→etats-unis, united-kingdom→royaume-uni, germany-federal-republic→allemagne, germany-democratic-republic→ddr, korea-south→coree_du_sud, korea-north→coree_du_nord. Verified via live /issuers API call on 2026-02-19. |
| Feb 19 | Fix | src/renderer/app.js, src/modules/numista-api.js, src/modules/denomination-normalizer.js | **ASCII fraction denomination mismatch** — OpenNumismat stores fractional coin values as strings like "1/2"; parseFloat("1/2") returns 1 (stops at /), so coins scored against Numista's "½" denomination received a -20 penalty. Fixed parseNumericValue() to handle N/D strings, added extractUnitFraction() to adjust coinValue when coinUnit contains a fraction prefix (e.g., unit="1/2 franc", value=1 → 0.5, "franc"), updated the backend title regex to capture Unicode fractions, and updated normalizeUnit() to convert ASCII fractions to Unicode before alias lookup. |
| Feb 19 | Fix | src/data/denomination-aliases.json, src/renderer/app.js, src/modules/numista-api.js | **US colloquial denomination scoring** — US dimes, nickels, quarters, and half dollars scored -20 when the collection stored "10 Cents" but Numista uses "1 Dime". Added "dime", "nickel", "quarter", "half dollar" to denomination-aliases.json. Added US_DENOM_CENT_VALUES equivalence table to both scoring functions so "10 cents" ↔ "1 dime" scores +25 instead of -20. |
| Feb 19 | Fix | denomination-aliases.json, denomination-normalizer.js, numista-api.js, preload.js, app.js, index.js | **Subunit-to-parent denomination scoring** — "25 Cents" vs "¼ Dollar" scored -20 because no code converted between subunits and parent units. Added `subunitOf` field to denomination-aliases.json mapping ~90 subunit denominations to their parent currency with conversion ratios (verified against UN currencies data + historical numismatic sources). New `valuesMatchViaSubunit()` function in both scoring paths converts via ratio before applying penalty. Covers modern currencies (cent/dollar, centime/franc, kopeck/ruble, etc.), non-100 ratios (fils/dinar at 1000, jiao/yuan at 10, iraimbilanja/ariary at 5), and historical systems (pre-decimal British, Dutch, French, Italian, Thai, Roman). |
| Feb 19 | Fix | src/main/index.js | **save-app-settings crash on first call after auto-update** — `save-app-settings` used `apiCache` directly (the module-level singleton) instead of `getApiCache()`. If the renderer called `save-app-settings` before any other IPC handler had triggered cache initialization (e.g., immediately after an auto-update restart), `apiCache` was still `null` and the handler crashed with `TypeError: Cannot read properties of null (reading 'writeSharedConfig')`. The settings write succeeded but the shared config was never updated, and the cache singleton was never initialized for that session — causing the monthly count to show 0. Fixed: changed to `getApiCache().writeSharedConfig(...)` so the singleton is lazily initialized at the correct custom path before any write attempt. |
| Feb 19 | Fix | src/main/index.js, CLAUDE.md | **Shared config and import didn't propagate cache path** — Three gaps caused the second machine to always start with zero API usage: (1) `writeSharedConfig()` payload in `save-app-settings` omitted `cachePath`, so `numisync-shared-config.json` had no record of where the cache lives; (2) `import-from-folder` never set `cache.location`/`cache.customPath` in local settings, so `getApiCache()` fell back to the empty default `userData/api-cache.json`; (3) `apply-shared-config` had the same omission. Fixed all three: `cachePath` now included in shared config payload, and both import handlers set the cache path and reset the `apiCache` singleton. All three sites also normalize the path — stripping a trailing `.NumiSync` segment if the user selected the subfolder directly — since `getApiCache()` appends `.NumiSync` internally. Updated Lesson 29 in CLAUDE.md. |

---

## v1.1.0

| Date | Type | Files | Summary |
|------|------|-------|---------|
| Feb 18 | Fix | src/main/index.js, src/resources/user-manual.html | **Shared config now includes default collection path** — `defaultCollectionPath` added to the payload written by `save-app-settings` and applied by both `apply-shared-config` and `import-from-folder`. Applied conditionally: only written to local settings if `fs.existsSync()` confirms the path is reachable from the importing machine (same UNC path or mapped drive). Silently skipped if not reachable, preventing broken auto-load on startup. Also added to `recentCollections` on import. |
| Feb 18 | Feature | src/main/index.js, src/main/preload.js, src/renderer/index.html, src/renderer/app.js | **Bootstrap import for new machines** — Added "Import from Another Machine" section (Settings → License Management) visible to all users regardless of supporter status. Clicking Browse opens a folder picker; the app reads `numisync-shared-config.json` from the selected folder (checks `.NumiSync/` subfolder first, then root as fallback), attempts Polar license activation, and only writes settings if activation succeeds — no partial imports. Specific error messages for each failure mode (key not found, invalid, device limit, network error). On success, reloads settings and calls `updateVersionBadge()` to unlock supporter features immediately. |
| Feb 18 | Fix | src/main/index.js, src/renderer/index.html | **Custom cache location polluted parent directory** — When a user selected a parent folder as the custom cache location, `api-cache.json` and `numisync-shared-config.json` were written directly into that folder instead of a predictable subfolder. Fixed: `getApiCache()`, `validate-cache-path`, and `migrate-cache` now always place files in a `.NumiSync` subfolder inside the selected directory (consistent with how per-collection settings are stored). A one-time startup migration in `migrateAppSettings()` strips any `.NumiSync` suffix from a stored `customPath`, normalising existing settings to the parent-only form. UI help text updated to explain the subfolder behaviour. |
| Feb 18 | Fix | src/main/index.js | **Multi-machine monthly count not read on new machine** — `getApiCache()` is a lazy singleton: if the renderer called `get-monthly-usage` before the user saved the custom cache path in settings, the singleton initialized on the default (local) path and stayed there permanently — changing settings had no effect on the already-running instance. Fixed: `set-cache-settings` now resets `apiCache = null` after saving, forcing re-initialization with the new path on the next call. Also fixed `get-shared-config` and `apply-shared-config` which used `apiCache` directly (crashing with a null-reference if called before any cache operation had been performed) — both now use `getApiCache()`. |
| Feb 18 | Fix | src/modules/api-cache.js | **Multi-machine monthly count clobbering fixed** — `_save()` (called by `set()`, `clear()`, and `_prune()`) was writing in-memory `monthlyUsage` to the shared cache file without re-reading from disk first. If Machine A made API calls between Machine B's last `incrementUsage()` and its next `set()`, Machine B's write silently reset the count to a stale lower value. Fixed: `_save()` now re-reads `monthlyUsage` and `monthlyLimit` from disk inside the lock before writing, matching the atomic pattern already used by `incrementUsage()`. `setMonthlyLimit()` and `setMonthlyUsageTotal()` were also updated to their own atomic lock-read-write cycles (bypassing `_save()`) so the re-read in `_save()` doesn't clobber their intentional changes. |
| Feb 18 | Fix | src/renderer/app.js, docs/reference/IPC-HANDLERS-QUICK-REF.md | **Year moved from q text to dedicated date parameter in search** — All search strategies (attempts 1, 2, and 4) were appending the coin year to the `q` free-text query (e.g. `"100 pesetas 1981"`). Numista type names don't contain years, so this returned 0 results and forced the minimal fallback, which burned up to 16 API calls fetching 500+ irrelevant types. Year is now passed as a separate `date` parameter which Numista filters against each type's issue date range. Since all fallback strategies spread `baseParams`, they inherit `date` automatically — including the minimal fallback, which now returns only types matching the coin's year instead of all types for the denomination across all eras. |
| Feb 18 | Fix | src/data/issuer-aliases.json, src/renderer/app.js | **Soviet Union issuer code corrected + search logging fixed** — `issuer-aliases.json` had `"ussr"` as the Numista code for Soviet Union, which is invalid and caused a 400 error on every Soviet Union coin search. Correct code is `ancienne_urss` (verified via fuzzy matcher against live `/issuers` endpoint). Also fixed `console.log` calls in `searchForMatches()` passing raw objects, which logged as `[object Object]` — now uses `JSON.stringify` for coin and search params. |
| Feb 18 | Feature | src/modules/api-cache.js, src/main/index.js, src/main/preload.js, src/renderer/index.html, src/renderer/app.js, src/resources/user-manual.html, docs/index.md | **Multi-Machine Sync (Supporter Edition)** — Custom cache location is now a premium feature gated by `check-feature-access('multiMachineSync')`. Free users see a disabled radio button with upgrade link; supporters unlock it. When a supporter saves settings with a custom cache path, a `numisync-shared-config.json` is written to the shared folder containing portable settings (API key, rate limits, TTL, license key). Other machines detect this file and show a one-click import banner. License key is pre-filled only — no auto-activation. |
| Feb 18 | Fix | src/modules/api-cache.js | **API count tracking fix for multi-machine use** — `incrementUsage()` now performs an atomic read-increment-write (lock → re-read `monthlyUsage` from disk → increment → write → release) instead of writing stale in-memory state. `getMonthlyUsage()` also re-reads disk on every call so the UI reflects the combined count across all machines. Prevents Machine A from clobbering counts written by Machine B between startup and next write. |

---

## v1.0.3

*Released February 17, 2026.*

| Date | Type | Files | Summary |
|------|------|-------|---------|
| Feb 17 | Internal | docs/_layouts/default.html, docs/_config.yml, docs/download.md | **Footer version hardcoded + stale repo links** — Footer showed "Version 1.0.0" permanently; replaced with `site.github.latest_release.tag_name` Liquid variable so it auto-updates on each release. Added `repository: inguy24/Numisync-Wizard` to `_config.yml` so Jekyll metadata resolves to the correct (renamed) repo. Updated all `numismat-enrichment` repo links in `_config.yml` navigation and `download.md` "View on GitHub" to `Numisync-Wizard`. |
| Feb 17 | Internal | docs/download.md | **Linux download links 404 — wrong arch suffix** — All three Linux links used `x64` suffix (`numisync-wizard-x64.AppImage/deb/rpm`) but electron-builder generates `x86_64` for AppImage/rpm and `amd64` for deb. Fixed all three hrefs to match actual release asset names. |
| Feb 17 | Fix | electron-builder.yml, src/main/updater.js, GitHub release v1.0.3 | **Update download broken — exe/latest.yml filename mismatch** — `latest.yml` in v1.0.3 release referenced `NumiSync-Wizard-Setup-1.0.3.exe` (old versioned naming) while the actual release asset was `NumiSync.Wizard.Setup.1.0.3.exe` (default electron-builder naming), causing electron-updater to 404 silently on download. Fix: renamed release asset to `NumiSync-Wizard-Setup.exe` (version-agnostic, matching `artifactName` in electron-builder.yml), updated `latest.yml` in the release to reference the new name. Also updated `checkGitHubVersion()` in `updater.js` to reference the renamed GitHub repo (`Numisync-Wizard` instead of `numismat-enrichment`). |
| Feb 17 | Fix | src/data/denomination-aliases.json, src/data/issuer-denomination-overrides.json | **Denomination alias audit — Americas/Africa gaps + accent overrides** — denomination-aliases.json: added sucre/sucres (Ecuador 1884–2000), austral/australes (Argentina 1985–1992), inti/intis (Peru 1985–1991) to §07; added dobra/dobras (São Tomé and Príncipe) to §16; added accented aliases córdoba/córdobas to cordoba entry, bolívar/bolívares to bolivar entry, colón to colon entry (for input normalization of accented user data). issuer-denomination-overrides.json: added perou → céntimo/céntimos (confirmed: "10 Céntimos - Peru"); added §08 bolívar — venezuela → bolívar/bolívares (confirmed: "1100 Bolívares - Venezuela"); added §09 córdoba — nicaragua → córdoba/córdobas (confirmed: "1 Córdoba - Nicaragua"); added §10 colón — costa_rica + salvador → colón/colones (confirmed: "1 Colón", "Colones - El Salvador"). Note: Numista issuer code for El Salvador is "salvador" (derived from catalogue URL pattern). |
| Feb 17 | Fix | src/data/denomination-aliases.json | **Denomination alias audit — 26 South/East/Southeast Asia denominations added** — South Asia (§13): mohar (Nepal silver coin, distinct from Mughal mohur; Numista: "mohar"/"mohars"), fanam (South Indian/Travancore; Numista: "fanam"/"fanams"). Japan historical (new §14b): mon, shu, bu, monme (aliases: momme), ryō (aliases: ryo). Korea historical (new §14c): mun (Joseon cash coin), yang (late Joseon), fun (aliases: pun; yang subdivision — Numista confirmed "1 Fun", "5 Fun" for Korean Empire), hwan (aliases: whan; South Korea 1953–62). China historical (new §14d): cash (aliases: kasu; round copper coin with square hole — also covers Vietnam Empire and South Indian copper), tael (aliases: taels, liang), mace (1/10 tael), candareen (aliases: candarin; 1/100 tael). Southeast Asia historical (new §15b): fuang (aliases: fueang; Thai 1/8 baht), salung (aliases: salueng; Thai 1/4 baht), solot (Thai ½ att), sapèque (aliases: sapeque; French Indochina), pe (Burma/Myanmar 1/16 kyat), mu (Burma/Myanmar 2 pe), mat (Burma/Myanmar 4 pe), keping (aliases: kepings; Malay Peninsula), pitis (Malay/Indonesian sultanates), quarto (aliases: quartos/cuarto/cuartos; Spanish colonial Philippines), octavo (aliases: octavos; Spanish colonial Philippines). All sourced from confirmed Numista page titles. |
| Feb 17 | Fix | src/data/denomination-aliases.json, src/data/issuer-denomination-overrides.json | **Denomination alias audit — 30 missing historical denominations added** — Added 30 denominations across 6 new/expanded sections. Germanic: ducat (ducato, ducati, ducaton, dukaten, dukat, dukát) + Czech/Slovak/Czechoslovak issuer override → dukát/dukáty. British/Medieval: noble, angel, testoon/teston. Dutch historical (new §04b): stuiver/stiver, duit. French historical (new §04c): écu (cross-referenced with scudo), denier, liard, sou. Italian States (new §04d): scudo (cross-referenced with écu), soldo/soldi, baiocco/baiocchi, grano/grana, grosso/grossi/gros, quattrino/quattrini. Iberian/Latin American: cruzado, tostão, vintém, milréis. Middle East: toman/tuman, qiran/kran. Ancient/Classical (new §19): denarius/denarii, sestertius/sestertii, aureus/aurei, solidus/solidi, follis/folles, antoninianus/antoniniani, as/asses, tremissis/tremisses. |
| Feb 17 | Fix | src/data/denomination-aliases.json, src/data/issuer-denomination-overrides.json | **Denomination alias audit — 5 bugs fixed** — (1) Som/Sum collision: "som" (Kyrgyz) was erroneously inside "sum" (Uzbek) aliases, causing `normalizeUnit("som")` to resolve to "sum". Removed "som" from sum's aliases. (2) Tyin/Tiyin collision: "tiyin" appeared in both "tyin"'s aliases and as its own canonical. Removed "tiyin" from tyin's aliases. (3) Tala/Dollar wrong grouping: Samoan "tala" was aliased under "dollar" but Numista lists Samoan coins as "Tala". Removed from dollar, added standalone "tala" canonical (plural: "tala") in the Oceania section. (4) Riksdaler/Rigsdaler wrong grouping: Swedish "riksdaler" and Danish "rigsdaler" were aliases under "thaler" — Numista uses the local names. Added cross-referenced canonicals for each (kept in thaler's aliases for Strategy 4 fallback), so Strategy 1 now searches the correct name directly. (5) Estonian Kroon missing override: "kroon" defaulted to "krone"/"kroner" but Numista uses "Kroon"/"Krooni" for Estonian coins. Added `"estonie": { "singular": "kroon", "plural": "krooni" }` to issuer-denomination-overrides.json. |
| Feb 17 | Fix | src/data/denomination-aliases.json | **Gulden/Florin search miss — Netherlands modern coins not found** — "gulden" was aliased solely to canonical "florin" (plural: "florins"), so searching "Netherlands 1 Gulden 1982" queried Numista for "1 florin" — finding only the unrelated 1807 Louis Napoleon "1 Florin" coin (44% match via fallback) and missing the correct "1 Gulden - Beatrix (1982–2001)". Fix: added a cross-referenced "gulden" canonical entry (aliases: ["gulden", "guilder"], plural: "gulden") after the existing "florin" entry, following the same pattern as the heller/haléř cross-reference (Lesson 17). Because JSON entries are processed in order, this overwrites `aliasMap["gulden"]` and `aliasMap["guilder"]` so `normalizeUnit("gulden")` = "gulden" (was "florin"). `ALL_CANONICALS["gulden"]` now equals ["florin", "gulden"] (appears in both entries), so Strategy 1 queries "1 gulden 1982" directly (correct Numista denomination name), and Strategy 4 also retries with "florin" as an alternate form. The "florin" entry and all "florin"/"florins" normalisation are unchanged — coins stored as "Florin" still search correctly. |

---

## v1.0.2

*Released February 2026. Full development log is in [Pre-v1.0.3 History](#pre-v103-history-compressed--no-type-column).*

---

## Pre-v1.0.3 History (Compressed — no Type column)

| Date | Files | Summary |
|------|-------|---------|
| Feb 17 | CLAUDE.md, docs/reference/EMOJI-ENCODING-GUIDANCE.md | **Post-Fix-8 Cleanup — Stale Rules Corrected** - Four stale/broken items fixed after verifying all 8 context burn reduction fixes. (1) CLAUDE.md §3: fixed broken `@EMOJI-ENCODING-GUIDANCE.md` path reference to correct `@docs/reference/EMOJI-ENCODING-GUIDANCE.md`; removed `file -i <filename>` verification line (Linux-only command, irrelevant on Windows, redundant since ui-strings.js uses Python binary ops). (2) CLAUDE.md §2: added `ui-strings.js` exception note to "all renderer JS in app.js" and "NEVER create standalone UI component files" rules — these rules directly contradicted the intentionally standalone file created by Fix 8. (3) CLAUDE.md QUICK CONTEXT: corrected IPC handler count from "~50" to "~65" to match IPC-HANDLERS-QUICK-REF.md (authoritative source). (4) EMOJI-ENCODING-GUIDANCE.md: updated tool names from old Claude API (`str_replace`, `create_file`, `bash_tool`) to Claude Code tools (`Edit`, `Write`, `Bash`); replaced stale `/mnt/project/` Linux paths; updated "SPECIFIC FILES WITH EMOJIS" section — removed `index.html` and `app.js` (now emoji-free after Fix 8), added `ui-strings.js` as sole restricted file; rewrote all 5 rules and examples to reflect Python binary mode workflow instead of bash cp; updated checklist to match post-Fix-8 architecture. |
| Feb 17 | CLAUDE.md | **Context Burn Reduction — Verification & Housekeeping Rules** - Verified all 8 fixes from CONTEXT-BURN-REDUCTION-PLAN.md are correctly implemented. Corrected two stale values in CLAUDE.md: (1) Module count updated from "18 files" to "12 files" (the plan's estimate; actual count after implementation is 12 modules with @fileoverview JSDoc verified on all). (2) Removed broken "Current work items → docs/planning/PHASE3-WORK-PLAN.md" row from task-based reading guide (PHASE3-WORK-PLAN.md was archived to docs/archive/ in Feb 9 — the row pointed to a non-existent file). Added new "Reference Doc Maintenance" table to CLAUDE.md §1 documenting the housekeeping rules required to keep the new reference infrastructure in sync: when adding/removing IPC handlers → update IPC-HANDLERS-QUICK-REF.md; when changing module exports → update @fileoverview; when adding modules → add @fileoverview + update QUICK CONTEXT count; when adding emoji UI strings → add to ui-strings.js only; when changing DB schema → update PROJECT-REFERENCE.md DATABASE-SCHEMA; when adding lessons → add to CLAUDE.md §5 under correct category. Note added that MCP server reads source files at query time so staying accurate in the docs keeps MCP tools accurate automatically. |
|------|-------|---------|
| Feb 17 | src/renderer/ui-strings.js (new), src/renderer/app.js, src/renderer/index.html, CLAUDE.md | **Context Burn Reduction — Fix 8 (Emoji Isolation → ui-strings.js)** - Extracted all 25 distinct emoji from `app.js` (38 emoji lines) and `index.html` (22 emoji lines) into a new `src/renderer/ui-strings.js` file. `app.js`: replaced standalone emoji literals (`'✅'` → `UI_STRINGS.ICON_CHECK`, etc.) and 8 embedded/template-literal occurrences via Python binary mode; added `.emoji-placeholder` initializer at start of first `DOMContentLoaded` handler that populates `data-ui-key` spans from `UI_STRINGS`. `index.html`: replaced all inline emoji with `<span class="emoji-placeholder" data-ui-key="KEY"></span>` spans; added `<script src="ui-strings.js"></script>` before `app.js` script tag. `CLAUDE.md §3` updated to reflect new scope: only `ui-strings.js` retains emoji restriction; `app.js` and `index.html` are now fully editable with standard Edit/Write tools. Verified with Python emoji scanner: `app.js` and `index.html` return 0 emoji lines; `ui-strings.js` has 25 emoji lines as expected. Result: every future UI edit to `app.js` or `index.html` can use standard tools without Python binary workarounds. |
| Feb 17 | src/main/index.js | **Context Burn Reduction — Fix 7 (#region comments in index.js)** - Added 12 paired `// #region` / `// #endregion` block comments to `src/main/index.js` grouping all code by domain. Regions: `App Lifecycle & Window Management` (window state, menu, app lifecycle events, lines 271–866); `Database Operations` (DB lock detection, collection IPC handlers, helper functions, lines 868–1138); `Search & Enrichment` (issuer resolution + Numista search handlers, lines 1140–1394); `Field Mapping & Merge` (compare-fields, merge-data, lines 1396–1572); `Progress Tracking` (update-coin-status, get-progress-stats, lines 1574–1655); `Settings` (Phase 1 app settings, cache management, default collection, Phase 2 settings + stats handlers, lines 1657–2114); `Image Handling` (get-coin-images, download-and-store-images, lines 2116–2245); `Utility` (open-external, check-installer-eula-marker, check-for-updates, get-app-version, open-manual, lines 2247–2293); `Field Mapping Configuration` (get/save/export/import/reset field mappings, lines 2295–2427); `Menu & Recent Collections` (menu:update-state, get/clear-recent-collections, lines 2429–2477); `Licensing (Polar SDK)` (all supporter status + license validation handlers + feature gating, lines 2479–3131); `Batch Operations` (fast pricing, API cache, batch propagate, lines 3133–3454). No emojis affected — standard Edit tool used. Goal: enables targeted reads and VSCode region folding so any domain-specific task can skip 10 of 12 regions without loading all 3,420+ lines. |
| Feb 17 | mcp/server.js (new), mcp/package.json (new), .mcp.json (new), .claude/settings.json | **Context Burn Reduction — Fix 6 (MCP Server)** - Created `mcp/server.js`, a Node.js MCP server using `@modelcontextprotocol/sdk@1.26.0` that exposes 6 on-demand tools for the project knowledge base. Tools: `get_ipc_handlers(filter?)` — filters IPC-HANDLERS-QUICK-REF.md by channel name or module without reading index.js; `get_module_api(module_name)` — returns @fileoverview JSDoc from any src/modules/ file; `search_lessons(keyword)` — full-text search across CLAUDE.md §5 lessons by category; `get_recent_changelog(n?)` — returns last N changelog entries (default 5, max 20); `get_database_schema(table?)` — extracts OpenNumismat schema section from PROJECT-REFERENCE.md with optional table filter; `get_denomination_aliases(unit)` — looks up any spelling variant in denomination-aliases.json and returns canonical, plural, and all aliases. Server reads files lazily on each tool call for always-fresh data. Registration: created `c:\numismat-enrichment\.mcp.json` with `mcpServers.numisync` entry (`.claude/settings.json` schema rejects top-level mcpServers key); added `enabledMcpjsonServers: ["numisync"]` to `.claude/settings.json` to auto-approve. Server path relative to repo root: `numismat-enrichment/mcp/server.js`. Dependencies installed in `mcp/node_modules` — separate from Electron app package.json. |
| Feb 17 | docs/reference/PROJECT-REFERENCE.md | **Context Burn Reduction — Fix 5 (DATABASE-SCHEMA section)** - Added comprehensive `## OpenNumismat Database Schema` section to PROJECT-REFERENCE.md, introspected from `examples/test.db` via `PRAGMA table_info()`. Documents all 14 tables: `coins` (109 columns organized into 9 thematic groups: identity/denomination, physical characteristics, edge/design, classification/catalog, pricing with grade mapping, collection management, acquisition/sale, signature, metadata), `photos` (high-resolution image storage — referenced by obverseimg, reverseimg, edgeimg, photo1-6, varietyimg, signatureimg), `images` (composite thumbnail storage — referenced ONLY by coins.image), and 10 supporting tables (tags, coins_tags, pages, fields, prices, description, settings, filters, lists, statistics, treeparam). Each image FK column explicitly notes which table it references to prevent the Lesson 5 error. Price columns cross-reference Lesson 21 and field-mapper.js:121-126 for the UNC/XF/VF/F mapping. Goal: Claude can now answer DB schema questions without reading source code or learning the hard way. |
| Feb 17 | docs/reference/IPC-HANDLERS-QUICK-REF.md (new), src/modules/*.js (all 12) | **Context Burn Reduction — Fix 2 (IPC Quick Ref) & Fix 3 (@fileoverview JSDoc)** - Implemented two documentation fixes from CONTEXT-BURN-REDUCTION-PLAN.md. Fix 2: Created `docs/reference/IPC-HANDLERS-QUICK-REF.md` — a complete quick-reference table of all ~65 IPC handlers in `src/main/index.js`, organized into 13 domain sections (Collection, Search, Merge, Progress, Settings Phase 1/2, Cache, Images, Field Mappings, Menu, Licensing, Batch, Utility). Each handler entry lists channel name, parameters, return shape, and module delegate. Includes critical Notes section covering Phase 1 vs Phase 2 settings distinction (Lesson 9), price field mapping (Lesson 21), and image column routing (Lesson 5). Fix 3: Added `@fileoverview` JSDoc block to all 12 modules in `src/modules/`. Each block documents: one-line purpose, all exported functions/class methods with brief signatures, storage paths (if applicable), lesson cross-references, module dependencies (Uses), and callers (Called by). Files with existing headers (default-field-mapping.js, metadata-manager.js, denomination-normalizer.js, mintmark-normalizer.js) had headers replaced with proper @fileoverview blocks. Files without headers (opennumismat-db.js, numista-api.js, field-mapper.js, settings-manager.js, api-cache.js, cache-lock.js, progress-tracker.js, image-handler.js) had @fileoverview inserted before the require statements. Goal: Claude can now understand any module's purpose and API surface from a 5-line read instead of reading the entire file; IPC handler lookup no longer requires reading 3,420 lines of index.js. |
| Feb 16 | issuer-denomination-overrides.json (new), denomination-aliases.json, denomination-normalizer.js, main/index.js, main/preload.js, renderer/app.js, CLAUDE.md, docs/reference/PROJECT-REFERENCE.md | **Issuer-Aware Denomination Override System** - Implemented comprehensive fix for denomination search failures caused by language-specific singular/plural forms. Root cause: the same canonical denomination (e.g., "centesimo") has different plural forms in different countries — Italian "centesimi" vs Spanish "centésimos". Accent-based differentiation is unreliable since users don't type accents. Solution: two-file architecture separating spelling normalization from search form selection. (1) `denomination-aliases.json` retains spelling variant → canonical + DEFAULT plural (correct for majority issuer). Centesimo plural fixed to "centesimi" (Italian). (2) New `src/data/issuer-denomination-overrides.json` maps `canonical → Numista issuer code → { singular, plural }` override forms for exception cases — only countries that differ from the default are listed. Covers 6 denomination families: centesimo (Uruguay/Panama/Chile use centésimos), centimo (Spain/Costa Rica/Venezuela/Paraguay use céntimos), krone/koruna (Sweden uses kronor; Czech/Slovak/Czechoslovak use korun), lira (Turkey: lira/lira; Israel: lira/lirot), dinar (Yugoslavia/Serbia: dinara), real (Spanish colonial: reales). (3) `denomination-normalizer.js` loads override file and exports `ISSUER_DENOMINATION_OVERRIDES`. (4) `index.js` IPC handler `get-denomination-aliases` now includes `issuerOverrides` in response. (5) `preload.js` extracts and exposes `issuerOverrides` via `window.stringSimilarity`. (6) `app.js`: `buildSearchParams()` restructured to resolve issuer FIRST (before building denomination query) so issuer code is available when `normalizeUnitForSearch()` is called; `normalizeUnitForSearch(unit, value, issuerCode)` gains optional 3rd param — checks override table before falling through to denomination-aliases.json default; `buildCoreQuery(coin, issuerCode)` gains 2nd param and passes it through; Strategy 2 passes `baseParams.issuer` to `buildCoreQuery`; Strategy 4 primaryForm uses issuer code. Adding new country-specific overrides requires one JSON entry in issuer-denomination-overrides.json — no code changes. Added Lesson #28 and PROJECT-REFERENCE.md Denomination Architecture section documenting the two-file design rationale and data flow. |
| Feb 16 | denomination-aliases.json | **Centesimo Plural Fix** - Fixed Italy 10 Centesimi 1924 (and all Italian/Vatican centesimo coins) returning 0 search results on first attempt, falling through to broad "Italy centesimo" fallback that returned all centesimo types (1, 2, 5, 10) instead of the specific match. Root cause: `centesimo.plural` in denomination-aliases.json was `"centesimos"` (Spanish plural). Numista uses the Italian form `"centesimi"`. When `getSearchForm("centesimo", 10)` returned `"centesimos"`, the query `"10 centesimos 1924"` produced 0 results; Strategy 3 then fell back to `"Italy centesimo"` (singular, no value) returning 4 results. Fixed by changing plural to `"centesimi"` — first attempt now sends `"10 centesimi 1924"` which finds the correct single result. Aliases array unchanged so `"centesimos"` and `"centesimi"` as stored DB values both still normalize correctly. |
| Feb 16 | docs/guides/INSTALLER-DISTRIBUTION-PLAN.md, scripts/run-wack.ps1 (new) | **WACK Testing Added to Store Submission Workflow** - After noticing Windows App Certification Kit (WACK) testing was missing from our plan per Microsoft documentation (https://learn.microsoft.com/windows/uwp/debug-test-perf/windows-app-certification-kit), added comprehensive WACK pre-submission testing to Phase 2.5. Created automated `run-wack.ps1` PowerShell script that finds latest MSIX in dist/, locates WACK executable, runs all certification tests (5-10 min), parses XML results for quick pass/fail summary, and opens detailed HTML report in browser. Added "WACK Pre-Submission Testing" section documenting when to run WACK, what it tests (manifest, APIs, performance, security, package integrity), how to interpret results (PASSED/WARNING/FAILED), common failures and fixes (debug config, restricted APIs, performance, High DPI), and WACK limitations. Updated Store Submission Checklist to include WACK testing (marked as missed for Feb 16 submission since Microsoft's review runs same tests). Updated Update Workflow to include WACK as required step between build and Store submission for all future releases. First submission already done without WACK — Microsoft certification will catch issues if any exist. |
| Feb 16 | docs/download.md (new), docs/index.md, docs/_layouts/default.html, docs/_config.yml, README.md, docs/installation.md, docs/guides/INSTALLER-DISTRIBUTION-PLAN.md | **Microsoft Store Submission & Download Page** - MSIX package submitted to Microsoft for Store certification. Created dedicated `/download` page with platform-specific sections (Windows/macOS/Linux) using inline SVG logos and "Coming Soon" placeholders. Replaced emoji platform icons on homepage with real SVG platform logos (Windows 4-pane, Apple, Tux). Simplified homepage hero section (removed broken Store link, added Download button linking to new page). Simplified homepage download section to compact platform logo strip. Updated nav bar to link to `/download` page. Updated README.md Code Signing table (Store status: submitted for certification). Added Microsoft Store as "Coming Soon" option in installation guide. Updated INSTALLER-DISTRIBUTION-PLAN.md with Phase 6 (Website Download Page Restructuring) documenting all changes. |
| Feb 10 | docs/guides/POLAR-ENVIRONMENT-SWITCHING.md, docs/archive/POLAR-ENVIRONMENT-AND-LICENSE-UX-COMPLETE.md | **Polar Environment Switching Guide** - Created comprehensive guide for switching between Polar.sh sandbox and production environments. Documents exact configurations for both environments: sandbox (org ID: 5e78bbbd, product ID: 4f7d17ca, server: 'sandbox') and production (org ID: 52798f3d, product ID: 50fd6539, server: 'production'). Both environments use license prefix "TNSKV1-" configured in Polar dashboard. Guide includes step-by-step switching instructions for both directions (sandbox→production and production→sandbox), file update locations (POLAR_CONFIG in index.js line ~2408, 6 checkout URLs in app.js lines 470/677/799/922/6140/6145), verification checklists for before/after production switch, and troubleshooting section covering license activation issues, validation counter problems, and checkout link errors. Completed all tasks in POLAR-ENVIRONMENT-AND-LICENSE-UX.md plan: Task 1 (environment guide), Task 2 (validation debugging - fixed logger path and added post-activation validate call), Task 3 (license entry UX - added form to App Settings), Task 4 (license versioning - TNSKV1- prefix already configured). Project now fully documented and ready for production deployment. Plan archived to docs/archive/ per CLAUDE.md §8. |
| Feb 10 | index.js, SETTINGS-CONSOLIDATION.md | **Settings File Consolidation** - Eliminated dual settings files (`settings.json` and `app-settings.json`) that caused redundancy and confusion. Root cause: `app-settings.json` was created to add cache configuration but duplicated existing fields (logLevel, supporter, eulaAccepted, windowBounds, recentCollections), causing maintenance burden and sync issues. Solution: Consolidated everything into `settings.json` as single source of truth. Updated `loadAppSettings()` to read from `settings.json` instead of `app-settings.json`, adding default `cache` structure and creating `cacheTtl` object from flat fields if needed. Updated `saveAppSettings()` to write to `settings.json` with proper merging to preserve all fields, maintaining flat `cacheTtlIssuers/Types/Issues` for backwards compatibility. Reversed migration in `migrateAppSettings()` to merge `app-settings.json` INTO `settings.json` (opposite direction from before), then archive as `.bak` file. All code now uses single `settings.json` with complete structure including cache config, API settings, license info, and UI state. Created comprehensive `docs/reference/SETTINGS-CONSOLIDATION.md` documenting the consolidation, settings structure, migration behavior, and developer guidelines. No more confusion about which file controls which settings. |
| Feb 10 | logger.js, index.js | **License Validation Debugging and Fixes** - Fixed two critical bugs preventing license validation tracking in Polar dashboard: (1) Logger was reading from wrong folder path - `logger.js` hardcoded folder name as `'NumiSync Wizard'` (from electron-builder productName) but actual userData folder is `'numisync-wizard'` (from package.json name in dev mode). This caused logger to fail loading `logLevel: "debug"` from settings.json at startup, defaulting to 'info' level and silently filtering out all `log.debug()` statements. Fixed by changing hardcoded path to match package.json name with explanatory comment. (2) Initial license activation never called validate endpoint - When user first entered license key, `validate-license-key` handler called `activate()` (correct) to register device, but never called `validate()` to increment Polar's validation counter, resulting in Polar dashboard showing "Validations: 0, Validated At: Never Validated" despite successful activation. Fixed by adding immediate post-activation `validate()` call with non-fatal error handling. Periodic validation (every 7 days) was already correctly implemented and working, but never triggered because initial validatedAt timestamp prevented it from running within first week. With both fixes, debug logging now works correctly, and license validation tracking in Polar dashboard works on first activation and every 7 days thereafter. |
| Feb 10 | index.html, app.js | **License Entry UX Improvement** - Fixed critical UX gap where users who purchased a license couldn't find where to enter it. License entry was only accessible through About dialog (Help menu or version badge click), not discoverable in Settings. Solution: Transformed License Management section in App Settings into a dual-state component that's always visible. When NO license exists, shows license entry form with password input field, "Activate License" button (with Enter key support), status messages, and "Purchase one here" link. When license EXISTS, shows license info table (device label, activation date, activation ID) with Validate/Deactivate buttons. Added three event handlers: license activation with loading states and 1.5s delay before UI refresh, Enter key triggering activation, and purchase link opening Polar checkout URL. Modified `loadLicenseManagementDisplay()` to toggle between entry form and info display based on license status, defaulting to entry form on API errors. HTML changes: removed `display: none` from `licenseManagementGroup`, added `licenseEntryForm` div with input/button/message elements, added `display: none` to `licenseInfoDisplay` and `licenseActions` for initial state, moved help text to separate paragraph with ID for show/hide control. Users can now easily enter license keys directly in Settings without hunting for the About dialog. |
| Feb 10 | .github/workflows/, build/, scripts/, src/main/, src/renderer/, electron-builder.yml, package.json, README.md, docs/ | **Cross-Platform Distribution Implementation (Phases 3-5, 1.5)** - Completed installer distribution plan: (1) Phase 3: GitHub Actions CI/CD - Created automated build workflows for Windows/Linux/macOS with version validation, SignPath integration prepared (commented until approval), and draft release creation. (2) Phase 4: Linux Support - Generated 7 multi-resolution PNG icons (16x16-512x512) via PowerShell script, configured AppImage/deb/rpm targets in electron-builder.yml. (3) Phase 5: macOS Support - Generated .icns icon via png2icons npm package, created comprehensive unsigned macOS installation guide (docs/macos-install.md), configured DMG targets for x64+arm64. (4) Phase 1.5: License Versioning - Implemented version-based feature gating system with V1/V2/V3 prefix detection, FEATURE_VERSIONS map, license version extraction (getLicenseVersion), semantic version comparison, IPC handler (check-feature-access), and renderer-side feature gating (checkFeatureAccess, showUpgradeModal). Users with v1 licenses can use v1 features; v2 features require purchasing v2 license. Added Code Signing Policy section to README.md (required by SignPath Foundation). Added build:mac, build:linux, build:all scripts to package.json. Updated INSTALLER-DISTRIBUTION-PLAN.md with completion status and implementation summary. Project now fully configured for automated cross-platform releases - only external dependency is SignPath Foundation application (Phase 2). |
| Feb 10 | app.js, index.html | **Cache Collision Detection UI Fixes** - Fixed two critical issues: (1) Collision detection was running on every settings save instead of only when cache location changes - added `AppState.currentCacheSettings` tracking and location comparison logic to only trigger checks when location actually differs. (2) Modal UI didn't match app design - restructured both modals to use standard modal-header/modal-body/modal-footer with proper button classes and close button handlers. Archived CACHE-COLLISION-DETECTION-PLAN.md as complete per CLAUDE.md §8. |
| Feb 10 | cache-lock.js, index.js, preload.js, index.html, app.js, FILE-LOCATIONS.md | **Cache Collision Detection and Multi-Instance Handling** - Added collision detection when configuring custom cache locations to prevent silent cache overwrites in multi-machine setups. When user selects a custom cache location that already contains cache files, the app now detects this and presents a modal offering to "Use Existing Cache" (recommended for multi-machine scenarios) or "Select Different Location". Detects and handles active cache locks - if another NumiSync Wizard instance is using the cache, shows a "Cache Locked" modal with retry option and lock owner information (hostname, process ID, timestamp). Stale locks (>5 minutes old) are automatically cleaned up. Cache metadata (entry count, size, last modified) is displayed in the collision modal to help users make informed decisions. Added two static utility methods to `CacheLock` class: `checkCacheLockStatus()` returns lock status (none/unlocked/stale/locked) and lock owner info, `getCacheMetadata()` returns cache file stats and validity. Enhanced `validate-cache-path` IPC handler to include collision detection results in response. Updated `migrate-cache` handler to accept `useExisting` parameter that skips migration when user chooses to use existing cache. Added collision detection modals to index.html with user-friendly messaging and multi-machine tips. Implemented collision-aware settings save flow in app.js with `handleCacheLocationChange()`, `showCacheCollisionModal()`, `showCacheLockedModal()`, and `saveCacheLocationSettings()` functions. Updated FILE-LOCATIONS.md with Cache Collision Detection section documenting all scenarios, multi-instance workflow, and troubleshooting for "Cache is locked" errors. Prevents data loss and improves UX for users sharing caches across multiple machines via network drives. |
| Feb 10 | index.html, app.js, index.js, preload.js | **Cache Location Settings UI Refactoring** - Removed standalone cache location modal and integrated cache location settings into the main Settings screen for better UX consistency. Cache location now appears as a section in Settings between "API Cache" and "Logging" with radio buttons for Default/Custom location, browse button with path validation, and lock timeout configuration. On first install, cache is automatically created in the default location with no user intervention required. Users can optionally change cache location from Settings - when changed, existing cache files are automatically migrated to the new location. Fixed IPC handler path issues (`validate-cache-path` simplified to only check write permissions without requiring cache-lock module). Added `migrate-cache` IPC handler that copies cache files when location changes. Removed `restart-app` handler (not needed - cache reinitializes on next API call). Settings now save without requiring app restart. Fixes module not found errors on startup and improves overall user experience by following app's existing design patterns. |
| Feb 9 | cache-lock.js (new), api-cache.js, settings-manager.js, progress-tracker.js, opennumismat-db.js, index.js, preload.js, index.html, app.js, FILE-LOCATIONS.md (new), PROJECT-REFERENCE.md | **Storage Architecture Reorganization** - Reorganized all file storage to improve multi-machine workflows and prepare for uninstaller. COLLECTION-SPECIFIC FILES now organized in `.NumiSync/` subdirectory next to .db file (cleaner, hidden on Mac/Linux): settings moved from `{name}_settings.json` to `.NumiSync/{name}_settings.json`, progress renamed from `{name}_enrichment_progress.json` to `.NumiSync/{name}_progress.json` (shorter), backups moved from `backups/` to `.NumiSync/backups/` with human-readable timestamps (`YYYY-MM-DD_HHMMSS` instead of ISO format). APP-WIDE FILES renamed for clarity: `settings.json` → `app-settings.json` (v3.0 structure with cache config), `numista_api_cache.json` → `api-cache.json`. NEW FEATURES: (1) Configurable cache location - users can point cache to shared network drive for multi-machine scenarios, avoiding duplicate API calls across computers accessing same .db file. (2) File locking (`api-cache.lock`) prevents cache corruption when multiple machines access shared cache simultaneously using atomic lock file creation with 30-second timeout and 5-minute stale lock detection. (3) Cache Location Settings UI modal with location radio buttons (default/custom), browse dialog, path validation (write permission + lock support test), and lock timeout configuration. All migrations are automatic and silent on first launch (old files preserved for safety). Created `cache-lock.js` module with `CacheLock` class for atomic file-based locking. Updated `api-cache.js` to use async locking on all write operations (`set()`, `incrementUsage()`, `setMonthlyLimit()`, `setMonthlyUsageTotal()`, `clear()`). Updated `getApiCache()` to support custom cache paths with fallback to default on initialization errors. Added 5 IPC handlers: `get-cache-settings`, `set-cache-settings`, `browse-cache-directory`, `validate-cache-path`, `restart-app`. Created comprehensive `docs/reference/FILE-LOCATIONS.md` documenting all file locations, platform-specific paths, uninstaller recommendations, migration notes, and manual cleanup procedures. Updated PROJECT-REFERENCE.md Storage Architecture section with new v3.0 structure. |
| Feb 9 | docs/ | **Version 2 Work Plan Created** - Archived PHASE3-WORK-PLAN.md to `docs/archive/PHASE3-WORK-PLAN-COMPLETE.md` per CLAUDE.md §8. Created VERSION2-WORK-PLAN.md consolidating incomplete Phase 3 tasks (3.1-3.7 OAuth & Numista Sync features) plus deferred tasks (3.8.3 Auto-Update Check, 3.10 Multi-Source Fetching, 3.11 Plugin Integration) into new work plan. Tasks renumbered 2.1-2.10. Completed Phase 3 tasks remain: 3.0 Application Menu Bar, 3.8 About/Licensing (partial), 3.9 Fast Pricing Update 💎, 3.12 Auto-Propagate 💎. Version 2 will implement core Numista sync functionality (one-way OpenNumismat → Numista collection upload with OAuth 2.0, data mapping, batch operations). |
| Feb 9 | docs/ | **Task 2.3 Advanced Field Mapping - COMPLETE** - Comprehensive audit confirms all 6 implementation steps from Advanced-Field-Mapping-PLAN.md are complete: (1) NUMISTA_SOURCES registry with 45+ source definitions in `default-field-mapping.js`, (2) `buildFieldMapperConfig()` in `settings-manager.js` to translate user settings to FieldMapper config, (3) Gap fixed - all 3 FieldMapper instantiations now use `settingsManager.buildFieldMapperConfig()`, (4) 6 IPC handlers + preload bridge methods for field mapping management, (5) Tabbed UI in Data Settings modal with Field Mappings tab, source dropdowns, bulk enable/disable, filter toolbar, export/import/reset capabilities, (6) CSS styles for tabs, wide modal, field mapping table. Feature completed February 2, 2026. Plan archived to `docs/archive/Advanced-Field-Mapping-PLAN-COMPLETE.md` per CLAUDE.md §8. |
| Feb 9 | index.js, app.js, numista-api.js, progress-tracker.js | **Pre-Release Audit Bug Fixes** - Comprehensive audit of search, retrieval, and auto-propagation system found 6 issues. (1) CRITICAL: Fast Pricing grade-to-price mapping was reversed vs normal merge flow - `price1` was mapped to Fair instead of Uncirculated, `price4` to Uncirculated instead of Fair. Every coin updated via Fast Pricing had prices swapped. Fixed mapping to match `field-mapper.js` convention: `price1=UNC, price2=XF, price3=VF, price4=F`. (2) CRITICAL: `applyBatchTypePropagation()` determined skip reasons using `duplicates[0].coin` (a matching collection coin) instead of the enriched source coin. When `duplicates` was empty, `enrichedYear` became `null` and ALL same-type coins showed "Different year". Fixed by passing `enrichedCoin` through the result object from `showBatchTypePropagationPrompt()` and using it for year/mintmark comparison. (3) HIGH: `get-coin-details` IPC handler did not parse metadata from the note field, while `get-coins` did. Any downstream code accessing `coin.metadata` after `get-coin-details` got `undefined`. Added metadata parsing matching `get-coins` behavior. (4) MINOR: Manual search issuer resolution failure was silently caught with empty `catch (e) {}`. Added `console.warn` logging for non-fatal issuer resolution failures. (5) MEDIUM: Removed dead `buildSearchQuery()` method from `NumistaAPI` class - leftover from old approach that appended `coin.country` directly to query text. All callers now use `buildSearchParams()` in renderer with the `issuer` parameter. (6) LOW: `loadProgress()` initial structure was missing `skipped: 0` in per-datatype stats (`basicData`, `issueData`, `pricingData`), while `resetStatistics()` included it. Added `skipped: 0` to all three for consistency. |
| Feb 9 | index.js | **Auto-Propagate Mint Resolution Fix** - Fixed two bugs preventing recent mint resolution and array-join fixes from carrying through auto-propagation. (1) `mint` field was missing from `typeLevelFields` in `propagate-type-data` IPC handler, so even when the user selected `mint` in the comparison screen it was silently dropped during batch propagation. Added `mint` to the allowed type-level fields list. (2) `mergeFields()` call in `propagate-type-data` did not pass `coinData` (the target coin's mintmark), so `resolveMintName()` in `mapToOpenNumismat()` could not fall back to the coin's `.db` mintmark when `issueData.mint_letter` was unavailable. For "same type, different issue" coins where `issueData` is null, this caused mint resolution to fall through entirely to `transformMintName()` which picks `mints[0]` — the old buggy behavior. Now passes `{ mintmark: currentCoin.mintmark }` matching how `merge-data` already does it. The `transformRulerPeriod()` fix (array join with deduplication) carries through automatically since it changed the transform function in `default-field-mapping.js` used by both paths. |
| Feb 9 | index.js | **Remember Window Position & Size** - App now saves window position, size, and maximized state to `settings.json` on close and restores them on next launch. Uses Electron's `screen.getAllDisplays()` to validate saved position is still on a connected monitor — gracefully falls back to default 1400x900 centered if the saved monitor is disconnected. Tracks pre-maximized bounds separately so unmaximizing after restore returns to the correct size/position. |
| Feb 9 | mintmark-normalizer.js, field-mapper.js, default-field-mapping.js, index.js, app.js | **Mint Name Resolution from Mint Letter** - Fixed mint field always picking first entry from type's `mints` array (e.g., "United States Mint of Philadelphia") regardless of which mint actually produced the coin. The `mint` field is MAIN data from the type endpoint, which returns ALL mints for a coin type. Previously `transformMintName()` blindly returned `mints[0].name`. Now correlates the mint letter (from issue data's `mint_letter` or the coin's .db `mintmark` as fallback) with the correct mint name using three strategies: (1) direct `letter` field match on mint objects, (2) reverse lookup via `US_MINT_MAP`/`WORLD_MINT_MAP` city-name maps, (3) parenthetical letter match. Added `resolveMintName()` to mintmark-normalizer.js, mint special-case block in field-mapper.js `mapToOpenNumismat()`, and `coinData` parameter threading through `compareFields`/`mergeFields`/`merge-data` IPC handler. When mint is resolved from a letter, the comparison screen pre-checks the mint field box via new `recommendUpdate` flag propagated through the comparison pipeline to `createDefaultSelection()`. Falls back to first mint when no mint letter is available. General transform in `mapToOpenNumismat()` now skips `mint` field (handled entirely in special case) to prevent `transformMintName()` from re-processing the resolved string value. |
| Feb 9 | default-field-mapping.js | **Ruler Period Array Join** - Fixed `transformRulerPeriod()` picking only the first ruler's dynasty/group (`value[0].group.name`), same `[0]`-picking pattern as the mint bug. Now joins all unique group names with `' / '` separator, matching the convention used by `transformRulerNames()`, `transformDesigners()`, and `transformEngravers()`. Deduplication via `Set` ensures co-rulers sharing the same dynasty produce a single value while different dynasties are preserved. |
| Feb 9 | app.js, index.js, numista-api.js | **Structured Search Query + Issuer Hierarchy Fix + Search Pagination + Manual Search Issuer + Coin List Fallback** - Fixed automatic searches wasting API calls and returning wrong results due to two issues: (1) `buildSearchParams()` used `coin.title` as the primary query source, passing un-normalized denomination plurals (e.g., "Crowns" instead of "Crown") that Numista cannot resolve. Restructured to build queries from structured fields first (`coin.value` + `normalizeUnitForSearch(coin.unit)` + `coin.year`), falling back to title only when structured fields are missing. Title fallback strips country name and applies `normalizeDenominationInQuery()`. Removed hardcoded `count: 20` to use the API default of 50. (2) `resolveIssuerCode()` used `.find()` which returned the first matching issuer — the section-level parent (e.g., "United Kingdom" group including Falkland Islands, Gibraltar) instead of the specific country. Numista's `/issuers` API returns a hierarchy with `level` (1-5) and `parent` fields. Fixed to use `.filter()` + pick highest `level` for exact matches, and prefer higher-level issuers in fuzzy matching. This eliminated territory coins polluting search results. Added search results pagination: when API returns more than 50 results (the per-page max), a "Load More Results (showing X of Y)" button appears at the bottom of the match list. Each click fetches the next page (1 API call) and appends results. Pagination state tracked in `AppState.searchPagination` across both automatic and manual search paths. Also added issuer filter to manual searches via `resolveIssuer()` passed to `manual-search-numista` backend handler (which now accepts `page` parameter). Added `buildCoinDisplayLabel()` fallback for coin list — shows denomination from structured fields (e.g., "1 Crown") instead of "(Untitled)" when title is empty. |
| Feb 8 | preload.js, numista-api.js, denomination-normalizer.js, denomination-aliases.json | **Unicode Normalization Fix for Match Confidence Scoring** - Fixed accented denomination names (e.g., Swedish "Öre", Czech "Haléřů") causing ~45-point scoring penalty due to Unicode NFC vs NFD mismatch. When OpenNumismat stores "ö" as a single precomposed character (NFC, U+00F6) but Numista API returns it as base letter + combining diaeresis (NFD, U+006F+U+0308), string comparison fails even though characters render identically. Added `normalize('NFC')` to both `diceCoefficient()` functions (preload.js and numista-api.js) for consistent bigram generation. Added accent-stripping fallback to both `normalizeUnit()` functions (preload.js and denomination-normalizer.js): first tries NFC-normalized lookup in alias map, then strips diacritics via NFD decomposition + combining mark removal and retries. This maps "öre"→"ore", "córdoba"→"cordoba", etc. automatically. Added "öre" as explicit alias for "ore" in denomination-aliases.json. All changes are local string operations — zero additional API calls. |
| Feb 8 | denomination-aliases.json, issuer-aliases.json (new), numista-api.js, denomination-normalizer.js, default-field-mapping.js, index.js, preload.js, app.js | **Heller/Haléřů Cross-Referenced Denomination + Issuer Alias Extraction + Unicode Unit Fix** - Fixed Bohemia and Moravia coins returning 0 search results because Numista uses "Haléřů" (Czech) not "Heller" (German) in coin titles, and the API doesn't cross-match them. Solution: denomination-aliases.json now supports cross-referenced entries — "heller" and "haléř" each list the other's aliases, creating bidirectional equivalence. The normalizer builds an `allCanonicalsMap` tracking every canonical a given alias belongs to. New `getAlternateSearchForms()` function returns all variant search forms (e.g., both "hellers" and "haléřů"). New search Strategy 4 in `searchForMatches()`: when strategies 1-3 return 0 results and the denomination has alternate forms, retries with each alternate. Also extracted hardcoded `ISSUER_ALIASES` from numista-api.js into `src/data/issuer-aliases.json` for easier maintenance. Added "Bohemia and Moravia" / "Protectorate of Bohemia and Moravia" / "Böhmen und Mähren" as issuer aliases (code: `boheme_moravie`). Fixed `transformValueUnit()` regex using ASCII-only `[A-Za-z]` which failed to extract unit from "10 Haléřů" (accented characters). Changed to Unicode-aware `[\p{L}]+$/u` to match any language's letters. |
| Feb 8 | denomination-aliases.json, denomination-normalizer.js, index.js, preload.js, app.js | **Denomination Plural/Singular Support + Missing Currencies** - Restructured denomination-aliases.json from flat arrays to `{ aliases: [...], plural: "..." }` object format with explicit plural forms for every denomination. Numista search is strict about singular vs plural ("1 centavo" matches, "1 centavos" does not). Previously `normalizeUnitForSearch()` used a flawed heuristic (check if input ends in 's', re-add 's' after normalization) which failed for non-English plurals (sol/soles, leu/lei, lira/lire) and misidentified singular words ending in 's' (fils, lats). New approach: `getSearchForm(canonical, numericValue)` uses the coin's numeric value to select the correct form — value=1 returns singular, value!=1 returns explicit plural from PLURAL_MAP. Updated `loadAliases()` to build both ALIAS_MAP and PLURAL_MAP from new JSON structure. IPC handler sends both maps to renderer. Added `normalizeDenominationInQuery()` for manual search: parses free-text for `<number> <denomination>` patterns and corrects plurality before sending to Numista API. Shows user the corrected query when normalization changes the input. Added ~40 missing UN-recognized currency denominations with researched alternate spellings: lek/qintar, dram/luma, manat/qapik, taka/poisha, ngultrum/chetrum, fening, riel, gourde, kip/att, lempira, quetzal, cordoba, rufiyaa/laari, metical, nakfa, somoni/diram, togrog/mongo, hryvnia, sum/tiyin, som/tyiyn, tenge/tyin, lari/tetri, balboa, sentimo, sente/lisente, khoums, iraimbilanja, and more. Added missing plural forms to all existing entries (cents, centavos, francs, dollars, pounds, etc.). |
| Feb 8 | logger.js (new), updater.js, index.js, preload.js, app.js, index.html, user-manual.html, numista-api.js, opennumismat-db.js, field-mapper.js, progress-tracker.js, metadata-manager.js, settings-manager.js, api-cache.js, image-handler.js, freshness-calculator.js | **Structured Logging, Support Workflow & Report an Issue** - Migrated all 383 `console.*` statements across 13 main-process/module files to `electron-log` via new centralized `src/main/logger.js` module. Each module uses scoped loggers (e.g., `[Database]`, `[NumistaAPI]`). Log levels mapped: `console.error` -> `log.error`, `console.warn` -> `log.warn`, operational milestones -> `log.info`, verbose traces -> `log.debug`. Renderer `console.*` captured automatically via `spyRendererConsole`. Added user-configurable log level setting in App Settings (error/warn/info/debug, default: info) with runtime switching. Added "Download Log File" button in Settings and "Report an Issue" modal (Help menu) with links to User Manual, GitHub Issues, and log download. New `export-log-file` IPC handler copies log to user-chosen location via Save As dialog. Log file: `%APPDATA%/NumiSync Wizard/logs/numisync-wizard.log` (5MB max, auto-rotated). Emoji characters in opennumismat-db.js and field-mapper.js replaced with ASCII equivalents (`[OK]`, `[MISMATCH]`, `[SKIP]`). User manual updated with new "Getting Help" section (section 18). |
| Feb 8 | denomination-aliases.json, app.js, numista-api.js | **Euro Denomination Scoring Fix** - Fixed "Euro Cents" results scoring higher than "Euro" results when matching coins with unit="Euro" but no numeric value. Three root causes: (1) Numista search API doesn't return `value` in results, so code falls back to title regex which only captured single-word units (`/^[\d.]+\s*[a-zA-Z]+/` → "2 Euro" from "2 Euro Cents"), losing the "Cents" distinction. Fixed regex to capture up to first separator (`/^[\d.]+\s*[^-–(,]+/` → "2 Euro Cents"). (2) When coin has unit but no numeric value, denomination scoring was entirely skipped. Added unit-only comparison branch: +15 for unit match, -10 for mismatch. (3) "Euro" and "Euro Cent" were missing from denomination aliases. Added euro section with variants (euro/euros/eur, euro cent/euro cents/eurocent). |
| Feb 8 | numista-api.js, index.js | **Session Counter Accuracy Fix** - Session counter in `fetch-coin-data` and `fetch-issue-data` IPC handlers was heuristically counting API calls based on which data types were requested, overcounting by 1 when `getType()` or `getTypeIssues()` returned from persistent cache instead of making a real HTTP call. Added `apiCallCount` property to NumistaAPI class, incremented in `request()` only on actual HTTP calls. IPC handlers now read `api.apiCallCount` instead of guessing. Session counter and monthly counter now always agree. |
| Feb 8 | api-cache.js (new), numista-api.js, index.js, preload.js, app.js, index.html, user-manual.html | **Persistent API Cache, Search Simplification & Monthly Usage Tracking** - New persistent disk cache (`numista_api_cache.json` in userData) stores issuers (90d default), type data (30d), and issue data (30d) across sessions. Eliminates redundant API calls — e.g., issuers list no longer re-fetched on every app launch. All 8 NumistaAPI instantiation points in index.js now pass persistent cache + user-configured TTLs. Usage tracking: `request()` auto-increments per-endpoint monthly counters; footer shows "Month: X/2,000" with color warnings at 75%+ and 90%+. Search simplification: `buildSearchParams()` now strips parentheticals from title and country upfront, Strategy 2 (parenthetical retry) removed — worst-case search drops from 4 to 3 API calls. New App Settings section: per-data-type cache TTL selects (30-360 days or "No caching"), monthly API limit, manual usage adjustment input, Numista dashboard link, Clear Cache button. New IPC handlers: `get-monthly-usage`, `set-monthly-usage`, `set-monthly-usage-total`, `clear-api-cache`. User manual updated with section 19 covering cache, settings, usage tracking, and Numista quota. |
| Feb 8 | numista-api.js | **Issue Matching Gregorian Year Fix** - Fixed issue picker showing all dates instead of just matching issues for coins using non-Gregorian dating (e.g., Japanese Meiji era). `matchIssue()` year filter was only checking the `year` field (era-specific, e.g., 14 for Meiji 14) but not `gregorian_year` (e.g., 1881). A coin with year 1881 matched zero issues because no issue has `year: 1881`. Now checks both `i.year` and `i.gregorian_year` against the user's year, correctly filtering to the 2 matching issues for 1881 Japan 1 Sen. |
| Feb 8 | app.js | **Auto-Propagate Cross-Country Catalog Fix** - Fixed auto-propagate falsely matching coins from different countries that share the same non-Numista catalog number (e.g., KM#132 exists in both USA and France). Non-Numista catalog systems (KM, Schon, Yeoman) reuse numbers across countries, so catalog-based matching now requires country/issuer validation. Added `countriesMatch()` helper with bi-directional includes for name variations. Numista ID matching (Priority 1) is unaffected since Numista IDs are globally unique. Coins with empty country fields are skipped for non-Numista catalog matches since their country cannot be verified. |
| Feb 8 | settings-manager.js, app.js | **Remember View State on Close** - App now remembers the current page, scroll position, filters (status, freshness), and sort settings when closed. On next launch with a default collection, the coin list restores to the same page/position/filters/sort the user left off at. State is saved per-collection via `uiPreferences.lastViewState` and persisted on each page/filter/sort change (debounced) plus on window close. View state is restored in `loadCollectionScreen()` before `loadCoins()` so the first render uses saved state. Reset Filters button clears saved state. |
| Feb 8 | app.js, main.css | **Issue Picker Pre-Selection** - When re-enriching a coin that already has issue data, the issue picker modal now pre-selects the previously chosen issue (radio checked, row highlighted) and shows a blue "PREVIOUS SELECTION" badge. The "Apply Selection" button is immediately enabled. Users can still change their selection. First-time enrichments are unaffected. |
| Feb 8 | denomination-aliases.json, index.js, preload.js, app.js | **Pence/Penny Alias Fix + Alias Deduplication** - Fixed "Pence" being aliased to "penny" which broke search for all Pence-denominated coins (e.g., Ireland 20 Pence 1998 returned medieval half-pennies instead of correct results). Split "pence" into its own canonical group since Numista treats Pence and Penny as distinct denominations. Eliminated 90-line hardcoded alias map duplication in preload.js by loading aliases from main process via `ipcRenderer.sendSync('get-denomination-aliases')` at startup — `denomination-aliases.json` is now the single source of truth. Added defensive duplicate check in `buildSearchParams()` that compares both normalized and original denomination forms against the title before appending, preventing contradictory search terms. |
| Feb 7 | EULA.txt, eula-windows.rtf, installer.nsh, updater.js, validate-version.js, post-version.js, package.json, electron-builder.yml, index.js, preload.js, app.js | **Installer Distribution Phase 1** - EULA in NSIS installer (RTF license screen + marker file for skipping in-app EULA), auto-update module (electron-updater + electron-log with manual "Check for Updates" menu item), version bump scripts (preversion validation, postversion reminders), installer EULA marker detection in checkEulaOnStartup(). New files: EULA.txt (plain text), build/eula/eula-windows.rtf, build/installer.nsh (creates/removes marker), scripts/validate-version.js, scripts/post-version.js, src/main/updater.js. Modified: package.json (build:win, version scripts, electron-updater/electron-log deps), electron-builder.yml (EULA license screen, NSIS include), index.js (updater import, IPC handlers, menu item), preload.js (checkInstallerEulaMarker, checkForUpdates channels), app.js (installer marker check before in-app EULA). |
| Feb 7 | denomination-aliases.json, denomination-normalizer.js, numista-api.js, preload.js, app.js | **Denomination Alias Normalizer** - Added denomination normalizer module to fix unit matching failures for transliteration/spelling variants. Coins with "kopeks" vs Numista "Kopeck" (dice=0.6, below 0.7 threshold) now match via alias lookup, fixing a 45-point scoring swing (-20 penalty to +25 bonus). External JSON alias file covers 100+ denominations across 16 regional groups. Main process uses `denomination-normalizer.js` module; renderer uses inlined copy in `preload.js` (Electron 28 sandbox prevents `require('fs')`). Search queries normalize spelling via `normalizeUnitForSearch()` while preserving plurality (Numista search is singular/plural sensitive: "kopeck" returns 0 results, "kopecks" finds matches). Three search builders updated: `buildSearchParams`, `buildCoreQuery`, `buildMinimalQuery`. Dice coefficient fallback preserved for unlisted denominations. |
| Feb 8 | default-field-mapping.js, field-mapper.js, app.js, main.css | **Field Comparison Consistent Ordering** - Fields in "Review and Select Fields" screen now display in consistent order grouped by category matching Data Settings API toggles. Added `category` (main/issue/pricing) and `displayOrder` properties to all 33 field definitions. Sort logic sorts by category then displayOrder. Category headers ("Type Data", "Issue Data", "Pricing Data") only appear when multiple categories are present (e.g., after fetching issue or pricing data) - no headers when only type data is shown. |
| Feb 8 | opennumismat-db.js | **Edge Image Display Fix** - Fixed edge images not displaying in field comparison "Current" column even when present in database. `getCoinImages()` was returning `edge: null` hardcoded. Now properly fetches edge image from photos table using `coin.edgeimg`. |
| Feb 8 | opennumismat-db.js | **Image Column Update Fix** - Fixed downloaded images not being linked to coins. `updateCoinImages()` was calling `updateCoin()` which blocked protected fields (obverseimg/reverseimg/edgeimg). Now uses direct SQL UPDATE to bypass protection when setting valid photo IDs. |
| Feb 8 | app.js, main.css | **Inline Image Field Previews** - Replaced separate "Image Comparison" section with inline image previews in the obverseimg/reverseimg/edgeimg field rows. Each image field now shows Current vs Numista images side-by-side (80x80px, hover to zoom 2.5x). Removed redundant "Download Images to Collection" button since images are now auto-downloaded when image fields are selected during merge. |
| Feb 7 | index.js | **Auto-Download Images on Merge** - When image fields (obverseimg, reverseimg, edgeimg) are selected in field comparison and user clicks "Apply Changes", images are now automatically downloaded from Numista and stored in the photos table. Previously users had to use a separate "Download Images" button. URLs are fetched from numistaData.obverse/reverse/edge.picture, downloaded via imageHandler, and stored via storeImagesForCoin(). |
| Feb 7 | main.css | **Fetch More Data UI Overflow Fix** - Fixed "Additional Data Available" section buttons being clipped on narrow screens. Added flex-wrap, proper min-width, and overflow handling to fetch-more-card and fetch-more-data-section. |
| Feb 7 | app.js, image-handler.js | **Edge Image URL Fallback** - Fixed edge images not downloading because Numista API uses `edge.picture` (nested) instead of `edge_thumbnail` (top-level). Added fallback from `edge_thumbnail` to `edge.picture` in handleImageDownload() and image-handler.js. |
| Feb 7 | opennumismat-db.js | **Image Storage Table Fix** - Fixed downloaded images not appearing in OpenNumismat. Images were being stored in the `images` table but `obverseimg`/`reverseimg`/`edgeimg` columns reference the `photos` table. Added `insertPhoto()` method and updated `storeImagesForCoin()` to use photos table. |
| Feb 7 | app.js, numista-api.js | **Numista ID Perfect Match** - Search results now show 100% confidence for coins that were previously enriched with the same Numista type. Checks `coin.metadata.basicData.numistaId` against search result `id` field. Ensures previously matched coins appear at top of search results. |
| Feb 7 | app.js | **Edge Image Download Fix** - Fixed edge images not being downloaded when clicking "Download Images". The `edge_thumbnail` from full type data was being overwritten with `undefined` from search results (which don't include edge thumbnails). Now preserves the edge_thumbnail from basicData. |
| Feb 6 | app.js | **Premium Features Advertising Update** - Updated license prompt modal and EULA to list both premium features: Fast Pricing Mode and Auto-Propagate. License prompt now shows feature names with descriptions. EULA Section 3(b) now mentions both batch pricing updates and batch type data propagation. |
| Feb 6 | user-manual.html, TASK-3.12, PHASE3-WORK-PLAN.md | **Task 3.12 Documentation Complete** - Added Auto-Propagate section to user manual with full feature documentation (how it works, what data gets propagated, matching criteria, skipped coins, disabling the feature). Updated License Tiers table to include Auto-Propagate. Updated FAQ with premium feature list. Marked Task 3.12 as fully complete in task document and work plan. |
| Feb 6 | app.js | **Auto-Propagate Progress Bar** - Added inline progress bar to batch type propagation modal. Shows "X/Y (Z%)" format with visual progress bar during operation, matching Fast Pricing Mode UX. Displays current coin being processed. Modal transitions to results view when complete. |
| Feb 6 | app.js | **Match List Scroll Fix** - Fixed matching coins list not returning to top when selecting a new coin. Added scroll-to-top logic in showScreen() when transitioning to match screen, ensuring `.app-main` container resets to top position. |
| Feb 6 | index.js, app.js | **Auto-Propagate Field Selection Fix** - Fixed auto-propagate overwriting fields that weren't selected for the original merge. Previously, propagate-type-data hardcoded all type-level fields to `true`. Now passes `selectedFields` from the original merge through the propagation flow (`showBatchTypePropagationPrompt` → `applyBatchTypePropagation` → `propagateTypeData` IPC). Handler now only propagates fields the user explicitly checked. Added skip logic for coins when no applicable fields are selected. |
| Feb 6 | index.js, app.js | **Auto-Propagate Bug Fix** - Fixed auto-propagate prompt not appearing after enrichment. Issue 1: `get-coins` IPC handler now parses metadata from note field so coins have `metadata.basicData.numistaId` available for matching. Issue 2: Fixed wrong fallback defaults in `getCatalogSlotMapping()` - was using 'Krause'/'Numista'/null/null, now correctly uses 'KM'/'Schön'/'Y'/'Numista' to match default-field-mapping.js and Numista API catalog codes. |
| Feb 6 | app.js, numista-api.js | **Coin Match Scoring Improvements** - Fixed broken denomination matching (was comparing numeric 1 vs 0.01, now uses text comparison). Added progressive search fallback for zero-result queries (strips parenthetical terms like "(Nazi)", tries simplified queries). Rebalanced scoring weights: Title 30pts, Year 25pts (+bonus) or -15pts (penalty for out-of-range), Country 20pts, Denomination 25pts (match) or -20pts (mismatch), Category +10pts (standard circulation) or -10pts (patterns/proofs). Fixed "1 Cent" vs "1 Dime" false match (same numeric value but different units now penalized). Extracts denomination from title as fallback when value.text missing from API response. |
| Feb 6 | settings-manager.js, app.js, index.html, TASK-3.12 | **Task 3.12.11 Auto-Propagate Toggle** - Added checkbox in Data Settings to enable/disable the Auto-Propagate feature (default: enabled). When disabled, the post-merge detection prompt is skipped. Updated PREMIUM_FEATURES name to "Auto-Propagate" for consistent user-facing terminology. Setting persists via fetchSettings.enableAutoPropagate. |
| Feb 6 | index.js, numista-api.js, app.js, index.html, main.css | **Task 3.12 Completion** - Silent Type Data Reuse (3.12.4): Added typeDataCache Map in main process, caches type data by typeId, cleared on collection load, skips API calls for previously fetched types. Empty Mintmark Setting UI (3.12.7): Added radio buttons in Data Settings for empty mintmark interpretation (no_mint_mark/unknown). Issue/Pricing Matching (3.12.8): matchIssue() now accepts options with emptyMintmarkInterpretation, detects privy marks and signatures in issues, returns privyMarksDetected/signaturesDetected flags. Skipped Coins Handling (3.12.9): Enhanced applyBatchTypePropagation() with detailed tracking of full-data vs type-only updates, skip reasons stored in batchProcessed metadata, improved results modal showing skip list with reasons. |
| Feb 6 | app.js, main.css, index.js, preload.js, settings-manager.js, PHASE3-WORK-PLAN.md | **Task 3.12 Batch Type Data Propagation (PREMIUM)** - After enriching a coin, detects other coins in the collection sharing the same Numista type (via numistaId or catalog numbers). Shows matching coins grouped into True Duplicates (same type+year+mintmark - can receive ALL data) and Same Type/Different Issue (type data only). Detection is FREE; applying to all matching coins requires premium license. Implements strict catalog matching (ALL populated slots must match), normalizeCatalogNumber() for prefix stripping, categorizeMatchingCoins() for duplicate detection. Adds propagate-type-data IPC handler for batch database updates. Adds emptyMintmarkInterpretation setting (no_mint_mark/unknown). Premium modal with gold gradient styling. |
| Feb 5 | index.html, app.js, main.css | **Header Consolidation** - Merged collection controls into main app header. Collection title now displays centered in header when collection is open. Combined "App Settings" and "Data Settings" into a single gear icon dropdown button (saves header space). Fast Pricing Mode and Close Collection buttons moved to header actions area. Removed separate collection-header section from collection screen for cleaner layout. |
| Feb 5 | index.html, app.js, main.css, settings-manager.js | **Sticky Info Bar Toggle** - Stats and filters area redesigned as a unified card with dog-ear corner pin toggle. Click the thumbtack icon on the top-left corner to pin/unpin the info bar. When pinned, the card stays fixed at the top while scrolling through the coin list. Thumbtack rotates from slanted (unpinned) to vertical (pinned) with smooth animation. Preference persists per-collection via uiPreferences.stickyInfoBar setting. |
| Feb 5 | index.html, app.js, main.css, index.js, preload.js, settings-manager.js | **Grid View Mode** - Added toggleable grid view as alternative to list view for coin collection. Responsive CSS Grid layout (auto-fill with 180px min cards, adapts to window size). Toggle button with SVG icons in filters bar. View Mode submenu in Electron View menu (List/Grid radio options). Preference persists per-collection via uiPreferences.defaultView setting. Grid cards show larger thumbnails (60px), 2-line truncated title, status borders preserved. Full Fast Pricing Mode compatibility: checkboxes in top-left corner with backdrop, fp-updated/fp-failed/fp-ineligible status styling. |
| Feb 5 | index.js, app.js, preload.js | **Fast Pricing Menu Integration** - Added Fast Pricing Mode controls to application menu bar. View menu: Enter/Exit Fast Pricing Mode (premium-gated with license prompt for non-supporters). Edit menu: Select All Eligible for Pricing, Select Displayed for Pricing, Clear Pricing Selection, Start Pricing Update (N)... with dynamic count. Menu state syncs in real-time with toolbar selections. |
| Feb 5 | user-manual.html | **User Manual v1.1 Update** - Comprehensive documentation update covering all Phase 3 features: EULA acceptance flow, License Management section (Free vs Supporter tiers, device limits, activation/deactivation), Fast Pricing Mode premium feature, expanded Menu Bar & Keyboard Shortcuts section with all menu items and accelerators, App Settings vs Data Settings separation, Default Collection feature, Search Category filter, improved Issue Picker with images and sorting, Image Lightbox feature, maxBackups setting. Added new troubleshooting items for license issues. Added 7 new licensing FAQ entries. Updated TOC navigation for all new sections. |
| Feb 5 | app.js, index.html, main.css | **Fast Pricing Mode UI Improvements** - Renamed button from "Fast Pricing Update" to "Fast Pricing Mode" for clearer toggle behavior. Added inline progress bar in toolbar showing "2/50 (4%)" format. Coin completion now uses persistent row highlighting (green border+tint for success, red for failure) instead of checkmark icons - highlighting persists after batch completes until exiting mode. Fixed multi-page tracking so coins updated on other pages show highlighting when navigating to them. |
| Feb 5 | app.js | **UX Fix** - Collection list now maintains position when returning from match/comparison screens. Uses `scrollIntoView()` to center the clicked coin in the viewport on return, works reliably across all pagination pages. Applies to all return paths (back to list, apply changes, skip). |
| Feb 5 | index.html, numista-api.js, app.js, main.css | **Bug Fixes** - Fixed "Skip This Coin" button (corrupted HTML tag), fixed issue picker to show ALL year-matched issues sorted by match quality (best matches first), fixed mintmark matching logic so "no mintmark" correctly matches "no mintmark" issues, added "Other options" section header when mixed match qualities |
| Feb 5 | app.js, index.html, main.css, index.js, preload.js | **Task 3.9 Fast Pricing Update (PREMIUM)** - Batch pricing updates for matched coins via "Fast Pricing Mode". Enter mode via button (premium-gated), checkboxes appear next to eligible coins (must have numistaId AND issueId). Selection options: Select All Eligible, Select Displayed, Clear. Confirmation dialog with estimated time, single pre-batch backup, 1-second rate limiting. Real-time progress in footer status bar, coin row visual feedback (checkmark/X), UI locking during batch. Successful coins deselected for easy resume on cancel. Completion modal with results summary. |
| Feb 5 | app.js | **EULA v2.0 Update** - Added License Tiers section (Free vs Supporter, 5-device limit, non-transferable, covers current major version + all updates, discounted upgrades to future major versions, feature access terms), Data Collection & Privacy section (local-only data, no PII collected, device fingerprint disclosure), California Privacy Rights (CCPA/CPRA compliance - right to know/delete/opt-out/non-discrimination), No Obligation to Support section (no guaranteed updates/support/maintenance, may discontinue at any time), Refunds section, Changes to Agreement section, updated restrictions to cover license key sharing/circumvention |
| Feb 5 | index.html, app.js, main.css, index.js | **License UI Indicators** - Version badge in header ("FREE VERSION" uppercase gray gradient / "Supporter Edition" gold), Fast Pricing button shows locked/unlocked state with lock icon and grayed styling, "Purchase License Key" menu item in Help menu (hidden for supporters), UI refresh on deactivation, device limit corrected to 5, removed neverAskAgain option (nag only stops with active license) |
| Feb 5 | index.js | **Polar Sandbox + License Fixes** - Switched to Polar sandbox for testing, fixed license validation to check `result.licenseKey.status` instead of `result.status`, fixed device fingerprinting to use consistent machine ID (hostname+platform+MAC hash) instead of timestamp to prevent duplicate activations |
| Feb 4 | index.js, preload.js, index.html, app.js | **License Management** - App Settings section for license management (device label, activation date, activation ID), validate/deactivate buttons, periodic license validation every 7 days with offline grace period, activation limit error handling (5 devices) |
| Feb 4 | index.js, preload.js, app.js, package.json | **Task 3.8 Licensing System** - Polar SDK integration, license key validation, About dialog with supporter status, license prompt at enrichment thresholds (20, then every 20), premium feature gating infrastructure |
| Feb 3 | index.html, app.js, main.css | **UI Compaction** - Stats bar + summary on same row (~250px saved), pagination moved to footer, error/skip counts as hover tooltips |
| Feb 3 | index.html, app.js, main.css, user-manual.html | **Logo Integration** - Added logo_with_text.svg to header, welcome screen, About dialog, EULA, and User Manual; icon.png/icon.ico added to build folder for app icon |
| Feb 3 | Multiple | **Rebrand** - Renamed from "Numismat Enrichment Tool" to "NumiSync Wizard" with subtitle "for OpenNumismat" |
| Feb 3 | index.js | Help menu - User Manual opens in dedicated Electron window (F1), centered on same screen as main window |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - Settings menu now separates App Settings (API key, backup) from Data Settings (fetch options, field mappings) |
| Feb 3 | index.js, preload.js, app.js | Task 3.0 Application Menu Bar - cross-platform Electron menu, Recent Collections tracking, keyboard shortcuts, menu state management |
| Feb 3 | PHASE3-WORK-PLAN.md | Added Task 3.0 Application Menu Bar - cross-platform Electron menu with Recent Collections, state management |
| Feb 3 | main.css | Issue picker image zoom - hover to enlarge 4x (matching coin selection behavior), overflow handling |
| Feb 3 | index.js, preload.js, index.html, app.js | Default Collection feature - auto-load on startup, browse/set/clear in Settings |
| Feb 3 | index.html, app.js, main.css | Task 2.5 Legal & Compliance - EULA modal, first-launch acceptance, Numista attribution in Settings |
| Feb 3 | electron-builder.yml, package.json, LICENSE.txt, build/*, docs/BUILD-GUIDE.md | Task 2.4 Packaging - electron-builder config, NSIS installer, build scripts, build documentation |
| Feb 2 | app.js, main.css | Advanced Field Mapping UI - tab bar, source dropdowns, bulk enable/disable |
| Feb 2 | opennumismat-db.js, settings-manager.js, index.js, index.html, app.js | Backup policy - maxBackups setting, autoBackup enforcement, PROTECTED_FIELDS guard |
| Feb 2 | mintmark-normalizer.js (NEW), numista-api.js, app.js, preload.js | Advanced matching - mintmark normalization, Dice coefficient fuzzy matching, issuer code caching |
| Feb 2 | index.js, app.js | Database safety check - lock detection, blocking warning dialog |
| Feb 2 | index.html, app.js, main.css | Image lightbox - click to view full size, hover zoom increase |
| Feb 2 | app.js, settings-manager.js, index.js, index.html | Category-based search parameter (coins/banknotes/exonumia filter) |
| Feb 2 | index.html, app.js, main.css, index.js, preload.js | Issue picker enhancements - user coin images, Numista link, mint registration fix |
| Feb 2 | app.js | Search results - confidence sorting, replaced Value with Category field |
| Feb 2 | index.js, app.js | Session call counter fix - increment on API calls, display refresh |
| Feb 1 | app.js | Status bar API call estimate fix - update after collection load |
| Feb 1 | settings-manager.js, index.js, index.html, app.js | Task 2.9 Settings file management - API key migration, field mappings defaults, reset button |
| Feb 1 | index.html, main.css, app.js | Counter strip redesign - 3 data-type cards with progress bars |
| Feb 1 | index.js | Pricing data fix - removed dead `incrementApiCalls` call blocking return |
| Feb 1 | opennumismat-db.js, main.css | Image display fix - photos table vs images table, enlarged selected coin images |
| Jan 31 | index.js, progress-tracker.js, app.js | Skip functionality - database persistence, statistics counters, prohibited icon |
| Jan 31 | index.html, main.css, app.js, index.js, preload.js | Issue Picker UI - modal, styling, pricing fetch for selected issue |
| Jan 31 | settings-manager.js, numista-api.js, index.html, app.js | Data independence - all three data types optional, smart issue matching |
| Jan 31 | app.js, numista-api.js | Image handling fixes - preserve thumbnails, correct table reference |
| Jan 31 | numista-api.js | Issue data fix - API returns array directly, not wrapped in `.issues` |
| Jan 31 | app.js | Automatic search fix - removed series field, year in query string |
| Jan 31 | package.json | Added axios dependency |
| Jan 31 | index.html, app.js | Emoji encoding fix - Python binary replacement for corrupted UTF-8 |
| Jan 31 | app.js, index.html, main.css | Pagination - 100 coins per page, navigation controls |
| Jan 28 | index.js | progressTracker method fix - updateCoinInCache not updateCoinStatus |
| Jan 28 | index.js | Metadata write after merge - icons now show merged status |

---

## Feature Releases

### Phase 2 - Enhanced Features (January-February 2026)

**Completed Tasks:**
- Task 2.1: Metadata storage in note field (HTML comments)
- Task 2.2: Granular status tracking (basic/issue/pricing)
- Task 2.3: Data Settings UI + Advanced Field Mapping
- Task 2.4: Conditional API calls + Issue Picker
- Task 2.5: Freshness indicators
- Task 2.6: Filter & Sort
- Task 2.8: Images (display, download, comparison)
- Task 2.9: Settings file management

**Not Started:**
- Task 2.7: Fetch More Data

### Phase 1 - Core Functionality (January 2026)

- Numista API integration
- Basic coin search and matching
- Field comparison and selective merging
- Progress tracking
- OpenNumismat database integration
- Settings management
- Manual search capability
- Skip coin functionality

---

## Notes Work Plan Status

### Phase 1 (Tackle Now) - COMPLETE
- 1.1 Session Call Counter Fix
- 1.2 Search Results Display Improvements
- 1.3 Select Issue Screen Enhancements
- 1.4 Metadata Preservation Verification
- 1.5 Category-Based Search Parameter
- 1.6 UI Polish Items
- 1.7 Database Safety Check

### Phase 2 (Tackle Later) - PARTIAL
- 2.1 Advanced Matching & Normalization - COMPLETE
- 2.2 Backup Policy & Data Safety - COMPLETE
- 2.3 User-Configurable Field Mapping - COMPLETE
- 2.4 Packaging & Distribution - COMPLETE
- 2.5 Legal & Compliance - COMPLETE
- 2.6 About Page & Licensing System - COMPLETE (Task 3.8)
- 2.7 Multi-Source Data Fetching - NOT STARTED
- 2.8 OpenNumismat Plugin Integration - NOT STARTED
